<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comprehensive SIP Financial Strategy Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 20px; background-color: #f9fafb; color: #1f2937; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h1 { font-size: 2.25rem; font-weight: bold; color: #111827; border-bottom: 2px solid #3B82F6; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
    h2 { font-size: 1.5rem; font-weight: bold; color: #111827; margin-top: 2rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; }
    h3 { font-size: 1.25rem; font-weight: bold; color: #1f2937; margin-bottom: 1rem; }
    table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
    th { background-color: #f8f9fa; font-weight: 600; }
    p { line-height: 1.6; margin-bottom: 1rem; }
    ul, ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    li { margin-bottom: 0.5rem; }
    .executive-summary { background-color: #eff6ff; border-left: 4px solid #3B82F6; padding: 1.5rem; margin-bottom: 2rem; border-radius: 4px; }
    .callout.warning { background-color: #fffbeb; border-left: 4px solid #f59e0b; padding: 1rem; margin: 1rem 0; border-radius: 4px; }
    .chart-container h3 { text-align: center; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; color: #1f2937; }
    .chart-container > div { margin: 0 auto; }
    .no-print { display: block; }
    @media print {
      .no-print { display: none; }
      body { padding: 0; background-color: #fff; color: #000; }
      .container { box-shadow: none; border: none; padding: 0.5rem; }
      h1, h2 { margin-top: 1.5rem; }
      .chart-container { page-break-inside: avoid; margin: 15px 0; border: 1px solid #ccc !important; }
      canvas { max-height: 300px !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Systematic Investment Plan (SIP) Financial Strategy Report</h1>
    
    <div class="no-print" style="margin-bottom: 2rem; text-align: center;">
        <button onclick="window.print()" style="margin: 5px; padding: 12px 24px; background-color: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Print Report</button>
        <button onclick="downloadHTML()" style="margin: 5px; padding: 12px 24px; background-color: #10B981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Download HTML</button>
    </div>

    <section id="executive-summary">
      <div class="executive-summary">
        <h2>üéØ Executive Summary</h2>
        <p>This report details a personalized Systematic Investment Plan (SIP) designed to achieve a wealth creation goal of <b>‚Çπ10,000,000</b> over a <b>5-year</b> period. After adjusting for an estimated annual inflation of 5.5%, the target corpus is <b>‚Çπ13,069,600.23</b>. To reach this goal, a monthly SIP contribution of <b>‚Çπ160,030.07</b> is required, assuming a 12% annualized return based on a 'high' risk appetite. The recommended strategic asset allocation is <b>70% in Equity</b> and <b>30% in Debt</b> instruments.</p>
        <div class='callout warning'>‚ö†Ô∏è <strong>Critical Alert: Action Required.</strong> While the financial calculations for this plan are sound, a critical failure occurred in the upstream data retrieval process for fund shortlisting. Consequently, it was not possible to map the strategic allocation to specific, viable fund categories. <b>This plan is currently not actionable.</b> The immediate priority is to resolve the underlying data source issue before proceeding with any investment.</div>
      </div>
    </section>
    <section id='goal-inputs'>
      <h2>üìò Goal Inputs & Investor Profile</h2>
      <p>The financial plan is based on the following parameters provided by the user.</p>
      <table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody><tr><td><strong>Goal Type</strong></td><td>General Wealth Creation</td></tr><tr><td><strong>Current Age</strong></td><td>50</td></tr><tr><td><strong>Target Amount</strong></td><td>‚Çπ10,000,000</td></tr><tr><td><strong>Time Horizon</strong></td><td>5 Years (60 Months)</td></tr><tr><td><strong>Risk Appetite</strong></td><td>High</td></tr><tr><td><strong>Currency</strong></td><td>INR</td></tr></tbody></table>
    </section>
    <section id='inflation-adjustment'>
      <h2>üìà Inflation Adjustment Analysis</h2>
      <p>To preserve the future purchasing power of the target corpus, the goal amount has been adjusted for inflation. An assumed average annual inflation rate of 5.5% is applied over the 5-year investment horizon.</p>
      <table><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody><tr><td>Unadjusted Target Corpus</td><td>‚Çπ10,000,000.00</td></tr><tr><td>Assumed Annual Inflation</td><td>5.5%</td></tr><tr><td>Investment Horizon</td><td>5 Years</td></tr><tr><td><strong>Inflation-Adjusted Target Corpus</strong></td><td><strong>‚Çπ13,069,600.23</strong></td></tr></tbody></table>
    </section>
    <section id='sip-calculation'>
      <h2>üßÆ Monthly SIP Calculation</h2>
      <p>The required monthly SIP amount is calculated based on the inflation-adjusted target, the investment duration, and the expected rate of return aligned with the high-risk profile.</p>
      <table><thead><tr><th>Variable</th><th>Value</th></tr></thead><tbody><tr><td>Adjusted Target (Future Value)</td><td>‚Çπ13,069,600.23</td></tr><tr><td>Investment Tenure (n)</td><td>60 months</td></tr><tr><td>Assumed Annual Return</td><td>12%</td></tr><tr><td>Assumed Monthly Return (r)</td><td>1.0%</td></tr><tr><td><strong>Calculated Monthly SIP</strong></td><td><strong>‚Çπ160,030.07</strong></td></tr></tbody></table>
      <p><em>Validation Status: The calculation has been verified and found to be mathematically sound. Verdict: <strong>Pass</strong>.</em></p>
    </section>
    <section id='asset-allocation-plan'>
      <h2>üß≠ Asset Allocation Plan & Reconciliation Status</h2>
      <p>Based on a 'high' risk profile, the following strategic asset allocation is recommended. However, due to a data retrieval failure, reconciliation with actual fund categories could not be completed.</p>
      <h3>Strategic Allocation Target</h3>
      <table><thead><tr><th>Asset Class</th><th>Target Allocation</th><th>Recommended Fund Categories</th></tr></thead><tbody><tr><td><strong>Equity</strong></td><td>70%</td><td>Large Cap Funds, Mid Cap Funds, Small Cap Funds</td></tr><tr><td><strong>Debt</strong></td><td>30%</td><td>Corporate Bond Funds, Short Duration Funds</td></tr></tbody></table>
      <h3>Reconciliation Status: <span style='color:red;'>FAILED</span></h3>
      <div class='callout warning'>A data retrieval failure prevented the mapping of the strategic allocation to specific fund categories. The plan cannot be implemented until this is resolved.</div>
    </section>
    <section id='key-recommendations'>
      <h2>üîë Key Recommendations</h2>
      <p>The following actions are critical and must be addressed before this financial plan can be implemented.</p>
      <ol><li><strong style='color:#E53E3E;'>Halt the current investment planning workflow immediately.</strong> (Priority: Critical). Proceeding without a valid fund shortlist will lead to an incomplete and un-actionable plan.</li><li><strong style='color:#DD6B20;'>Investigate and resolve the data retrieval failure.</strong> (Priority: High). The root cause lies in the inability to fetch raw fund data. This upstream dependency must be fixed.</li><li><strong style='color:#3182CE;'>Re-run the workflow after the issue is resolved.</strong> (Priority: Medium). Once the data source is reliable, re-running the process will generate the necessary fund shortlist, allowing reconciliation to be attempted again.</li></ol>
    </section>
    <section id='risk-factors'>
      <h2>‚öñÔ∏è Risk Factors and Uncertainties</h2>
      <p>This investment plan, while mathematically sound, is subject to several risks and uncertainties that must be carefully considered. The most immediate and critical issue is the <b>procedural risk</b> manifested by the failure to retrieve a fund shortlist. This is not a market risk but a failure in the data pipeline that renders the plan's implementation impossible until resolved. Beyond this, the plan is built on an assumed <b>12% annual return</b>, which is a projection, not a guarantee. Equity markets are inherently volatile, and actual returns may be lower, which would result in a smaller final corpus. <b>Inflation risk</b> is another significant factor; the 5.5% estimate may be exceeded by actual inflation, reducing the real-terms value of the final amount. The success of this SIP is also contingent on <b>execution and discipline risk</b>; any missed or delayed monthly payments will negatively impact the final outcome. Investors should also be aware of <b>liquidity risk</b>, as returns in equity-linked instruments are best realized over the complete term, and premature withdrawals can be detrimental.</p>
    </section>

    <!-- v15 FIXED CHART LAYOUT -->
    <section id="sip-charts">
      <h2>üìä SIP Projection & Allocation Charts</h2>
      <div style="display: block; max-width: 1000px; margin: 0 auto;">
        <!-- Asset Allocation FIRST (TOP) -->
        <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">Asset Allocation</h3>
          <div style="max-width: 500px; margin: 0 auto;">
            <canvas id="sipAllocationChart" width="400" height="300" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
        
        <!-- SIP Growth Projection SECOND (BOTTOM) -->
        <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">SIP Growth Projection</h3>
          <div style="max-width: 800px; margin: 0 auto;">
            <canvas id="sipProjectionChart" width="600" height="400" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id='sip-projection-long-horizon'>
      <h2>üóìÔ∏è SIP Projection Summary (Key Milestones)</h2>
      <p>The following table provides a high-level summary of the projected corpus at key milestones over the 5-year period.</p>
      <table><thead><tr><th>Milestone</th><th>Total Contribution</th><th>Projected Corpus Value</th></tr></thead><tbody><tr><td>End of Year 1 (Month 12)</td><td>‚Çπ1,920,360.84</td><td>‚Çπ2,029,672.12</td></tr><tr><td>End of Year 3 (Month 36)</td><td>‚Çπ5,761,082.52</td><td>‚Çπ6,903,233.18</td></tr><tr><td>End of Year 5 (Month 60)</td><td>‚Çπ9,601,804.20</td><td>‚Çπ13,105,672.85</td></tr></tbody></table>
    </section>
    <section id='sip-projection-12-month'>
      <h2>üìà SIP Projection Details (First 12 Months)</h2>
      <div class='table-container'><table><thead><tr><th>Month</th><th>Cumulative Contribution</th><th>Projected Corpus</th></tr></thead><tbody><tr><td>M1</td><td>‚Çπ160,030.07</td><td>‚Çπ160,030.07</td></tr><tr><td>M2</td><td>‚Çπ320,060.14</td><td>‚Çπ321,660.44</td></tr><tr><td>M3</td><td>‚Çπ480,090.21</td><td>‚Çπ484,907.11</td></tr><tr><td>M4</td><td>‚Çπ640,120.28</td><td>‚Çπ649,786.25</td></tr><tr><td>M5</td><td>‚Çπ800,150.35</td><td>‚Çπ816,314.18</td></tr><tr><td>M6</td><td>‚Çπ960,180.42</td><td>‚Çπ984,508.39</td></tr><tr><td>M7</td><td>‚Çπ1,120,210.49</td><td>‚Çπ1,154,386.54</td></tr><tr><td>M8</td><td>‚Çπ1,280,240.56</td><td>‚Çπ1,325,966.48</td></tr><tr><td>M9</td><td>‚Çπ1,440,270.63</td><td>‚Çπ1,499,266.21</td></tr><tr><td>M10</td><td>‚Çπ1,600,300.70</td><td>‚Çπ1,674,303.94</td></tr><tr><td>M11</td><td>‚Çπ1,760,330.77</td><td>‚Çπ1,851,100.05</td></tr><tr><td>M12</td><td>‚Çπ1,920,360.84</td><td>‚Çπ2,029,672.12</td></tr></tbody></table></div>
      <p><em>Note: The complete 60-month projection is visualized in the interactive chart in the section above.</em></p>
    </section>
  </div>

  <!-- Data Embedding -->
  <script id="chart-data" type="application/json">{"projection":{"labels":["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60"],"datasets":{"cumulative_contribution":[160030.07,320060.14,480090.21,640120.28,800150.35,960180.42,1120210.49,1280240.56,1440270.63,1600300.7,1760330.77,1920360.84,2080390.91,2240420.98,2400451.05,2560481.12,2720511.19,2880541.26,3040571.33,3200601.4,3360631.47,3520661.54,3680691.61,3840721.68,4000751.75,4160781.82,4320811.89,4480841.96,4640872.03,4800902.1,4960932.17,5120962.24,5280992.31,5441022.38,5601052.45,5761082.52,5921112.59,6081142.66,6241172.73,6401202.8,6561232.87,6721262.94,6881293.01,7041323.08,7201353.15,7361383.22,7521413.29,7681443.36,7841473.43,8001503.5,8161533.57,8321563.64,8481593.71,8641623.78,8801653.85,8961683.92,9121713.99,9281744.06,9441774.13,9601804.2],"projected_corpus":[160030.07,321660.44,484907.11,649786.25,816314.18,984508.39,1154386.54,1325966.48,1499266.21,1674303.94,1851100.05,2029672.12,2210049.21,2392250.77,2576296.35,2762205.38,294997.51,3139692.55,3331310.55,3524871.73,3720396.52,3917905.56,4117419.68,4318959.95,4522547.62,4728203.97,4935950.08,5145807.15,5357796.59,5571939.83,5788258.3,6006773.45,6227506.85,6450480.19,6675715.06,6903233.18,7133056.38,7365206.51,7599705.45,7836575.08,8075837.3,8317514.04,8561627.15,8808198.49,9057250.04,9308803.91,9562882.22,9819508.11,10078703.26,1034089.36,10604887.32,10871919.26,11141606.32,11413970.45,11689032.22,11966813.21,12247333.41,12530613.81,12816776.02,13105672.85]}},"allocation":{"labels":["Equity","Debt"],"data":[70,30]}}</script>

  <!-- Scripts for Functionality -->
  <script>
    function downloadHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'comprehensive_sip_report.html';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>

  <!-- v15 ENHANCED chart rendering with FIXED alignment -->
  <script>
    function initCharts() {
      if (typeof Chart === 'undefined') {
        console.error('Chart.js not loaded');
        return;
      }
      
      let data;
      try {
        const script = document.getElementById('chart-data');
        data = script ? JSON.parse(script.textContent) : null;
      } catch (e) {
        console.warn('Chart data parse failed');
        data = null;
      }
      
      // Fallback data if parsing fails
      if (!data) {
        data = {
          projection: { labels: ["M1"], datasets: { cumulative_contribution: [0], projected_corpus: [0] } },
          allocation: { labels: ["Equity", "Debt"], data: [70, 30] }
        };
      }
      
      // Create allocation chart FIRST (TOP POSITION)
      const allocCtx = document.getElementById('sipAllocationChart');
      if (allocCtx) {
        new Chart(allocCtx, {
          type: 'doughnut',
          data: {
            labels: data.allocation.labels,
            datasets: [{ 
              data: data.allocation.data, 
              backgroundColor: ['#3B82F6', '#10B981'],
              borderWidth: 2 
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.33,
            plugins: {
              legend: { position: 'bottom', labels: { padding: 15 } }
            }
          }
        });
      }
      
      // Create projection chart SECOND (BOTTOM POSITION)
      const projCtx = document.getElementById('sipProjectionChart');
      if (projCtx) {
        new Chart(projCtx, {
          type: 'line',
          data: {
            labels: data.projection.labels,
            datasets: [{
              label: 'Projected Corpus',
              data: data.projection.datasets.projected_corpus,
              borderColor: '#3B82F6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }, {
              label: 'Cumulative Contribution', 
              data: data.projection.datasets.cumulative_contribution,
              borderColor: '#EF4444',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              fill: false,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            interaction: {
              mode: 'nearest',
              intersect: false
            },
            scales: {
              x: {
                title: { display: true, text: 'Time Period (Months)' },
                ticks: { maxTicksLimit: 12 }
              },
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Amount (INR)' },
                ticks: {
                  callback: function(value) {
                    if (value >= 10000000) return '‚Çπ' + (value/10000000).toFixed(2) + 'Cr';
                    if (value >= 100000) return '‚Çπ' + (value/100000).toFixed(1) + 'L';
                    return '‚Çπ' + value.toLocaleString('en-IN');
                  }
                }
              }
            },
            plugins: {
              tooltip: {
                mode: 'index',
                intersect: false
              }
            }
          }
        });
      }
    }

    // Initialize with a delay for proper loading
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() { setTimeout(initCharts, 500); });
    } else {
      setTimeout(initCharts, 500);
    }
  </script>

</body>
</html>