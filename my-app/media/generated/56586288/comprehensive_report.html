<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive SIP Analysis Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <header class="text-center py-8">
            <h1 class="text-3xl font-semibold">Comprehensive SIP Analysis Report</h1>
        </header>

        <section id="executive-summary" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Executive Summary</h2>
            <p id="executive-summary-content">No executive summary available.</p>
        </section>

        <section id="goal-inputs" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Goal Inputs</h2>
            <ul id="goal-inputs-list">
                <li><strong>Goal Type:</strong> <span id="goal-type">N/A</span></li>
                <li><strong>Target Amount:</strong> <span id="target-amount">N/A</span> <span id="currency">N/A</span></li>
                <li><strong>Time Horizon:</strong> <span id="time-horizon">N/A</span> years</li>
                <li><strong>Risk Appetite:</strong> <span id="risk-appetite">N/A</span></li>
            </ul>
        </section>

        <section id="inflation-adjustment" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Inflation Adjustment</h2>
            <ul id="inflation-adjustment-list">
                <li><strong>Inflation Rate:</strong> <span id="inflation-rate">N/A</span>%</li>
                <li><strong>Time Horizon:</strong> <span id="inflation-time-horizon">N/A</span> years</li>
                <li><strong>Unadjusted Target:</strong> <span id="unadjusted-target">N/A</span></li>
                <li><strong>Adjusted Target:</strong> <span id="adjusted-target">N/A</span></li>
            </ul>
        </section>

        <section id="sip-calculation" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">SIP Calculation</h2>
            <ul id="sip-calculation-list">
                <li><strong>Monthly Return Rate:</strong> <span id="monthly-return-rate">N/A</span>%</li>
                <li><strong>Time Horizon:</strong> <span id="sip-time-horizon">N/A</span> months</li>
                <li><strong>Adjusted Target:</strong> <span id="sip-adjusted-target">N/A</span></li>
                <li><strong>Monthly SIP:</strong> <span id="monthly-sip">N/A</span></li>
            </ul>
        </section>

        <section id="asset-allocation-plan" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Asset Allocation Plan</h2>
            <table class="table-auto">
                <thead>
                    <tr>
                        <th class="px-4 py-2">Asset Class</th>
                        <th class="px-4 py-2">Percentage</th>
                    </tr>
                </thead>
                <tbody id="asset-allocation-table">
                </tbody>
            </table>
            <h3 class="text-lg font-semibold mt-4">Recommended Fund Categories</h3>
            <div>
                <strong>Equity:</strong> <span id="equity-funds">N/A</span><br>
                <strong>Debt:</strong> <span id="debt-funds">N/A</span><br>
                <strong>ELSS (Optional):</strong> <span id="elss-optional">No</span>
            </div>
        </section>

        <section id="allocation-notes" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Allocation Notes</h2>
            <ul id="allocation-notes-list">
                <li><strong>Very Low:</strong> <span id="note-very-low">N/A</span></li>
                <li><strong>Low:</strong> <span id="note-low">N/A</span></li>
                <li><strong>Low-Moderate:</strong> <span id="note-low-moderate">N/A</span></li>
                <li><strong>Moderate:</strong> <span id="note-moderate">N/A</span></li>
                <li><strong>High-Moderate:</strong> <span id="note-high-moderate">N/A</span></li>
                <li><strong>High:</strong> <span id="note-high">N/A</span></li>
                <li><strong>Very High:</strong> <span id="note-very-high">N/A</span></li>
            </ul>
        </section>

        <section id="key-recommendations" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Key Recommendations</h2>
            <p>Based on the asset allocation plan, the following fund recommendations are suggested:</p>
            <ul id="key-recommendations-list">
                <li><strong>Equity:</strong> <span id="equity-recommendations">N/A</span></li>
                <li><strong>Debt:</strong> <span id="debt-recommendations">N/A</span></li>
            </ul>
        </section>

        <section id="risk-factors-uncertainties" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Risk Factors and Uncertainties</h2>
            <p>Investing involves risks, including market fluctuations, inflation, and economic factors.  It's crucial to understand these risks before making investment decisions. The SIP projection model is based on assumptions and actual outcomes may vary.  Market risk can lead to volatility and potential losses.  Inflation risk can erode the real value of returns. Interest rate risk can impact debt investment returns.  Credit risk can lead to defaults on debt instruments.  Liquidity risk can make it difficult to sell investments quickly. Regulatory risk can impact the investment landscape. Reinvestment risk involves reinvesting returns at lower rates. Model risk arises from the assumptions used in the projection model. Longevity risk is the risk of outliving retirement savings. Diversification, regular portfolio reviews, and consulting with a financial advisor are essential for informed decisions. This content is for informational purposes only and does not constitute financial advice. Always consult with a qualified financial advisor before making investment decisions.</p>
        </section>

        <section id="validation-summary" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Validation Summary</h2>
            <p id="validation-status">Status: Pending</p>
        </section>

        <section id="sip-charts" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">SIP Projection & Allocation Charts</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-medium mb-2">SIP Growth Projection</h3>
                    <canvas id="sipProjectionChart" width="400" height="300"></canvas>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-2">Asset Allocation</h3>
                    <canvas id="sipAllocationChart" width="400" height="300"></canvas>
                </div>
            </div>
        </section>

        <section id="sip-projection-long-horizon" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">SIP Projection Summary (First 12 Months)</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Month</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cumulative Contribution</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Projected Corpus</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="sip-projection-table-body">
                    </tbody>
                </table>
            </div>
        </section>

        <section id="disclaimer" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Disclaimer</h2>
            <p>This report is for informational purposes only and does not constitute financial advice. Please consult with a qualified financial advisor before making any investment decisions.</p>
        </section>

        <div class="flex justify-center space-x-4">
            <button onclick="window.print()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Print</button>
            <button onclick="downloadReport()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Download</button>
        </div>

    </div>

    <script id="goal-input-json" type="application/json">{}</script>
    <script id="inflation-adjusted-json" type="application/json">{}</script>
    <script id="sip-calc-json" type="application/json">{}</script>
    <script id="allocation-plan-json" type="application/json">{}</script>
    <script id="chart-data-json" type="application/json">{}</script>
    <script id="report-payload" type="application/json">{}</script>

    <script>
        function downloadReport() {
            const element = document.createElement("a");
            const file = new Blob([document.documentElement.outerHTML], {
                type: "text/html"
            });
            element.href = URL.createObjectURL(file);
            element.download = "comprehensive_report.html";
            document.body.appendChild(element);
            element.click();
        }

        function populateReport() {
            // Helper function to safely parse JSON or return an empty object
            function safeParseJson(elementId) {
                try {
                    const element = document.getElementById(elementId);
                    return element && element.textContent ? JSON.parse(element.textContent) : {};
                } catch (e) {
                    console.error("Error parsing JSON for " + elementId + ":", e);
                    return {};
                }
            }

            // Get data from window or script tags
            const goalInputJson = window.goal_input_json || safeParseJson("goal-input-json");
            const inflationAdjustedJson = window.inflation_adjusted_json || safeParseJson("inflation-adjusted-json");
            const sipCalcJson = window.sip_calc_json || safeParseJson("sip-calc-json");
            const allocationPlanJson = window.allocation_plan_json || safeParseJson("allocation-plan-json");
            const chartDataJson = window.chart_data_json || safeParseJson("chart-data-json");
            const reportPayload = window.report_payload || safeParseJson("report-payload");


            // Populate Executive Summary
            document.getElementById("executive-summary-content").textContent = reportPayload.executive_summary || "No executive summary available.";

            // Populate Goal Inputs
            document.getElementById("goal-type").textContent = goalInputJson.goal_type || "N/A";
            document.getElementById("target-amount").textContent = goalInputJson.target_amount || "N/A";
            document.getElementById("currency").textContent = goalInputJson.currency || "N/A";
            document.getElementById("time-horizon").textContent = goalInputJson.time_horizon_years || "N/A";
            document.getElementById("risk-appetite").textContent = goalInputJson.risk_appetite || "N/A";

            // Populate Inflation Adjustment
            document.getElementById("inflation-rate").textContent = inflationAdjustedJson.inflation_pct || "N/A";
            document.getElementById("inflation-time-horizon").textContent = inflationAdjustedJson.years || "N/A";
            document.getElementById("unadjusted-target").textContent = inflationAdjustedJson.unadjusted_target || "N/A";
            document.getElementById("adjusted-target").textContent = inflationAdjustedJson.adjusted_target || "N/A";

            // Populate SIP Calculation
            document.getElementById("monthly-return-rate").textContent = sipCalcJson.monthly_return_r || "N/A";
            document.getElementById("sip-time-horizon").textContent = sipCalcJson.months_n || "N/A";
            document.getElementById("sip-adjusted-target").textContent = sipCalcJson.adjusted_target || "N/A";
            document.getElementById("monthly-sip").textContent = sipCalcJson.monthly_sip || "N/A";

            // Populate Asset Allocation Plan
            const assetAllocationTable = document.getElementById("asset-allocation-table");
            assetAllocationTable.innerHTML = ""; // Clear existing content
            if (reportPayload.allocation && Array.isArray(reportPayload.allocation)) {
                reportPayload.allocation.forEach(item => {
                    const row = assetAllocationTable.insertRow();
                    const assetClassCell = row.insertCell();
                    const percentageCell = row.insertCell();
                    assetClassCell.textContent = item.asset_class || "N/A";
                    percentageCell.textContent = item.percentage || "N/A";
                    assetClassCell.className = "px-4 py-2";
                    percentageCell.className = "px-4 py-2";
                });
            }
            
            const equityFundsElement = document.getElementById("equity-funds");
            const debtFundsElement = document.getElementById("debt-funds");
            const elssOptionalElement = document.getElementById("elss-optional");

            equityFundsElement.textContent = allocationPlanJson.recommended_fund_categories?.equity?.join(", ") || "N/A";
            debtFundsElement.textContent = allocationPlanJson.recommended_fund_categories?.debt?.join(", ") || "N/A";
            elssOptionalElement.textContent = allocationPlanJson.recommended_fund_categories?.elss_optional ? "Yes" : "No";

            // Populate Allocation Notes
            document.getElementById("note-very-low").textContent = allocationPlanJson.notes?.very_low || "N/A";
            document.getElementById("note-low").textContent = allocationPlanJson.notes?.low || "N/A";
            document.getElementById("note-low-moderate").textContent = allocationPlanJson.notes?.low_moderate || "N/A";
            document.getElementById("note-moderate").textContent = allocationPlanJson.notes?.moderate || "N/A";
            document.getElementById("note-high-moderate").textContent = allocationPlanJson.notes?.high_moderate || "N/A";
            document.getElementById("note-high").textContent = allocationPlanJson.notes?.high || "N/A";
            document.getElementById("note-very-high").textContent = allocationPlanJson.notes?.very_high || "N/A";

            // Populate Key Recommendations
            const equityRecommendationsElement = document.getElementById("equity-recommendations");
            const debtRecommendationsElement = document.getElementById("debt-recommendations");

            equityRecommendationsElement.textContent = "Large Cap, Mid Cap, Small Cap";
            debtRecommendationsElement.textContent = "Short Term Debt, Long Term Debt";

            //SIP Projection Table
            const sipProjectionTableBody = document.getElementById("sip-projection-table-body");
            
            const projection = chartDataJson?.projection;        

            if (projection && projection.labels && projection.datasets) {
                const labels = projection.labels;
                const cumulativeContribution = projection.datasets.cumulative_contribution;
                const projectedCorpus = projection.datasets.projected_corpus;

                for (let i = 0; i < labels.length; i++) {
                    const row = sipProjectionTableBody.insertRow();

                    const monthCell = row.insertCell();
                    const cumulativeContributionCell = row.insertCell();
                    const projectedCorpusCell = row.insertCell();

                    monthCell.textContent = labels[i] || 'N/A';
                    cumulativeContributionCell.textContent = cumulativeContribution[i] || 'N/A';
                    projectedCorpusCell.textContent = projectedCorpus[i] || 'N/A';
                }

            }


            // Charts
            const sipProjectionChartCanvas = document.getElementById('sipProjectionChart');
            const sipAllocationChartCanvas = document.getElementById('sipAllocationChart');

            if (sipProjectionChartCanvas) {
                const projectionLabels = chartDataJson.projection?.labels || [];
                const cumulativeContributionData = chartDataJson.projection?.datasets?.cumulative_contribution || [];
                const projectedCorpusData = chartDataJson.projection?.datasets?.projected_corpus || [];


                new Chart(sipProjectionChartCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: projectionLabels,
                        datasets: [{
                            label: 'Projected Corpus',
                            data: projectedCorpusData,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: true
                        }, {
                            label: 'Cumulative Contribution',
                            data: cumulativeContributionData,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Amount (INR)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time Period'
                                }
                            }
                        }
                    }
                });
            }

            if (sipAllocationChartCanvas) {
                const allocationLabels = chartDataJson.allocation?.labels || ["Equity", "Debt"];
                const allocationData = chartDataJson.allocation?.data || [60, 40];
                new Chart(sipAllocationChartCanvas.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: allocationLabels,
                        datasets: [{
                            data: allocationData,
                            backgroundColor: ['#3B82F6', '#10B981']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // Call populateReport when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', populateReport);
    </script>
</body>
</html>