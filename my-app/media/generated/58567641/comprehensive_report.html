<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comprehensive Retirement Investment Strategy Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 20px; background-color: #f9fafb; color: #1f2937; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h1 { font-size: 2.25rem; font-weight: bold; color: #111827; border-bottom: 2px solid #3B82F6; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
    h2 { font-size: 1.5rem; font-weight: bold; color: #111827; margin-top: 2rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; }
    table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
    th { background-color: #f8f9fa; font-weight: 600; }
    p { line-height: 1.6; margin-bottom: 1rem; }
    ul, ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    li { margin-bottom: 0.5rem; }
    .callout.warning { background-color: #fffbeb; border-left: 4px solid #f59e0b; padding: 1.5rem; margin: 1.5rem 0; border-radius: 4px; }
    .comparison-boxes { display: block; }
    .box { border: 1px solid #e5e7eb; padding: 1rem; margin-bottom: 1rem; border-radius: 6px; }
    /* FIXED CHART CONTAINER STYLING - NO GRID */
    .chart-container { margin: 25px 0; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .chart-container h3 { text-align: center; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; color: #1f2937; }
    .chart-container > div { margin: 0 auto; }
    .no-print { display: block; }
    @media print {
      .no-print { display: none; }
      body { padding: 0; background-color: #fff; }
      .container { box-shadow: none; border: none; padding: 0.5rem; }
      h1, h2 { margin-top: 1.5rem; }
      .chart-container { page-break-inside: avoid; margin: 15px 0; }
      canvas { max-height: 300px !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Comprehensive Retirement Investment Strategy Report</h1>
    
    <div class="no-print" style="margin: 20px 0; text-align: center;">
      <button onclick="window.print()" style="margin: 5px; padding: 12px 24px; background-color: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Print Report</button>
      <button onclick="downloadHTML()" style="margin: 5px; padding: 12px 24px; background-color: #10B981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Download HTML</button>
    </div>

    <section id="executive-summary">
      <h2>üéØ 1. Executive Summary</h2>
      <div class='callout warning'>‚ö†Ô∏è <strong>Critical Data Integrity Notice:</strong> The fund data used for this analysis was derived from a cached or mock dataset due to a failure in the live data retrieval step. While the strategic framework, calculations, and recommendations are logically sound based on the provided data, the fund performance metrics may not be current. It is strongly recommended to re-run this analysis with successfully retrieved, up-to-date market data before making any investment decisions.</div>
      <p>This report presents a tailored 10-year retirement investment strategy for a 50-year-old investor with a <b>moderate risk appetite</b>. The primary objective is to achieve an inflation-adjusted target corpus of approximately <b>‚Çπ1.7 Crore</b> by investing a monthly SIP of <b>‚Çπ83,388</b>. The strategy is built on a foundation of disciplined investing, diversification, and a dynamic risk-management approach known as a 'glide path'.</p>
      <ul>
        <li><b>Core Strategy:</b> An initial balanced asset allocation of <b>50% Equity and 50% Debt</b> to foster growth while managing volatility.</li>
        <li><b>Portfolio:</b> A diversified portfolio of four carefully selected mutual funds, utilizing a 'core and satellite' approach for both asset classes.</li>
        <li><b>Recommended Funds:</b> ICICI Prudential Bluechip (Large Cap), PGIM India Midcap Opportunities (Mid Cap), HDFC Corporate Bond (Corporate Bond), and ICICI Prudential Short Term (Short Duration).</li>
        <li><b>Dynamic Risk Management:</b> A three-phase plan that systematically reduces equity exposure in the final three years (Years 8-10) to preserve the accumulated corpus as the retirement goal approaches.</li>
        <li><b>Key Guideline:</b> The plan emphasizes consistent monthly investments, annual reviews, and disciplined rebalancing based on predefined triggers.</li>
      </ul>
    </section>

    <section id='investment-profile'>
        <h2>ü§µ 2. Retirement Investment Profile</h2>
        <p>The investment plan is customized based on the following financial profile and retirement goals.</p>
        <div><table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody><tr><td><b>Goal Type</b></td><td>Retirement</td></tr><tr><td><b>Current Age</b></td><td>50 years</td></tr><tr><td><b>Target Retirement Age</b></td><td>60 years</td></tr><tr><td><b>Investment Horizon</b></td><td>10 years</td></tr><tr><td><b>Risk Appetite</b></td><td>Moderate</td></tr><tr><td><b>Required Monthly SIP</b></td><td>‚Çπ83,388</td></tr><tr><td><b>Target Corpus (Inflation-Adjusted)</b></td><td>‚Çπ1,70,81,445</td></tr><tr><td><b>Assumed Annual Return</b></td><td>10%</td></tr><tr><td><b>Assumed Inflation Rate</b></td><td>5.5%</td></tr></tbody></table></div>
    </section>
    
    <section id='asset-allocation'>
        <h2>‚öñÔ∏è 3. Asset Allocation Strategy</h2>
        <p>The strategy begins with a balanced 50/50 split between equity and debt, aligning with a moderate risk profile. This allocation is designed to capture growth from equity markets while relying on the stability and income generation of debt instruments. Within each asset class, a 'core and satellite' approach is used to further refine risk and return potential.</p>
        <ul><li><b>Equity Allocation (50%):</b> A blend of stable Large Cap funds (Core) and higher-growth Mid Cap funds (Satellite).</li><li><b>Debt Allocation (50%):</b> A mix of higher-yield Corporate Bond funds (Core) and highly liquid Short Duration funds for capital protection (Satellite).</li></ul>
    </section>
    
    <section id='fund-performance'>
        <h2>üìà 4. Fund Performance Analysis</h2>
        <p>The following table details the key performance and risk metrics for the four recommended funds based on the available data. The selection process prioritized funds with strong risk-adjusted returns (Sharpe Ratio), consistent outperformance (Alpha), and reasonable costs (Expense Ratio).</p>
        <div><table><thead><tr><th>Fund Name</th><th>Category</th><th>1Y CAGR (%)</th><th>3Y CAGR (%)</th><th>5Y CAGR (%)</th><th>Std. Dev</th><th>Sharpe Ratio</th><th>Expense Ratio (%)</th></tr></thead><tbody><tr><td><b>ICICI Prudential Bluechip Fund</b></td><td>Large Cap</td><td>18.5</td><td>22.1</td><td>19.3</td><td>16.2</td><td>1.35</td><td>0.95</td></tr><tr><td><b>PGIM India Midcap Opportunities Fund</b></td><td>Mid Cap</td><td>25.5</td><td>30.2</td><td>28.1</td><td>20.5</td><td>1.55</td><td>0.45</td></tr><tr><td><b>HDFC Corporate Bond Fund</b></td><td>Corporate Bond</td><td>7.5</td><td>7.1</td><td>7.3</td><td>2.5</td><td>1.80</td><td>0.55</td></tr><tr><td><b>ICICI Prudential Short Term Fund</b></td><td>Short Duration</td><td>6.8</td><td>6.5</td><td>6.6</td><td>1.5</td><td>2.00</td><td>0.70</td></tr></tbody></table></div>
    </section>

    <!-- V15 FIXED CHART SECTION - VERTICAL STACK -->
    <section id="fund-performance-charts">
      <h2>üìä 5. Visual Analysis: Performance & Allocation Charts</h2>
      <div style="display: block; max-width: 1000px; margin: 0 auto;">
        <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">Fund Performance Comparison (CAGR)</h3>
          <div style="max-width: 800px; margin: 0 auto;"><canvas id="fundPerformanceChart" width="700" height="400"></canvas></div>
        </div>
        <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">Risk vs Return Analysis</h3>
          <div style="max-width: 800px; margin: 0 auto;"><canvas id="riskReturnChart" width="700" height="400"></canvas></div>
        </div>
        <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">Portfolio Asset Allocation</h3>
          <div style="max-width: 500px; margin: 0 auto;"><canvas id="portfolioAllocationChart" width="400" height="400"></canvas></div>
        </div>
        <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">Portfolio Category Breakdown</h3>
          <div style="max-width: 500px; margin: 0 auto;"><canvas id="fundCategoryChart" width="400" height="400"></canvas></div>
        </div>
        <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">Expense Ratio Comparison</h3>
          <div style="max-width: 800px; margin: 0 auto;"><canvas id="expenseComparisonChart" width="700" height="300"></canvas></div>
        </div>
        <div class="chart-container" style="text-align: center; border: 1px solid #e5e7eb; padding: 20px; border-radius: 8px;">
          <h3 style="margin-bottom: 15px;">10-Year Asset Allocation Glide Path</h3>
          <div style="max-width: 800px; margin: 0 auto;"><canvas id="glidePathChart" width="700" height="400"></canvas></div>
        </div>
      </div>
    </section>

    <section id='top-recommendations'>
        <h2>üèÜ 6. Top Fund Recommendations</h2>
        <p>Based on the quantitative scoring and qualitative analysis, the following four funds are recommended for the initial portfolio construction. The monthly SIP of ‚Çπ83,388 is allocated as detailed below (amounts are rounded for practical implementation).</p>
        <h3>Recommended Portfolio Allocation</h3>
        <div><table><thead><tr><th>Fund Name</th><th>Category</th><th>Allocation %</th><th>Monthly SIP Amount</th></tr></thead><tbody><tr><td>ICICI Prudential Bluechip Fund</td><td>Large Cap</td><td>30.0%</td><td><b>‚Çπ25,016</b></td></tr><tr><td>PGIM India Midcap Opportunities Fund</td><td>Mid Cap</td><td>20.0%</td><td><b>‚Çπ16,678</b></td></tr><tr><td>HDFC Corporate Bond Fund</td><td>Corporate Bond</td><td>30.0%</td><td><b>‚Çπ25,016</b></td></tr><tr><td>ICICI Prudential Short Term Fund</td><td>Short Duration</td><td>20.0%</td><td><b>‚Çπ16,678</b></td></tr><tr><td><b>Total</b></td><td></td><td><b>100.0%</b></td><td><b>‚Çπ83,388</b></td></tr></tbody></table></div>
        <h3>Selection Rationale: Head-to-Head Comparison</h3>
        <div class='comparison-boxes'><h4>Equity Selection</h4><div class='box'><b>Winner: ICICI Prudential Bluechip Fund</b><br>vs. Axis Bluechip Fund<br><i>Reason: ICICI Pru ranks higher due to its superior risk-adjusted returns (Sharpe: 1.35 vs 1.15), better consistency (Alpha: 2.8 vs 1.9), and a lower expense ratio (0.95% vs 1.05%).</i></div><div class='box'><b>Winner: PGIM India Midcap Opportunities Fund</b><br>vs. Kotak Emerging Equity Fund<br><i>Reason: PGIM leads significantly due to an exceptionally low expense ratio (0.45%), higher risk-adjusted returns (Sharpe: 1.55 vs 1.28), and superior consistency (Alpha: 4.5 vs 3.1).</i></div><h4>Debt Selection</h4><div class='box'><b>Winner: HDFC Corporate Bond Fund</b><br>vs. Aditya Birla Sun Life Corporate Bond Fund<br><i>Reason: HDFC is preferred for its higher Sharpe Ratio (1.8 vs 1.5), indicating better returns for the level of risk taken, coupled with a lower expense ratio.</i></div><div class='box'><b>Winner: ICICI Prudential Short Term Fund</b><br>vs. SBI Short Term Debt Fund<br><i>Reason: Selected for its excellent risk management, reflected in a higher Sharpe Ratio (2.0 vs 1.7) and lower maximum drawdown, offering better capital protection.</i></div></div>
    </section>
    
    <section id='portfolio-construction'>
        <h2>üõ†Ô∏è 7. Portfolio Construction</h2>
        <p>Each fund in the portfolio plays a distinct and complementary role, creating a balanced and robust structure.</p>
        <ul><li><b>Core Equity Holding (30%): ICICI Prudential Bluechip Fund</b><br>Provides stability and consistent growth by investing in established market leaders. This forms the foundational equity exposure.</li><li><b>Satellite Growth Holding (20%): PGIM India Midcap Opportunities Fund</b><br>Acts as the growth accelerator, aiming to outperform inflation and the broader market by tapping into the higher potential of mid-sized companies.</li><li><b>Core Debt Holding (30%): HDFC Corporate Bond Fund</b><br>Anchors the portfolio by providing higher yields than sovereign bonds, contributing to corpus growth with lower volatility than equities.</li><li><b>Satellite Stability Holding (20%): ICICI Prudential Short Term Fund</b><br>Offers high liquidity and capital protection with minimal interest rate risk. This component acts as a stabilizer during market downturns.</li></ul>
    </section>
    
    <section id='risk-analysis'>
        <h2>üî¨ 8. Risk Analysis</h2>
        <p>A comprehensive investment strategy must acknowledge and plan for potential risks. The primary risks associated with this 10-year retirement plan include market volatility, fund-specific underperformance, inflation, and data integrity. The strategy incorporates specific mitigation measures for each. <b>Market Volatility Risk</b> is the most significant threat, especially a severe market downturn in the final years before retirement. A late-stage crash could substantially erode the corpus with little time for recovery. <i>Mitigation:</i> The primary defense is the phased de-risking 'glide path' implemented in years 8, 9, and 10, which systematically reduces equity exposure from 50% down to 35%. This locks in gains and shifts the portfolio's focus from growth to capital preservation. The initial 50% allocation to debt also provides a substantial cushion against equity market shocks throughout the investment period. <b>Fund Underperformance Risk</b> refers to the possibility that one or more of the selected funds may fail to meet their benchmarks or peer averages over a sustained period. <i>Mitigation:</i> A mandatory annual review is a core part of the governance framework. During this review, each fund's performance will be compared against its benchmark and category peers. Consistent underperformance over an 18-24 month period should trigger a review and potential replacement with a better-performing fund within the same category to maintain the portfolio's efficacy. <b>Inflation Risk</b> is the danger that the investment returns will not outpace the rate of inflation, reducing the real-world purchasing power of the final corpus. <i>Mitigation:</i> The 50% allocation to equity, particularly the 20% exposure to the Mid Cap growth fund, is specifically designed to generate returns that significantly beat the assumed 5.5% inflation rate over the long term. <b>Data Integrity Risk</b>, as highlighted in the executive summary, is a process-level risk where the recommendations are based on outdated or non-live data. <i>Mitigation:</i> The immediate mitigation is to treat this report as a strategic template. Before execution, the investor must verify the recommendations against fresh, live data or request a re-run of the analysis to ensure the fund selection remains optimal.</p>
    </section>
    
    <section id='implementation-roadmap'>
        <h2>üó∫Ô∏è 9. Implementation Roadmap</h2>
        <p>Follow these steps to implement and manage the investment plan effectively.</p>
        <ol><li><b>Immediate Action:</b> Set up monthly SIPs in the four recommended funds with the specified amounts (e.g., ‚Çπ25,016 in ICICI Pru Bluechip, etc.) through your preferred investment platform. Ensure all SIPs are scheduled for the same date each month.</li><li><b>Annual Review:</b> At the end of each investment year, conduct a deep-dive review. Assess the asset allocation drift. If the equity/debt balance has shifted by more than 5% from its target (e.g., equity is now 56% of the portfolio), trigger the rebalancing process.</li><li><b>Rebalancing Execution:</b> To rebalance, first attempt to redirect new monthly SIPs to the underweight asset class. If this is insufficient, execute a switch/redemption from the overweight funds and reinvest into the underweight funds. Be mindful of exit loads and tax implications.</li><li><b>Follow the Glide Path:</b> Starting in year 8, actively adjust your target allocation as per the Rebalancing Strategy (Section 10). This is not optional; it is a critical risk-management step.</li></ol>
    </section>
        
    <section id='rebalancing-strategy'>
        <h2>üîÑ 10. Rebalancing Strategy (Phase-Based Glide Path)</h2>
        <p>The cornerstone of this strategy's risk management is the time-based 'glide path,' which systematically de-risks the portfolio as retirement nears. The plan is divided into three distinct phases.</p>
        <h3>Phase-Based Asset Allocation Glide Path</h3>
        <div><table><thead><tr><th>Phase</th><th>Years</th><th>Objective</th><th>Target Equity %</th><th>Target Debt %</th></tr></thead><tbody><tr><td><b>Accumulation</b></td><td>1-7</td><td>Maximize Growth</td><td>50%</td><td>50%</td></tr><tr><td><b>Preservation</b></td><td>8</td><td>Begin De-risking</td><td>45%</td><td>55%</td></tr><tr><td><b>Preservation</b></td><td>9</td><td>Continue De-risking</td><td>40%</td><td>60%</td></tr><tr><td><b>Preservation</b></td><td>10</td><td>Final De-risking</td><td>35%</td><td>65%</td></tr></tbody></table></div>
        <ul><li><b>Years 1-7 (Accumulation & Maintenance):</b> Maintain the 50/50 Equity/Debt allocation. Rebalance annually only if the allocation deviates by more than 5%.</li><li><b>Years 8-10 (Preservation):</b> Proactively reduce risk. At the start of each year, rebalance the portfolio to meet the new, more conservative target allocation. This transition should prioritize shifting assets from the more volatile Mid Cap fund first.</li></ul>
    </section>
    
    <section id='tax-optimization'>
        <h2>üí∞ 11. Tax Optimization</h2>
        <p>While this plan is not primarily tax-focused, consider the following opportunities and obligations:</p>
        <ul><li><b>ELSS Consideration:</b> To avail Section 80C benefits, up to ‚Çπ1.5 Lakhs of the annual equity investment could be routed through a top-rated Equity Linked Savings Scheme (ELSS) fund. This would, however, subject each investment to a 3-year lock-in period.</li><li><b>Equity Taxation (LTCG):</b> Upon redemption, gains from equity funds held for more than one year are classified as Long-Term Capital Gains (LTCG). These are taxed at 10% on gains exceeding ‚Çπ1 Lakh in a financial year.</li><li><b>Debt Taxation:</b> Gains from debt funds are added to your income and taxed at your applicable income tax slab rate upon redemption. Plan withdrawals accordingly, as this can have a significant tax impact.</li></ul>
    </section>
    
    <section id='goal-scenarios'>
        <h2>üîÆ 12. Goal Timeline Scenarios</h2>
        <p>The 'glide path' is a robust framework, but its execution may require tactical adjustments based on market conditions in the final years.</p>
        <ul><li><b>Base Case Scenario (Expected Returns):</b> The market delivers returns in line with historical averages. You follow the glide path as prescribed, rebalancing at the start of years 8, 9, and 10 to reduce equity from 50% to 35%. The plan proceeds as expected.</li><li><b>Bull Market Scenario (Higher than Expected Returns):</b> The equity market performs exceptionally well in years 7-9. The de-risking process allows you to systematically 'book profits' from the over-performing equity allocation and move them to the safety of debt, protecting these gains from a potential future correction.</li><li><b>Bear Market Scenario (Market Crash in Year 8 or 9):</b> This is the most challenging scenario. If the equity market crashes just as you are scheduled to de-risk, blindly selling equities would mean crystallizing losses. In this situation, a tactical adjustment is warranted: <b>1)</b> Redirect 100% of new SIPs into the underweight equity funds to buy assets at a low price. <b>2)</b> Delay the rebalancing (selling of equity) until a partial market recovery occurs. The goal is to avoid selling at the bottom. This requires discipline and may warrant consultation with a financial advisor.</li></ul>
    </section>

    <div class="no-print" style="margin: 40px 0 20px; text-align: center;">
      <button onclick="window.print()" style="margin: 5px; padding: 12px 24px; background-color: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Print Report</button>
      <button onclick="downloadHTML()" style="margin: 5px; padding: 12px 24px; background-color: #10B981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Download HTML</button>
    </div>

  </div>

  <!-- EMBEDDED DATA -->
  <script id="fund-chart-data" type="application/json">
  {"performance_comparison":{"type":"bar","data":{"labels":["PGIM Midcap","ICICI Bluechip","HDFC Corp Bond","ICICI Short Term"],"datasets":[{"label":"1Y CAGR (%)","data":[25.5,18.5,7.5,6.8],"backgroundColor":"rgba(54, 162, 235, 0.6)"},{"label":"3Y CAGR (%)","data":[30.2,22.1,7.1,6.5],"backgroundColor":"rgba(255, 99, 132, 0.6)"},{"label":"5Y CAGR (%)","data":[28.1,19.3,7.3,6.6],"backgroundColor":"rgba(75, 192, 192, 0.6)"}]},"options":{"responsive":true,"plugins":{"title":{"display":true,"text":"Recommended Fund Performance (CAGR)"}},"scales":{"x":{"stacked":false},"y":{"stacked":false,"title":{"display":true,"text":"Return (%)"}}}}},
  "risk_return_scatter":{"type":"scatter","data":{"datasets":[{"label":"Equity Funds","data":[{"x":20.5,"y":30.2,"fundName":"PGIM India Midcap Opportunities Fund"},{"x":16.2,"y":22.1,"fundName":"ICICI Prudential Bluechip Fund"}],"backgroundColor":"rgba(255, 99, 132, 0.8)"},{"label":"Debt Funds","data":[{"x":2.5,"y":7.1,"fundName":"HDFC Corporate Bond Fund"},{"x":1.5,"y":6.5,"fundName":"ICICI Prudential Short Term Fund"}],"backgroundColor":"rgba(54, 162, 235, 0.8)"}]},"options":{"responsive":true,"plugins":{"title":{"display":true,"text":"Risk (Std. Dev) vs. Return (3Y CAGR)"}},"scales":{"x":{"title":{"display":true,"text":"Risk (Standard Deviation)"}},"y":{"title":{"display":true,"text":"Return (3Y CAGR %)"}}}}},
  "portfolio_allocation":{"asset_class":{"type":"doughnut","data":{"labels":["Equity","Debt"],"datasets":[{"data":[50,50],"backgroundColor":["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)"]}]},"options":{"responsive":true,"plugins":{"title":{"display":true,"text":"Overall Asset Allocation"}}}},"sub_category":{"type":"pie","data":{"labels":["Large Cap","Mid Cap","Corporate Bond","Short Duration"],"datasets":[{"data":[30,20,30,20],"backgroundColor":["rgba(255, 99, 132, 0.6)","rgba(255, 159, 64, 0.6)","rgba(54, 162, 235, 0.6)","rgba(75, 192, 192, 0.6)"]}]},"options":{"responsive":true,"plugins":{"title":{"display":true,"text":"Portfolio Category Breakdown (%)"}}}}},
  "expense_ratio_comparison":{"type":"bar","data":{"labels":["PGIM Midcap","ICICI Bluechip","HDFC Corp Bond","ICICI Short Term"],"datasets":[{"label":"Expense Ratio (%)","data":[0.45,0.95,0.55,0.7],"backgroundColor":"rgba(153, 102, 255, 0.6)"}]},"options":{"responsive":true,"indexAxis":"y","plugins":{"title":{"display":true,"text":"Expense Ratio Comparison (%)"}}}},
  "glide_path_timeline":{"type":"bar","data":{"labels":["Years 1-7","Year 8","Year 9","Year 10"],"datasets":[{"label":"Equity %","data":[50,45,40,35],"backgroundColor":"rgba(255, 99, 132, 0.6)"},{"label":"Debt %","data":[50,55,60,65],"backgroundColor":"rgba(54, 162, 235, 0.6)"}]},"options":{"responsive":true,"plugins":{"title":{"display":true,"text":"Goal Timeline: De-risking Glide Path"}},"scales":{"x":{"stacked":true},"y":{"stacked":true,"max":100,"title":{"display":true,"text":"Allocation (%)"}}}}}}
  </script>

  <!-- SCRIPTING -->
  <script>
    function downloadHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'fund_comprehensive_report.html';
      document.body.appendChild(a); // Required for Firefox
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
  
  <script>
    function initializeFundCharts() {
      try {
        if (typeof Chart === 'undefined') { console.error('Chart.js not loaded'); return; }
        let fundData;
        try {
          const dataScript = document.getElementById('fund-chart-data');
          fundData = dataScript ? JSON.parse(dataScript.textContent) : null;
        } catch (e) { console.warn('Chart data parse failed:', e); fundData = null; }
        if (!fundData) { console.error('No fund data available for charts.'); return; }

        // 1. Performance Comparison Chart
        const perfCtx = document.getElementById('fundPerformanceChart');
        if (perfCtx && fundData.performance_comparison) { new Chart(perfCtx, fundData.performance_comparison); }

        // 2. Risk vs Return Scatter Plot (FIXED - with function)
        const riskCtx = document.getElementById('riskReturnChart');
        if (riskCtx && fundData.risk_return_scatter) {
          const config = JSON.parse(JSON.stringify(fundData.risk_return_scatter));
          config.options.plugins = config.options.plugins || {};
          config.options.plugins.tooltip = {
            callbacks: {
              label: function(context) {
                const point = context.dataset.data[context.dataIndex];
                const name = point.fundName || 'Fund';
                return `${name}: Return: ${context.parsed.y.toFixed(2)}%, Risk: ${context.parsed.x.toFixed(2)}`;
              }
            }
          };
          new Chart(riskCtx, config);
        }

        // 3. Portfolio Allocation Doughnut
        const allocCtx = document.getElementById('portfolioAllocationChart');
        if (allocCtx && fundData.portfolio_allocation && fundData.portfolio_allocation.asset_class) { new Chart(allocCtx, fundData.portfolio_allocation.asset_class); }

        // 4. Category Breakdown Pie Chart
        const categoryCtx = document.getElementById('fundCategoryChart');
        if (categoryCtx && fundData.portfolio_allocation && fundData.portfolio_allocation.sub_category) { new Chart(categoryCtx, fundData.portfolio_allocation.sub_category); }

        // 5. Expense Ratio Comparison
        const expenseCtx = document.getElementById('expenseComparisonChart');
        if (expenseCtx && fundData.expense_ratio_comparison) { new Chart(expenseCtx, fundData.expense_ratio_comparison); }

        // 6. Glide Path Chart
        const glideCtx = document.getElementById('glidePathChart');
        if (glideCtx && fundData.glide_path_timeline) { new Chart(glideCtx, fundData.glide_path_timeline); }

      } catch (e) { console.error('Fund chart initialization failed:', e); }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() { setTimeout(initializeFundCharts, 500); });
    } else {
      setTimeout(initializeFundCharts, 500);
    }
  </script>

</body>
</html>