<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive SIP Investment Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-semibold text-gray-800">Comprehensive SIP Investment Plan</h1>
        </header>

        <section id="executive-summary" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Executive Summary</h2>
            <p id="exec-summary">No executive summary available.</p>
        </section>

        <section id="goal-inputs" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Goal Inputs</h2>
            <ul class="list-disc list-inside text-gray-600">
                <li>Goal Type: <span id="goal-type">N/A</span></li>
                <li>Target Amount: <span id="target-amount">N/A</span></li>
                <li>Currency: <span id="currency">N/A</span></li>
                <li>Time Horizon: <span id="time-horizon">N/A</span> years</li>
                <li>Risk Appetite: <span id="risk-appetite">N/A</span></li>
            </ul>
        </section>

        <section id="inflation-adjustment" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Inflation Adjustment</h2>
            <ul class="list-disc list-inside text-gray-600">
                <li>Inflation Rate: <span id="inflation-rate">N/A</span>%</li>
                <li>Adjusted Target Amount: <span id="adjusted-target">N/A</span></li>
            </ul>
        </section>

        <section id="sip-calculation" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">SIP Calculation</h2>
            <ul class="list-disc list-inside text-gray-600">
                <li>Monthly Return: <span id="monthly-return">N/A</span>%</li>
                <li>Required Monthly SIP: <span id="monthly-sip">N/A</span></li>
            </ul>
        </section>

        <section id="asset-allocation-plan" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Asset Allocation Plan</h2>
            <table class="min-w-full">
                <thead>
                    <tr>
                        <th class="text-left font-medium text-gray-700 py-2 px-4 bg-gray-50">Asset Class</th>
                        <th class="text-left font-medium text-gray-700 py-2 px-4 bg-gray-50">Percentage</th>
                    </tr>
                </thead>
                <tbody id="allocation-table-body">
                    <tr>
                        <td class="py-2 px-4">No data available</td>
                        <td class="py-2 px-4">N/A</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Recommended Fund Categories</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h4 class="text-md font-semibold text-gray-700">Equity</h4>
                    <ul id="equity-funds" class="list-disc list-inside text-gray-600">
                        <li>N/A</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-md font-semibold text-gray-700">Debt</h4>
                    <ul id="debt-funds" class="list-disc list-inside text-gray-600">
                        <li>N/A</li>
                    </ul>
                </div>
            </div>
            <div class="mt-2">
                <h4 class="text-md font-semibold text-gray-700">ELSS (Optional)</h4>
                <p id="elss-optional">N/A</p>
            </div>
        </section>

        <section id="allocation-notes" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Allocation Notes</h2>
            <p id="allocation-note">No allocation notes available.</p>
        </section>

        <section id="sip-projection" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">SIP Projection (First 12 Months)</h2>
            <div class="overflow-x-auto">
            <table class="min-w-full">
                <thead>
                    <tr>
                        <th class="text-left font-medium text-gray-700 py-2 px-4 bg-gray-50">Month</th>
                        <th class="text-left font-medium text-gray-700 py-2 px-4 bg-gray-50">Cumulative Contribution</th>
                        <th class="text-left font-medium text-gray-700 py-2 px-4 bg-gray-50">Projected Corpus</th>
                    </tr>
                </thead>
                <tbody id="projection-table-body">
                    <tr>
                        <td class="py-2 px-4">N/A</td>
                        <td class="py-2 px-4">N/A</td>
                        <td class="py-2 px-4">N/A</td>
                    </tr>
                </tbody>
            </table>
            </div>
        </section>

        <section id="key-recommendations" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Key Recommendations</h2>
            <ul class="list-disc list-inside text-gray-600">
                <li>Diversify investments across equity and debt.</li>
                <li>Regularly monitor and adjust portfolio based on market conditions.</li>
            </ul>
        </section>

        <section id="risk-factors" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Risk Factors & Uncertainties</h2>
            <p>Market volatility, inflation, and fund performance can impact returns.</p>
        </section>

        <section id="validation-summary" class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Validation Summary</h2>
            <p>All data sources were validated.</p>
        </section>

        <section id="charts" class="mb-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white shadow rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">SIP Projection Chart</h3>
                    <canvas id="sipProjectionChart" height="300"></canvas>
                </div>
                <div class="bg-white shadow rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Asset Allocation Chart</h3>
                    <canvas id="sipAllocationChart" height="300"></canvas>
                </div>
            </div>
        </section>

        <section id="disclaimer" class="text-sm text-gray-500 mt-8">
            <p>Disclaimer: This report is for informational purposes only and does not constitute financial advice. Consult with a qualified financial advisor before making investment decisions.</p>
        </section>

        <footer class="mt-8 flex justify-between">
            <button onclick="window.print()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Print</button>
            <button id="download-btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Download</button>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var goalInput = window.goal_input_json || {};
            var inflationAdjusted = window.inflation_adjusted_json || {};
            var sipCalc = window.sip_calc_json || {};
            var allocationPlan = window.allocation_plan_json || {};
            var chartData = window.chart_data_json || {};
            var reportPayload = window.report_payload || {};
            var formattedReport = '';
            if(window.T016){
              formattedReport = window.T016.output.formatted_report_T016;
              document.getElementById('executive-summary').innerHTML = window.T016.output.formatted_report_T016.substring(window.T016.output.formatted_report_T016.indexOf('<section id=\'executive-summary\'>'), window.T016.output.formatted_report_T016.indexOf('<section id=\'goal-definition\'>'));
            }


            // Populate Goal Inputs
            document.getElementById('goal-type').textContent = goalInput.goal_type || 'N/A';
            document.getElementById('target-amount').textContent = (goalInput.target_amount ? 'INR ' + goalInput.target_amount.toLocaleString('en-IN') : 'N/A');
            document.getElementById('currency').textContent = goalInput.currency || 'N/A';
            document.getElementById('time-horizon').textContent = goalInput.time_horizon_years || 'N/A';
            document.getElementById('risk-appetite').textContent = goalInput.risk_appetite || 'N/A';

            // Populate Inflation Adjustment
            document.getElementById('inflation-rate').textContent = inflationAdjusted.inflation_pct || 'N/A';
            document.getElementById('adjusted-target').textContent = (inflationAdjusted.adjusted_target ? 'INR ' + inflationAdjusted.adjusted_target.toLocaleString('en-IN') : 'N/A');

            // Populate SIP Calculation
            document.getElementById('monthly-return').textContent = sipCalc.monthly_return_r || 'N/A';
            document.getElementById('monthly-sip').textContent = (sipCalc.monthly_sip ? 'INR ' + sipCalc.monthly_sip.toLocaleString('en-IN') : 'N/A');

            // Populate Asset Allocation Table
            var allocationTableBody = document.getElementById('allocation-table-body');
            allocationTableBody.innerHTML = ''; // Clear default
            var allocationData = reportPayload.allocation || (allocationPlan.equity_percent && allocationPlan.debt_percent ? [
                { asset_class: 'Equity', percentage: allocationPlan.equity_percent },
                { asset_class: 'Debt', percentage: allocationPlan.debt_percent }
            ] : null);

            if (allocationData) {
                allocationData.forEach(function (item) {
                    var row = document.createElement('tr');
                    var assetClassCell = document.createElement('td');
                    assetClassCell.className = 'py-2 px-4';
                    assetClassCell.textContent = item.asset_class;
                    var percentageCell = document.createElement('td');
                    percentageCell.className = 'py-2 px-4';
                    percentageCell.textContent = item.percentage + '%';
                    row.appendChild(assetClassCell);
                    row.appendChild(percentageCell);
                    allocationTableBody.appendChild(row);
                });
            } else {
                var row = document.createElement('tr');
                var cell = document.createElement('td');
                cell.className = 'py-2 px-4';
                cell.textContent = 'No data available';
                row.appendChild(cell);
                allocationTableBody.appendChild(row);
            }

            // Populate Fund Categories
            var equityFundsList = document.getElementById('equity-funds');
            var debtFundsList = document.getElementById('debt-funds');

            equityFundsList.innerHTML = ''; // Clear default
            debtFundsList.innerHTML = ''; // Clear default

            var equityFunds = allocationPlan.recommended_fund_categories && allocationPlan.recommended_fund_categories.equity ? allocationPlan.recommended_fund_categories.equity : null;
            var debtFunds = allocationPlan.recommended_fund_categories && allocationPlan.recommended_fund_categories.debt ? allocationPlan.recommended_fund_categories.debt : null;

            if (equityFunds) {
                equityFunds.forEach(function (fund) {
                    var listItem = document.createElement('li');
                    listItem.textContent = fund;
                    equityFundsList.appendChild(listItem);
                });
            } else {
                var listItem = document.createElement('li');
                listItem.textContent = 'N/A';
                equityFundsList.appendChild(listItem);
            }

            if (debtFunds) {
                debtFunds.forEach(function (fund) {
                    var listItem = document.createElement('li');
                    listItem.textContent = fund;
                    debtFundsList.appendChild(listItem);
                });
            } else {
                var listItem = document.createElement('li');
                listItem.textContent = 'N/A';
                debtFundsList.appendChild(listItem);
            }

            // Populate ELSS Optional
            document.getElementById('elss-optional').textContent = allocationPlan.recommended_fund_categories && allocationPlan.recommended_fund_categories.elss_optional ? 'Yes' : 'No';

             // Populate Allocation Notes
             var riskAppetite = goalInput.risk_appetite || 'moderate'; // Default to moderate
            var notes = allocationPlan.notes || {};
            var allocationNote = notes[riskAppetite.toLowerCase()] || 'No specific note available for this risk appetite.';
            document.getElementById('allocation-note').textContent = allocationNote;

            // SIP Projection Table
            var projectionTableBody = document.getElementById('projection-table-body');
            projectionTableBody.innerHTML = '';

            if (chartData.projection && chartData.projection.labels && chartData.projection.datasets && chartData.projection.datasets.cumulative_contribution && chartData.projection.datasets.projected_corpus) {
                var labels = chartData.projection.labels;
                var cumulativeContribution = chartData.projection.datasets.cumulative_contribution;
                var projectedCorpus = chartData.projection.datasets.projected_corpus;

                var numMonths = Math.min(12, labels.length, cumulativeContribution.length, projectedCorpus.length);
                for (let i = 0; i < numMonths; i++) {
                    var row = document.createElement('tr');
                    var monthCell = document.createElement('td');
                    monthCell.className = 'py-2 px-4';
                    monthCell.textContent = labels[i];
                    var contributionCell = document.createElement('td');
                    contributionCell.className = 'py-2 px-4';
                    contributionCell.textContent = 'INR ' + cumulativeContribution[i].toLocaleString('en-IN');
                    var corpusCell = document.createElement('td');
                    corpusCell.className = 'py-2 px-4';
                    corpusCell.textContent = 'INR ' + projectedCorpus[i].toLocaleString('en-IN');
                    row.appendChild(monthCell);
                    row.appendChild(contributionCell);
                    row.appendChild(corpusCell);
                    projectionTableBody.appendChild(row);
                }
            } else {
                var row = document.createElement('tr');
                var cell = document.createElement('td');
                cell.className = 'py-2 px-4';
                cell.textContent = 'No data available';
                row.appendChild(cell);
                projectionTableBody.appendChild(row);
            }

            // Chart Data
            var allocationLabels = (chartData.allocation && chartData.allocation.labels) ? chartData.allocation.labels : ['Equity', 'Debt'];
            var allocationDataValues = (chartData.allocation && chartData.allocation.data) ? chartData.allocation.data : [60, 40];

            var projectionLabels = (chartData.projection && chartData.projection.labels) ? chartData.projection.labels : [];
            var projectedCorpusData = (chartData.projection && chartData.projection.datasets && chartData.projection.datasets.projected_corpus) ? chartData.projection.datasets.projected_corpus : [];
            var cumulativeContributionData = (chartData.projection && chartData.projection.datasets && chartData.projection.datasets.cumulative_contribution) ? chartData.projection.datasets.cumulative_contribution : [];

            // Charts
            var projectionChartCanvas = document.getElementById('sipProjectionChart').getContext('2d');
            var allocationChartCanvas = document.getElementById('sipAllocationChart').getContext('2d');

            new Chart(projectionChartCanvas, {
                type: 'line',
                data: {
                    labels: projectionLabels,
                    datasets: [
                        {
                            label: 'Projected Corpus',
                            data: projectedCorpusData,
                            borderColor: 'rgb(75, 192, 192)',
                            tension: 0.1,
                            fill: false
                        },
                        {
                            label: 'Cumulative Contribution',
                            data: cumulativeContributionData,
                            borderColor: 'rgb(255, 99, 132)',
                            tension: 0.1,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            new Chart(allocationChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: allocationLabels,
                    datasets: [{
                        data: allocationDataValues,
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 99, 132, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Download Functionality
            document.getElementById('download-btn').addEventListener('click', function () {
                var blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
                var a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'comprehensive_report.html';
                a.click();
            });
        });
    </script>
</body>
</html>