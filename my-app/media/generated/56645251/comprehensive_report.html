<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comprehensive SIP Financial Plan Report</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; margin: 0; padding: 0; background-color: #f8f9fa; color: #212529; }
    .container { max-width: 1000px; margin: 20px auto; padding: 20px; background-color: #ffffff; box-shadow: 0 0 15px rgba(0,0,0,0.1); border-radius: 8px; }
    h1, h2, h3 { color: #343a40; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-top: 20px; }
    h1 { font-size: 2em; text-align: center; }
    h2 { font-size: 1.5em; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #dee2e6; padding: 12px; text-align: left; }
    th { background-color: #f1f3f5; font-weight: 600; }
    tr:nth-child(even) { background-color: #f8f9fa; }
    .executive-summary, .key-recommendations ul, .risk-factors ul { line-height: 1.6; }
    .key-recommendations li { margin-bottom: 10px; }
    .risk-factors { background-color: #fff9f9; border-left: 4px solid #ef4444; padding: 15px; margin-top: 15px; }
    .callout { background-color: #fffbeb; border-left: 4px solid #f59e0b; padding: 15px; margin: 15px 0; border-radius: 4px; }
    .no-print { text-align: center; margin-top: 30px; padding: 20px; border-top: 1px solid #e9ecef; }
    button { background-color: #0d6efd; color: white; border: none; padding: 12px 24px; font-size: 16px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; margin: 5px; }
    button:hover { background-color: #0b5ed7; }
    @media print { .no-print { display: none; } }
  </style>
</head>
<body>
  <div class="container">
    <!-- 1) Title / Header -->
    <header>
      <h1>üìä Comprehensive SIP Financial Plan</h1>
      <p style="text-align:center; color:#6c757d;">Goal: Child Marriage Fund</p>
    </header>

    <!-- 2) Executive Summary -->
    <section id="executive-summary">
      <h2>üéØ Executive Summary</h2>
      <div class="executive-summary">
        <p>This report outlines a detailed financial plan to achieve the goal of a <strong>Child Marriage fund</strong> over a <strong>7-year (84-month)</strong> period. The initial target of ‚Çπ1,00,00,000 has been adjusted for a projected 5.5% annual inflation, resulting in a final required corpus of <strong>‚Çπ1,45,46,791.61</strong>. To meet this target with a 'Moderate' risk profile and an assumed annual return of 10%, a monthly Systematic Investment Plan (SIP) of <strong>‚Çπ1,20,216.29</strong> is required.</p>
        <p>The recommended asset allocation is a balanced <strong>50% in Equity and 50% in Debt</strong>. While specific equity fund categories have been identified, a critical gap exists as no suitable debt funds were provided for analysis. Therefore, the plan is considered <strong>partially complete</strong>. The highest priority is to source and select appropriate debt funds to complete the portfolio.</p>
      </div>
    </section>

    <!-- 3) Goal Inputs -->
    <section id="goal-inputs">
      <h2>üìã Goal Inputs & Investor Profile</h2>
      <table>
        <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
        <tbody>
          <tr><td><strong>Goal Type</strong></td><td>Child Marriage</td></tr>
          <tr><td><strong>Target Amount (Initial)</strong></td><td>‚Çπ1,00,00,000</td></tr>
          <tr><td><strong>Time Horizon</strong></td><td>7 Years (84 Months)</td></tr>
          <tr><td><strong>Risk Appetite</strong></td><td>Moderate</td></tr>
        </tbody>
      </table>
    </section>

    <!-- 4) Inflation Adjustment -->
    <section id="inflation-adjustment">
      <h2>üíπ Inflation Adjustment Analysis</h2>
       <table>
        <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
        <tbody>
          <tr><td>Unadjusted Target Amount</td><td>‚Çπ1,00,00,000</td></tr>
          <tr><td>Assumed Annual Inflation</td><td>5.5%</td></tr>
          <tr><td><strong>Inflation-Adjusted Target Corpus</strong></td><td><strong>‚Çπ1,45,46,791.61</strong></td></tr>
        </tbody>
      </table>
    </section>

    <!-- 5) SIP Calculation -->
    <section id="sip-calculation">
      <h2>üßÆ Required Monthly SIP Calculation</h2>
      <div class="callout">
        <p><strong>Note on Precision:</strong> A quality assurance check found a minor inaccuracy in this calculation. The calculated SIP of ‚Çπ1,20,216.29 slightly overshoots the target. A more precise calculation suggests a monthly SIP of approximately ‚Çπ1,20,119.50. This difference is low-impact but noted for full transparency.</p>
      </div>
      <table>
        <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
        <tbody>
          <tr><td>Adjusted Target Corpus</td><td>‚Çπ1,45,46,791.61</td></tr>
          <tr><td>Assumed Annual Rate of Return</td><td>10%</td></tr>
          <tr><td><strong>Required Monthly SIP</strong></td><td><strong>‚Çπ1,20,216.29</strong></td></tr>
        </tbody>
      </table>
    </section>

    <!-- 6) Asset Allocation Plan -->
    <section id="asset-allocation">
      <h2>‚öñÔ∏è Asset Allocation Plan</h2>
      <p>The strategy is a balanced <strong>50% Equity / 50% Debt</strong> allocation to align with a 'Moderate' risk profile. The plan is incomplete due to missing input data for debt instruments.</p>
      <table>
        <thead><tr><th>Asset Class</th><th>Fund Category</th><th>Allocation (%)</th><th>Status</th></tr></thead>
        <tbody>
          <tr><td>Equity</td><td>Large Cap Funds</td><td>25%</td><td>Recommended</td></tr>
          <tr><td>Equity</td><td>Mid Cap Funds</td><td>25%</td><td>Recommended</td></tr>
          <tr><td>Debt</td><td>Corporate Bond / Short Duration</td><td>50%</td><td style="color: #DC2626; font-weight: bold;">CRITICAL: To Be Determined</td></tr>
        </tbody>
      </table>
    </section>

    <!-- 7) Key Recommendations -->
    <section id="key-recommendations">
        <h2>üîë Key Recommendations</h2>
        <div class="key-recommendations">
            <ul>
                <li><strong>DEBT FUND SOURCING (High Priority):</strong> Initiate research to identify suitable 'Corporate Bond Funds' and 'Short Duration Funds' to fulfill the remaining 50% debt allocation. This step is critical before deploying capital.</li>
                <li><strong>Implement SIP:</strong> Once the full 50/50 portfolio is finalized, begin the monthly SIP of ‚Çπ1,20,216.29 without delay to maximize the benefits of compounding over the 84-month horizon.</li>
                <li><strong>Annual Review:</strong> Conduct an annual review of the portfolio's performance and asset allocation. Rebalance if necessary to ensure it remains aligned with the financial goal and risk tolerance.</li>
            </ul>
        </div>
    </section>

    <!-- 8) Risk Factors & Uncertainties -->
    <section id="risk-factors">
      <h2>œÅŒØ Risk Factors & Uncertainties</h2>
      <div class="risk-factors">
        <p>All investments carry inherent risks. It is crucial to understand these factors before proceeding. The most significant and immediate risk for this plan is its <strong>incomplete nature</strong>. Investing only in the recommended equity funds would create a 100% equity portfolio, which represents a 'High' or 'Very High' risk profile and is severely misaligned with the user's stated 'moderate' risk appetite. This must be rectified before any capital is deployed.</p>
        <p>Beyond this, investors should be aware of several market-related risks:</p>
        <ul>
            <li><strong>Market Risk:</strong> The value of equity investments can fluctuate significantly due to market volatility, economic changes, and geopolitical events. The assumed 10% annual return is a projection, not a guarantee, and actual returns may be lower.</li>
            <li><strong>Inflation Risk:</strong> The plan assumes an average annual inflation of 5.5%. If actual inflation is consistently higher, the final corpus may have less purchasing power than intended, potentially requiring an increase in the SIP amount in the future.</li>
            <li><strong>Interest Rate Risk:</strong> For the debt portion of the portfolio (once selected), changes in interest rates can affect the value of bond funds. Rising rates typically cause the price of existing bonds to fall.</li>
            <li><strong>Fund Performance Risk:</strong> The performance of any specific mutual fund is not guaranteed and depends on the fund manager's skill and strategy. Past performance is not indicative of future results.</li>
        </ul>
      </div>
    </section>

    <!-- 9) Charts Section -->
    <section id="sip-charts">
        <h2>üìä SIP Projection & Allocation Charts</h2>
        <div style="display: block;">
            <!-- Asset Allocation FIRST (TOP) -->
            <div class="chart-container" style="margin-bottom: 30px; text-align: center; border: 1px solid #dee2e6; padding: 20px; border-radius: 8px;">
                <h3>Asset Allocation</h3>
                <div style="max-width: 500px; margin: 0 auto;">
                    <canvas id="sipAllocationChart" width="400" height="300" style="max-width: 100%; height: auto;"></canvas>
                </div>
            </div>
            
            <!-- SIP Growth Projection SECOND (BOTTOM) -->
            <div class="chart-container" style="text-align: center; border: 1px solid #dee2e6; padding: 20px; border-radius: 8px;">
                <h3>SIP Growth Projection</h3>
                <div style="max-width: 800px; margin: 0 auto;">
                    <canvas id="sipProjectionChart" width="600" height="400" style="max-width: 100%; height: auto;"></canvas>
                </div>
            </div>
        </div>
    </section>

    <!-- 10) Monthly Projection Table -->
    <section id="monthly-projection">
      <h2>üìà Monthly Projection (First 12 Months)</h2>
      <table>
        <thead>
          <tr><th>Month</th><th>Monthly Contribution</th><th>Cumulative Contribution</th><th>Projected Corpus Value</th></tr>
        </thead>
        <tbody id="projection-table-body">
          <!-- Rows will be dynamically inserted here -->
        </tbody>
      </table>
    </section>

    <!-- 11) Print/Download Controls -->
    <div class="no-print">
      <button onclick="window.print()">Print Report</button>
      <button onclick="downloadHTML()">Download HTML</button>
    </div>

  </div>

  <!-- Data Embedding -->
  <script id="sip-chart-data" type="application/json">
    {"projection":{"labels":["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84"],"datasets":{"cumulative_contribution":[120216.29,240432.58,360648.87,480865.16,601081.45,721297.74,841514.03,961730.32,1081946.61,1202162.9,1322379.19,1442595.48,1562811.77,1683028.06,1803244.35,1923460.64,2043676.93,2163893.22,2284109.51,2404325.8,2524542.09,2644758.38,2764974.67,2885190.96,3005407.25,3125623.54,3245839.83,3366056.12,3486272.41,3606488.7,3726704.99,3846921.28,3967137.57,4087353.86,4207570.15,4327786.44,4448002.73,4568219.02,4688435.31,4808651.6,4928867.89,5049084.18,5169300.47,5289516.76,5409733.05,5529949.34,650165.63,5770381.92,5890598.21,6010814.5,6131030.79,6251247.08,6371463.37,6491679.66,6611895.95,6732112.24,6852328.53,6972544.82,7092761.11,7212977.4,7333193.69,7453409.98,7573626.27,7693842.56,7814058.85,7934275.14,8054491.43,8174707.72,8294924.01,8415140.3,8535356.59,8655572.88,8775789.17,8896005.46,9016221.75,9136438.04,9256654.33,9376870.62,9497086.91,9617303.2,9737519.49,9857735.78,9977952.07,10098168.36],"projected_corpus":[120216.29,241434.4,363666.21,486913.62,611178.58,736463.07,862769.1,990098.69,1118453.86,1247836.65,1378249.12,1509693.36,1642171.49,1775685.64,1910237.94,2045830.55,2182465.64,2320145.38,2458872,2598647.77,2739474.96,2881355.88,3024292.85,3168288.29,3313344.66,3459464.4,3606650,3754903.95,3904228.82,4054627.19,4206101.62,4358654.67,4512288.93,4667007,4822811.49,4979705.02,5137689.91,5296768.66,5456943.73,5618217.63,5780592.81,5944071.75,6108657.01,6274351.15,6441156.74,6609076.38,6778112.68,6948268.28,7119545.85,7291948.07,7465477.6,7640137.11,7815929.29,7992856.83,8170922.47,8350128.98,8530479.16,8711975.79,8894621.62,9078419.46,9263372.16,9449482.59,9636753.64,9825188.22,10014789.26,10205559.69,10397502.48,10590620.66,10784917.2,10980395.14,11177057.57,11374907.59,11573948.35,11774182.99,11975614.67,12178246.59,12382081.94,12587123.95,12793375.98,13000841.45,13209523.8,13419426.49,13630552.95,13842906.62]}},"allocation":{"labels":["Equity","Debt"],"data":[50,50]}}
  </script>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // Function to format numbers as Indian Rupees
    function formatCurrency(value) {
        return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
    }

    // Populate Monthly Projection Table
    function populateTable() {
      let tableData;
      try {
        const script = document.getElementById('sip-chart-data');
        tableData = script ? JSON.parse(script.textContent) : null;
      } catch (e) {
        console.warn('Could not parse table data');
        tableData = null;
      }

      const tableBody = document.getElementById('projection-table-body');
      if (!tableBody) return;

      if (tableData && tableData.projection && tableData.projection.datasets) {
        const monthlySip = 120216.29;
        const cumulative = tableData.projection.datasets.cumulative_contribution;
        const corpus = tableData.projection.datasets.projected_corpus;

        for (let i = 0; i < 12; i++) {
          const row = `<tr>
            <td>${i + 1}</td>
            <td>${formatCurrency(monthlySip)}</td>
            <td>${formatCurrency(cumulative[i] || 0)}</td>
            <td>${formatCurrency(corpus[i] || 0)}</td>
          </tr>`;
          tableBody.innerHTML += row;
        }
      } else {
        tableBody.innerHTML = '<tr><td colspan="4">Projection data not available.</td></tr>';
      }
    }

    // Chart Rendering (v11 FIXED)
    function initCharts() {
      if (typeof Chart === 'undefined') {
        console.error('Chart.js not loaded');
        return;
      }
      
      let data;
      try {
        const script = document.getElementById('sip-chart-data');
        data = script ? JSON.parse(script.textContent) : null;
      } catch (e) {
        console.warn('Chart data parse failed');
        data = null;
      }
      
      // Enhanced fallback with complete timeline
      if (!data) {
        data = {
          projection: { labels: ["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84","M85","M86","M87","M88","M89","M90","M91","M92","M93","M94","M95","M96","M97","M98","M99","M100","M101","M102","M103","M104","M105","M106","M107","M108","M109","M110","M111","M112","M113","M114","M115","M116","M117","M118","M119","M120"], datasets: { cumulative_contribution: [25000,50000,75000,100000,125000,150000,175000,200000,225000,250000,275000,300000,325000,350000,375000,400000,425000,450000,475000,500000,525000,550000,575000,600000,625000,650000,675000,700000,725000,750000,775000,800000,825000,850000,875000,900000,925000,950000,975000,1000000,1025000,1050000,1075000,1100000,1125000,1150000,1175000,1200000,1225000,1250000,1275000,1300000,1325000,1350000,1375000,1400000,1425000,1450000,1475000,1500000,1525000,1550000,1575000,1600000,1625000,1650000,1675000,1700000,1725000,1750000,1775000,1800000,1825000,1850000,1875000,1900000,1925000,1950000,1975000,2000000,2025000,2050000,2075000,2100000,2125000,2150000,2175000,2200000,2225000,2250000,2275000,2300000,2325000,2350000,2375000,2400000,2425000,2450000,2475000,2500000,2525000,2550000,2575000,2600000,2625000,2650000,2675000,2700000,2725000,2750000,2775000,2800000,2825000,2850000,2875000,2900000,2925000,2950000,2975000,3000000], projected_corpus: [25250,50755,76519,102543,128831,155386,182212,209312,236692,264356,292308,320552,349093,377935,407082,436540,466312,496404,526821,557567,588648,620068,651832,683945,716412,749239,782430,815991,849927,884244,918948,954045,989540,1025440,1061750,1098476,1135626,1173205,1211220,1249678,1288586,1327951,1367780,1408080,1448859,1490125,1531885,1574148,1616922,1660215,1704035,1748392,1793293,1838750,1884770,1931365,1978544,2026318,2074697,2123692,2173315,2223577,2274490,2326066,2378316,2431252,2484887,2539233,2594302,2650106,2706658,2763971,2822058,2880932,2940607,3001097,3062415,3124575,3187591,3251477,3316247,3381916,3448499,3516010,3584465,3653879,3724267,3795645,3868028,3941432,4015873,4091366,4167928,4245574,4324322,4404188,4485188,4567340,4650661,4735168,4821880,4909814,4999990,5091425,5184139,5278150,5373478,5470142,5568161,5667556,5768346,5870552,5974194,6079293,6185870,6293947,6403545,6514686,6627391] } } , 
          allocation: { labels: ["Equity", "Debt"], data: [70, 30] } };
      }
      
      const allocCtx = document.getElementById('sipAllocationChart');
      if (allocCtx) {
        new Chart(allocCtx, {
          type: 'doughnut',
          data: { labels: data.allocation.labels, datasets: [{ data: data.allocation.data, backgroundColor: ['#3B82F6', '#10B981'], borderWidth: 2 }] },
          options: { responsive: true, maintainAspectRatio: true, aspectRatio: 1.33, plugins: { legend: { position: 'bottom', labels: { padding: 15 } } } }
        });
      }
      
      const projCtx = document.getElementById('sipProjectionChart');
      if (projCtx) {
        new Chart(projCtx, {
          type: 'line',
          data: {
            labels: data.projection.labels,
            datasets: [{
              label: 'Projected Corpus',
              data: data.projection.datasets.projected_corpus,
              borderColor: '#3B82F6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }, {
              label: 'Cumulative Contribution', 
              data: data.projection.datasets.cumulative_contribution,
              borderColor: '#EF4444',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              fill: false,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }]
          },
          options: { 
            responsive: true, maintainAspectRatio: true, aspectRatio: 1.5, interaction: { mode: 'nearest', intersect: false },
            scales: {
              x: { title: { display: true, text: 'Time Period (Months)' }, ticks: { maxTicksLimit: 10 } },
              y: { beginAtZero: true, title: { display: true, text: 'Amount (INR)' }, ticks: { callback: function(value) { return '‚Çπ' + (value/100000).toFixed(1) + 'L'; } } }
            },
            plugins: { tooltip: { mode: 'index', intersect: false } }
          }
        });
      }
    }

    // Download Function
    function downloadHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'comprehensive_sip_report.html';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Initialize everything on load
    document.addEventListener('DOMContentLoaded', function() {
      populateTable();
      setTimeout(initCharts, 300);
    });
  </script>
</body>
</html>