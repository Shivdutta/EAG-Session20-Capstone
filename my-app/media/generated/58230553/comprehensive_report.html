<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Strategic Retirement Investment Plan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 20px; background-color: #f9fafb; color: #1f2937; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h1 { font-size: 2.25rem; font-weight: bold; color: #111827; border-bottom: 2px solid #3B82F6; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
    h2 { font-size: 1.5rem; font-weight: bold; color: #111827; margin-top: 2rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; }
    table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
    th { background-color: #f8f9fa; font-weight: 600; }
    p { line-height: 1.6; margin-bottom: 1rem; }
    ul, ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    li { margin-bottom: 0.5rem; }
    .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; }
    .chart-container { padding: 1.5rem; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .chart-container h3 { text-align: center; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
    .executive-summary { background-color: #eff6ff; border-left: 4px solid #3B82F6; padding: 1.5rem; margin-bottom: 2rem; border-radius: 4px; }
    .no-print { display: block; }
    @media print {
      .no-print { display: none; }
      body { padding: 0; background-color: #fff; }
      .container { box-shadow: none; border: none; padding: 0.5rem; }
      h1, h2 { margin-top: 1.5rem; }
      .charts-grid { grid-template-columns: 1fr; } /* Stack charts for printing */
      canvas { max-height: 300px !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Strategic Retirement Investment Plan</h1>
    <div class="executive-summary">
      <h2 id="executive-summary">üéØ Executive Summary</h2>
      <p>This report outlines a tailored retirement portfolio for a 50-year-old investor with a <b>10-year horizon</b> and a 'Moderate' risk appetite. The primary objective is to achieve an inflation-adjusted target corpus of <b>‚Çπ5.12 Crore</b> by age 60, requiring a monthly systematic investment of <b>‚Çπ2,49,868</b>. The strategy is built on a 'Core and Satellite' principle, allocating capital to four top-ranked mutual funds. A cornerstone of this plan is a dynamic <b>three-phase asset allocation glide path</b>, designed to systematically reduce risk as the retirement goal approaches, starting with a 55% equity allocation for growth. The plan also identifies a minor projected corpus shortfall of approximately ‚Çπ4.87 lakh and presents clear, actionable recommendations to ensure the financial goal is met in full.</p>
    </div>
    <section id="investment-profile">
      <h2 id="retirement-investment-profile">üë§ Retirement Investment Profile</h2>
      <div class="table-container">
        <table>
          <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
          <tbody>
            <tr><td><b>Goal Type</b></td><td>Retirement</td></tr>
            <tr><td><b>Current Age</b></td><td>50 Years</td></tr>
            <tr><td><b>Target Retirement Age</b></td><td>60 Years</td></tr>
            <tr><td><b>Investment Horizon</b></td><td>10 Years</td></tr>
            <tr><td><b>Risk Appetite</b></td><td>Moderate</td></tr>
            <tr><td><b>Unadjusted Target Corpus</b></td><td>‚Çπ3,00,00,000</td></tr>
            <tr><td><b>Assumed Inflation Rate</b></td><td>5.5% per annum</td></tr>
            <tr><td><b>Inflation-Adjusted Target Corpus</b></td><td><b>‚Çπ5,12,44,334</b></td></tr>
            <tr><td><b>Required Monthly SIP</b></td><td><b>‚Çπ2,49,868</b></td></tr>
            <tr><td><b>Assumed Annualized Return</b></td><td>10.0%</td></tr>
          </tbody>
        </table>
      </div>
    </section>
    <section id="asset-allocation">
      <h2 id="asset-allocation-strategy">üß© Asset Allocation Strategy</h2>
      <p>The portfolio is constructed based on a 'Core and Satellite' philosophy to balance stable growth with high-alpha opportunities. The initial allocation is set for the <b>Growth Phase (Years 1-4)</b> of the investment journey.</p>
      <ul>
        <li><b>Total Monthly SIP:</b> ‚Çπ2,49,868</li>
        <li><b>Initial Equity Allocation:</b> <b>55%</b> (‚Çπ1,37,427)</li>
        <li><b>Initial Debt Allocation:</b> <b>45%</b> (‚Çπ1,12,441)</li>
      </ul>
      <p>The core of the portfolio (71%) is anchored by a stable Large Cap equity fund and a high-quality Corporate Bond fund. The satellite component (29%) includes a high-growth Mid Cap fund and a low-volatility Short Duration fund to enhance returns and manage risk.</p>
    </section>
    <section id="fund-performance">
      <h2 id="fund-performance-analysis">üìà Fund Performance Analysis</h2>
      <p>The following table details the key performance and risk metrics for the four recommended funds, which were selected based on a rigorous quantitative scoring model.</p>
      <div class="table-container">
        <table>
          <thead><tr><th>Fund Name</th><th>Category</th><th>1Y CAGR</th><th>3Y CAGR</th><th>5Y CAGR</th><th>Sharpe Ratio</th><th>Std. Dev.</th><th>Expense Ratio</th><th>Max Drawdown</th></tr></thead>
          <tbody>
            <tr><td><b>ICICI Prudential Bluechip Fund</b></td><td>Large Cap</td><td>38.0%</td><td>20.0%</td><td>18.0%</td><td>1.25</td><td>15.0%</td><td>0.92%</td><td>-21.0%</td></tr>
            <tr><td><b>PGIM India Midcap Opportunities Fund</b></td><td>Mid Cap</td><td>53.0%</td><td>31.0%</td><td>25.0%</td><td>1.45</td><td>18.0%</td><td>0.45%</td><td>-29.0%</td></tr>
            <tr><td><b>HDFC Corporate Bond Fund</b></td><td>Corporate Bond</td><td>7.5%</td><td>6.8%</td><td>7.2%</td><td>1.55</td><td>2.5%</td><td>0.24%</td><td>-4.0%</td></tr>
            <tr><td><b>ICICI Prudential Short Term Fund</b></td><td>Short Duration</td><td>7.1%</td><td>6.2%</td><td>6.5%</td><td>1.85</td><td>1.5%</td><td>0.35%</td><td>-1.0%</td></tr>
          </tbody>
        </table>
      </div>
    </section>
    <section id="top-recommendations">
      <h2 id="top-fund-recommendations">üèÜ Top Fund Recommendations (Initial Phase)</h2>
      <p>The total monthly SIP of ‚Çπ2,49,868 is allocated across the following four funds, which ranked highest in their respective categories for a 'Moderate' risk profile.</p>
      <div class="table-container">
        <table>
          <thead><tr><th>Fund Name & Category</th><th>Allocation %</th><th>Monthly Amount</th><th>Weighted Score</th><th>Rationale</th></tr></thead>
          <tbody>
            <tr><td><b>ICICI Prudential Bluechip Fund</b><br/><i>(Large Cap)</i></td><td>44%</td><td>‚Çπ1,09,942</td><td>0.86</td><td>Core portfolio holding for stable growth from India's leading companies. Top-ranked for its balanced scorecard.</td></tr>
            <tr><td><b>PGIM India Midcap Opportunities Fund</b><br/><i>(Mid Cap)</i></td><td>11%</td><td>‚Çπ27,485</td><td>0.92</td><td>Satellite holding for higher growth potential. Highest-scoring fund in the analysis due to strong risk-adjusted returns.</td></tr>
            <tr><td><b>HDFC Corporate Bond Fund</b><br/><i>(Corporate Bond)</i></td><td>27%</td><td>‚Çπ67,464</td><td>0.88</td><td>Core debt holding for income generation, providing higher yield than sovereign bonds with high safety.</td></tr>
            <tr><td><b>ICICI Prudential Short Term Fund</b><br/><i>(Short Duration)</i></td><td>18%</td><td>‚Çπ44,977</td><td>0.90</td><td>Offers stability and liquidity to the debt portion, with lower sensitivity to interest rate changes. Top-ranked for consistency.</td></tr>
          </tbody>
        </table>
      </div>
    </section>
    <section id="glide-path">
      <h2 id="portfolio-construction-glide-path">‚úàÔ∏è Portfolio Construction & Glide Path</h2>
      <p>To manage risk effectively as retirement nears, the portfolio's asset allocation will shift according to a pre-defined glide path. This de-risking strategy is crucial for capital preservation in the final years.</p>
      <div class="table-container">
        <table>
          <thead><tr><th>Phase</th><th>Timeline (Investor Age)</th><th>Equity %</th><th>Debt %</th><th>Rationale</th></tr></thead>
          <tbody>
            <tr><td><b>Phase 1: Growth</b></td><td>Years 1-4 (50-54)</td><td><b>55%</b></td><td><b>45%</b></td><td>Maximize corpus accumulation while the time horizon is longest. The current portfolio is structured for this phase.</td></tr>
            <tr><td><b>Phase 2: Consolidation</b></td><td>Years 5-7 (55-57)</td><td><b>50%</b></td><td><b>50%</b></td><td>Begin a gradual shift towards capital preservation by reducing equity exposure and increasing debt allocation.</td></tr>
            <tr><td><b>Phase 3: Preservation</b></td><td>Years 8-10 (58-60)</td><td><b>40%</b></td><td><b>60%</b></td><td>Significantly reduce equity risk to protect the accumulated corpus from market downturns just before retirement.</td></tr>
          </tbody>
        </table>
      </div>
    </section>
    <section id="risk-analysis">
      <h2 id="risk-analysis">‚ö†Ô∏è Risk Analysis</h2>
      <p>A comprehensive understanding of potential risks is essential. This portfolio is subject to several market and instrument-specific risks, which are actively managed by the proposed strategy.</p>
      <ul>
        <li><b>Market Risk:</b> With a 55% initial allocation to equities, the portfolio is inherently exposed to market volatility and price fluctuations. A significant market downturn, especially in the years leading up to retirement, could adversely impact the final corpus value. This is known as the 'sequence of returns' risk. <b>Mitigation:</b> The primary tool to counter this risk is the <b>structured three-phase glide path</b>, which systematically reduces equity exposure from 55% to 40% over the 10-year period, prioritizing capital preservation in the final, most critical years.</li>
        <li><b>Interest Rate Risk:</b> The debt portion of the portfolio, particularly the Corporate Bond fund, is sensitive to changes in prevailing interest rates. A rising interest rate environment can lead to a temporary MTM (mark-to-market) loss, causing a fall in the NAV of these funds. <b>Mitigation:</b> The portfolio diversifies its debt holdings by including a Short Duration fund, which has a much lower sensitivity to interest rate changes, thus cushioning the overall debt portfolio from volatility.</li>
        <li><b>Credit Risk:</b> The HDFC Corporate Bond fund invests in debt instruments issued by corporations, which carries the risk of default if the issuer fails to make payments. <b>Mitigation:</b> This risk is minimized by selecting a top-tier fund that predominantly invests in high-credit-quality paper (rated AA+ and above), significantly reducing the probability of default.</li>
        <li><b>Inflation Risk:</b> The entire plan is based on an assumed inflation rate of 5.5%. If the actual long-term inflation rate is consistently higher, the purchasing power and real value of the final retirement corpus could be eroded. <b>Mitigation:</b> The significant allocation to equity is designed to provide returns that outpace inflation over the long term, thereby ensuring the growth of real wealth.</li>
      </ul>
    </section>
    <section id="implementation-roadmap">
      <h2 id="implementation-roadmap">üöÄ Implementation Roadmap</h2>
      <p>To put this plan into action, please follow these concrete next steps:</p>
      <ol>
        <li><b>Address Shortfall:</b> Finalize and commit to one of the proposed solutions for the minor corpus shortfall (detailed in the 'Goal Timeline Scenarios' section below).</li>
        <li><b>Complete KYC:</b> Ensure your Know Your Customer (KYC) documentation is complete and verified for all recommended Asset Management Companies (AMCs): ICICI Prudential, PGIM India, and HDFC.</li>
        <li><b>Set Up SIPs:</b> Initiate four separate monthly Systematic Investment Plans (SIPs) with the exact amounts specified in the 'Top Fund Recommendations' table.</li>
        <li><b>Automate Investments:</b> Set up automated debit mandates from your bank account for each SIP to ensure investment discipline and consistency.</li>
        <li><b>Schedule Reviews:</b> Set a recurring calendar reminder for an annual portfolio review and rebalancing. Pay special attention to the end of year 4 and year 7 to execute the glide path phase transitions.</li>
      </ol>
    </section>
    <section id="comparison-charts">
      <h2>üìä Comparison Charts</h2>
      <div class="charts-grid">
        <div class="chart-container"><h3>Recommended Fund Performance (CAGR %)</h3><canvas id="performanceComparisonChart"></canvas></div>
        <div class="chart-container"><h3>Risk vs. Return Analysis</h3><canvas id="riskReturnScatterChart"></canvas></div>
        <div class="chart-container"><h3>Portfolio Allocation by Fund Category</h3><canvas id="portfolioAllocationChart"></canvas></div>
        <div class="chart-container"><h3>Expense Ratio Comparison</h3><canvas id="expenseRatioChart"></canvas></div>
        <div class="chart-container"><h3>10-Year Asset Allocation Glide Path</h3><canvas id="glidePathChart"></canvas></div>
      </div>
    </section>
    <section id="rebalancing-strategy">
      <h2 id="rebalancing-strategy">üîÑ Rebalancing Strategy</h2>
      <p>A disciplined monitoring and rebalancing strategy is essential for maintaining the portfolio's intended risk profile. We recommend a <b>'review quarterly, rebalance annually'</b> approach. Rebalancing should be triggered under two conditions:</p>
      <ol>
        <li><b>Deviation-Based:</b> If any primary asset class (total equity or total debt) deviates by more than 5% from its target allocation for the current glide path phase (e.g., if equity grows to 60% in Phase 1).</li>
        <li><b>Time-Based (Glide Path):</b> The transitions between phases (from 55/45 to 50/50 at the end of year 4, and to 40/60 at the end of year 7) are mandatory rebalancing events. These should be executed gradually over 1-2 months to avoid the risks of timing the market.</li>
      </ol>
    </section>
    <section id="tax-optimization">
      <h2 id="tax-optimization">üí∞ Tax Optimization</h2>
      <p>Rebalancing actions and future redemptions may trigger tax events. It is important to be aware of the following:</p>
      <ul>
        <li><b>Equity Funds:</b> Gains on units held for over one year are considered Long-Term Capital Gains (LTCG) and are taxed at 10% on gains exceeding ‚Çπ1 lakh in a financial year.</li>
        <li><b>Debt Funds:</b> Gains on units held for over three years are considered long-term and are taxed at 20% after applying indexation benefits, which adjusts the purchase price for inflation.</li>
        <li><b>Strategy:</b> When rebalancing, it is advisable to first use fresh SIP inflows to adjust the portfolio. This minimizes the need to sell units and incur taxes. The current portfolio does not include ELSS funds, but a portion of the Large Cap allocation can be redirected to an ELSS fund if the investor has remaining Section 80C tax-saving capacity.</li>
      </ul>
    </section>
    <section id="goal-scenarios">
      <h2 id="goal-timeline-scenarios">üèÅ Goal Timeline Scenarios & Shortfall Rectification</h2>
      <p>Our projections indicate a minor potential shortfall of <b>‚Çπ4,87,034</b> against the inflation-adjusted target of ‚Çπ5.12 Crore. This represents a gap of less than 1% and is highly manageable through one of the following actions:</p>
      <div class="table-container">
        <table>
          <thead><tr><th>Action</th><th>Details</th><th>Priority</th></tr></thead>
          <tbody>
            <tr><td><b>Increase Monthly SIP</b></td><td>Increase the total monthly SIP amount by just <b>‚Çπ2,500</b> (from ‚Çπ249,868 to ~‚Çπ252,368). This is the most direct and disciplined method to close the gap.</td><td><b>High</b></td></tr>
            <tr><td><b>Strategic Lump-Sum Investment</b></td><td>Make a one-time lump-sum investment of approximately <b>‚Çπ1,00,000 - ‚Çπ1,50,000</b> at the start of the plan or during a market dip.</td><td>Medium</td></tr>
            <tr><td><b>Performance-Based Rebalancing</b></td><td>If the portfolio outperforms its 10% annualized return target, allocate surplus gains towards debt instruments during annual rebalancing to lock in profits.</td><td>Opportunistic</td></tr>
          </tbody>
        </table>
      </div>
    </section>
    <section id="data-integrity">
      <h2 id="data-integrity-note">üìù Data Integrity & Image Search Debug</h2>
      <p><b>Data Note:</b> The automated validation process (T023) identified a data retrieval failure for the 'HDFC Short Term Debt Fund' (SDRN002) during the initial fund universe screening. As this fund was not selected for the final portfolio, this issue does not impact the validity of the recommendations provided in this report. All data for the four recommended funds has been verified.</p>
      <p><b>Image Search Log:</b> As per protocol, a comprehensive scan for image files (.jpg, .jpeg, .png, .webp) was conducted across all available data fields in the session. The scan parsed all string values, including nested JSON structures. <b>Result:</b> No image URLs were found in the provided data. Therefore, no images have been embedded in this report.</p>
    </section>
    <div style="margin: 40px 0 20px 0; text-align: center;" class="no-print">
      <button onclick="window.print()" style="margin: 5px; padding: 12px 24px; background-color: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Print Report</button>
      <button onclick="downloadHTML()" style="margin: 5px; padding: 12px 24px; background-color: #10B981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Download HTML</button>
    </div>
  </div>

  <script id="fund-chart-data" type="application/json">
  {
    "performance_comparison": {
      "type": "bar",
      "data": {
        "labels": [
          "ICICI Pru Bluechip",
          "PGIM India Midcap",
          "HDFC Corp Bond",
          "ICICI Pru Short Term"
        ],
        "datasets": [
          {
            "label": "1Y CAGR (%)",
            "data": [38, 53, 7.5, 7.1],
            "backgroundColor": "rgba(54, 162, 235, 0.6)",
            "borderColor": "rgba(54, 162, 235, 1)",
            "borderWidth": 1
          },
          {
            "label": "3Y CAGR (%)",
            "data": [20, 31, 6.8, 6.2],
            "backgroundColor": "rgba(75, 192, 192, 0.6)",
            "borderColor": "rgba(75, 192, 192, 1)",
            "borderWidth": 1
          },
          {
            "label": "5Y CAGR (%)",
            "data": [18, 25, 7.2, 6.5],
            "backgroundColor": "rgba(255, 206, 86, 0.6)",
            "borderColor": "rgba(255, 206, 86, 1)",
            "borderWidth": 1
          }
        ]
      },
      "options": {
        "responsive": true,
        "maintainAspectRatio": false,
        "plugins": {
          "title": {
            "display": false
          },
          "legend": {
            "position": "top"
          }
        },
        "scales": {
          "y": {
            "beginAtZero": true,
            "title": {
              "display": true,
              "text": "Annualized Return (%)"
            }
          }
        }
      }
    },
    "risk_return_scatter": {
      "type": "scatter",
      "data": {
        "datasets": [
          {
            "label": "Equity Funds",
            "data": [
              {"x": 0.15, "y": 20, "fundName": "ICICI Prudential Bluechip Fund"},
              {"x": 0.18, "y": 31, "fundName": "PGIM India Midcap Opportunities Fund"}
            ],
            "backgroundColor": "rgba(255, 99, 132, 0.8)"
          },
          {
            "label": "Debt Funds",
            "data": [
              {"x": 0.025, "y": 6.8, "fundName": "HDFC Corporate Bond Fund"},
              {"x": 0.015, "y": 6.2, "fundName": "ICICI Prudential Short Term Fund"}
            ],
            "backgroundColor": "rgba(54, 162, 235, 0.8)"
          }
        ]
      },
      "options": {
        "responsive": true,
        "maintainAspectRatio": false,
        "plugins": {
          "title": {
            "display": false
          },
          "legend": {
            "position": "top"
          }
        },
        "scales": {
          "x": {
            "title": {
              "display": true,
              "text": "Risk (Annualized Standard Deviation)"
            }
          },
          "y": {
            "title": {
              "display": true,
              "text": "Return (3-Year CAGR %)"
            }
          }
        }
      }
    },
    "portfolio_allocation": {
      "type": "doughnut",
      "data": {
        "labels": ["Large Cap", "Mid Cap", "Corporate Bond", "Short Duration"],
        "datasets": [
          {
            "label": "Portfolio Allocation",
            "data": [44, 11, 27, 18],
            "backgroundColor": ["#3B82F6", "#F59E0B", "#10B981", "#6366F1"],
            "hoverOffset": 4
          }
        ]
      },
      "options": {
        "responsive": true,
        "maintainAspectRatio": false,
        "plugins": {
          "title": {
            "display": false
          },
          "legend": {
            "position": "right"
          }
        }
      }
    },
    "expense_ratio_comparison": {
      "type": "bar",
      "data": {
        "labels": ["ICICI Pru Bluechip", "PGIM India Midcap", "HDFC Corp Bond", "ICICI Pru Short Term"],
        "datasets": [
          {
            "label": "Expense Ratio (%)",
            "data": [0.92, 0.45, 0.24, 0.35],
            "backgroundColor": "rgba(153, 102, 255, 0.6)",
            "borderColor": "rgba(153, 102, 255, 1)",
            "borderWidth": 1
          }
        ]
      },
      "options": {
        "responsive": true,
        "maintainAspectRatio": false,
        "indexAxis": "y",
        "plugins": {
          "title": {
            "display": false
          },
          "legend": {
            "display": false
          }
        },
        "scales": {
          "x": {
            "beginAtZero": true,
            "title": {
              "display": true,
              "text": "Expense Ratio (%)"
            }
          }
        }
      }
    },
    "glide_path_timeline": {
      "type": "line",
      "data": {
        "labels": ["Year 1", "Year 2", "Year 3", "Year 4", "Year 5", "Year 6", "Year 7", "Year 8", "Year 9", "Year 10"],
        "datasets": [
          {
            "label": "Equity %",
            "data": [55, 55, 55, 55, 50, 50, 50, 40, 40, 40],
            "fill": true,
            "backgroundColor": "rgba(54, 162, 235, 0.5)",
            "borderColor": "rgb(54, 162, 235)",
            "tension": 0.1
          },
          {
            "label": "Debt %",
            "data": [45, 45, 45, 45, 50, 50, 50, 60, 60, 60],
            "fill": true,
            "backgroundColor": "rgba(75, 192, 192, 0.5)",
            "borderColor": "rgb(75, 192, 192)",
            "tension": 0.1
          }
        ]
      },
      "options": {
        "responsive": true,
        "maintainAspectRatio": false,
        "plugins": {
          "title": {
            "display": false
          }
        },
        "scales": {
          "y": {
            "stacked": true,
            "max": 100,
            "title": {
              "display": true,
              "text": "Allocation (%)"
            }
          }
        }
      }
    }
  }
  </script>

  <script>
    function initializeFundCharts() {
      try {
        if (typeof Chart === 'undefined') {
          console.error('Chart.js not loaded');
          return;
        }

        let fundData;
        try {
          const dataScript = document.getElementById('fund-chart-data');
          fundData = dataScript ? JSON.parse(dataScript.textContent) : null;
        } catch (e) {
          console.warn('Chart data parse failed:', e);
          fundData = null;
        }

        if (!fundData) {
          console.error('Fund chart data is not available.');
          return;
        }

        // 1. Performance Comparison Chart
        const perfCtx = document.getElementById('performanceComparisonChart');
        if (perfCtx && fundData.performance_comparison) {
          new Chart(perfCtx, fundData.performance_comparison);
        }

        // 2. Risk vs Return Scatter Plot (with runtime tooltip fix)
        const riskCtx = document.getElementById('riskReturnScatterChart');
        if (riskCtx && fundData.risk_return_scatter) {
          const config = JSON.parse(JSON.stringify(fundData.risk_return_scatter));
          config.options.plugins = config.options.plugins || {};
          config.options.plugins.tooltip = {
            callbacks: {
              label: function(context) {
                const point = context.dataset.data[context.dataIndex];
                const name = point.fundName || 'Fund';
                const risk = (context.parsed.x * 100).toFixed(2);
                const ret = context.parsed.y.toFixed(1);
                return `${name}: Return ${ret}%, Risk ${risk}%`;
              }
            }
          };
          new Chart(riskCtx, config);
        }

        // 3. Portfolio Allocation Doughnut
        const allocCtx = document.getElementById('portfolioAllocationChart');
        if (allocCtx && fundData.portfolio_allocation) {
          new Chart(allocCtx, fundData.portfolio_allocation);
        }

        // 4. Expense Ratio Comparison
        const expenseCtx = document.getElementById('expenseRatioChart');
        if (expenseCtx && fundData.expense_ratio_comparison) {
          new Chart(expenseCtx, fundData.expense_ratio_comparison);
        }

        // 5. Glide Path Timeline Chart
        const glideCtx = document.getElementById('glidePathChart');
        if (glideCtx && fundData.glide_path_timeline) {
          new Chart(glideCtx, fundData.glide_path_timeline);
        }

      } catch (e) {
        console.error('Fund chart initialization failed:', e);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() { setTimeout(initializeFundCharts, 500); });
    } else {
      setTimeout(initializeFundCharts, 500);
    }

    function downloadHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'fund_comprehensive_report.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>