<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Systematic Investment Plan (SIP) Analysis Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7fafc;
      color: #1a202c;
    }
    .container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 2rem;
      background-color: #ffffff;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border-radius: 0.5rem;
    }
    h1, h2, h3 {
      color: #2d3748;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 0.5rem;
      margin-top: 1.5rem;
    }
    h1 { font-size: 2.25rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; border-bottom: none; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      border: 1px solid #e2e8f0;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #edf2f7;
      font-weight: 600;
    }
    .no-print {
      display: block;
    }
    .summary-card {
        background-color: #f7fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;
    }
    .summary-card-title { font-weight: bold; color: #4a5568; }
    .summary-card-value { font-size: 1.25rem; color: #2d3748; }
    @media print {
      .no-print {
        display: none;
      }
      body, .container {
        box-shadow: none;
        margin: 0;
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold">Systematic Investment Plan (SIP) Analysis Report</h1>
      <p class="text-gray-500">Generated on: <span id="generationDate"></span></p>
    </header>

    <div class="no-print">
        <div style="margin: 40px 0; text-align: center; background-color: #edf2f7; padding: 20px; border-radius: 8px;">
          <button onclick="window.print()" style="margin: 5px; padding: 10px 20px; background-color: #4299e1; color: white; border-radius: 5px; border: none; cursor: pointer;">Print Report</button>
          <button onclick="downloadHTML()" style="margin: 5px; padding: 10px 20px; background-color: #48bb78; color: white; border-radius: 5px; border: none; cursor: pointer;">Download HTML</button>
        </div>
    </div>

    <section id="executive-summary">
      <h2>üéØ Executive Summary</h2>
      <p class="text-gray-700 leading-relaxed">This report outlines a strategic financial plan designed to achieve your retirement goal of ‚Çπ1 Crore in 30 years. After accounting for a projected average inflation rate of 5.5% per annum, the inflation-adjusted target corpus required in 30 years is approximately ‚Çπ4.98 Crore. Our analysis indicates that a monthly Systematic Investment Plan (SIP) of ‚Çπ14,260 is required to reach this target, based on an assumed annualized return of 12%, which is consistent with your stated 'high' risk appetite. The corresponding asset allocation strategy is 70% in Equity for long-term growth and 30% in Debt for stability. It is critical to note that while the financial calculations and strategic framework are validated and sound, the plan is <strong>not yet actionable</strong>. The fund identification process revealed crucial data gaps for essential asset categories (Small Cap equity and Government Securities), which must be resolved before any investment decisions are made.</p>
    </section>

    <section id="goal-inputs">
        <h2>üìã Goal Inputs</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="summary-card">
                <p class="summary-card-title">Goal</p>
                <p class="summary-card-value">Retirement</p>
            </div>
             <div class="summary-card">
                <p class="summary-card-title">Target Amount</p>
                <p class="summary-card-value">‚Çπ1,00,00,000</p>
            </div>
             <div class="summary-card">
                <p class="summary-card-title">Time Horizon</p>
                <p class="summary-card-value">30 Years (360 Months)</p>
            </div>
             <div class="summary-card">
                <p class="summary-card-title">Risk Appetite</p>
                <p class="summary-card-value capitalize">high</p>
            </div>
        </div>
    </section>

    <section id="inflation-adjustment">
        <h2>üí® Inflation Adjustment</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
             <div class="summary-card">
                <p class="summary-card-title">Assumed Annual Inflation</p>
                <p class="summary-card-value">5.5%</p>
            </div>
            <div class="summary-card">
                <p class="summary-card-title">Future Value of Target</p>
                <p class="summary-card-value">‚Çπ4,98,39,494</p>
            </div>
        </div>
    </section>

    <section id="sip-calculation">
        <h2>üí∞ SIP Calculation</h2>
         <div class="summary-card text-center">
            <p class="summary-card-title">Required Monthly SIP</p>
            <p class="summary-card-value text-3xl text-green-600">‚Çπ14,260</p>
            <p class="text-gray-600 mt-2">Based on an assumed 12% annualized return to meet the inflation-adjusted goal.</p>
        </div>
    </section>

    <section id="asset-allocation">
        <h2>‚öñÔ∏è Asset Allocation Plan</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="summary-card">
                <p class="summary-card-title">Equity Allocation</p>
                <p class="summary-card-value">70%</p>
            </div>
            <div class="summary-card">
                <p class="summary-card-title">Debt Allocation</p>
                <p class="summary-card-value">30%</p>
            </div>
        </div>
        <div class="mt-4 p-4 border rounded-lg">
            <h3 class="font-bold mb-2">Recommended Fund Categories:</h3>
            <ul class="list-disc list-inside">
                <li><strong>Equity:</strong> Large Cap Funds, Mid Cap Funds, Small Cap Funds</li>
                <li><strong>Debt:</strong> Corporate Bond Funds, Government Securities</li>
                <li>ELSS Optional for tax saving</li>
            </ul>
        </div>
    </section>

    <section id="allocation-notes">
        <h2>üìù Allocation Notes</h2>
        <p class="text-gray-700 leading-relaxed">The recommended 70/30 asset allocation between Equity and Debt is a direct reflection of your 'high' risk tolerance and the long 30-year investment horizon. The substantial 70% allocation to equity is designed to be the primary engine of wealth creation, harnessing the power of compounding over three decades to significantly outpace inflation and generate capital appreciation. This equity portion is strategically intended for diversification across Large Cap funds (for stability), Mid Cap funds (for balanced growth), and Small Cap funds (for aggressive growth). The 30% allocation to debt instruments, such as Corporate Bonds and Government Securities, plays a crucial role as a portfolio stabilizer. It is designed to mitigate the inherent volatility of the equity markets, preserve capital during downturns, and provide a more predictable, albeit lower, return stream, thereby creating a balanced risk-adjusted portfolio.</p>
    </section>

    <section id="key-recommendations">
        <h2>üîë Key Recommendations</h2>
        <div class="text-gray-700 leading-relaxed space-y-4">
            <p>To transition this financial plan from a strategic framework to an executable portfolio, the following actions must be taken in order of priority:</p>
            <ol class="list-decimal list-inside space-y-2">
              <li><strong>Address Critical Data Gaps (High Priority):</strong> The immediate and most important next step is to complete the fund selection process. The initial analysis failed to identify suitable investment options for the 'Small Cap Funds' and 'Government Securities (Gilt Funds)' categories. These are integral to the strategy's success and not optional. A new, targeted data retrieval and analysis effort must be initiated to populate these categories with high-quality funds.</li>
              <li><strong>Define Sub-Allocation Percentages (Medium Priority):</strong> Once a complete list of funds across all five categories is finalized, a precise sub-allocation strategy must be defined. The 70% equity and 30% debt allocations must be broken down further (e.g., Equity: 30% Large Cap, 25% Mid Cap, 15% Small Cap). This will provide clear, actionable guidance on how to distribute the monthly SIP of ‚Çπ14,260 across the selected funds.</li>
              <li><strong>Conduct Portfolio Overlap Analysis (Low Priority):</strong> After the fund list and sub-allocations are finalized, a portfolio overlap analysis is recommended. This diligence step ensures that the combined portfolio does not have an unintended over-concentration in the same underlying stocks held by multiple funds, thereby maintaining true diversification.</li>
            </ol>
        </div>
    </section>

    <section id="risk-factors">
        <h2>‚ö†Ô∏è Risk Factors & Uncertainties</h2>
        <div class="text-gray-700 leading-relaxed space-y-3">
            <p>This financial plan is a forward-looking projection based on a set of assumptions that carry inherent risks and uncertainties. It is imperative to understand these factors before committing capital.</p>
            <p><strong>Market Risk:</strong> The projected 12% annualized return is an estimate derived from historical data for high-risk portfolios and is not guaranteed. Equity markets are inherently volatile, and returns can fluctuate significantly year-on-year. The value of your investments can decline, and there may be prolonged periods of underperformance. The long time horizon helps mitigate this risk but does not eliminate it.</p>
            <p><strong>Projection and Assumption Risk:</strong> The plan's success is highly sensitive to its core assumptions. If the actual long-term average return falls below 12%, or if inflation consistently exceeds the assumed 5.5%, the final corpus will be smaller than the target. Such deviations would necessitate a future increase in the monthly SIP amount or an extension of the investment horizon to meet the goal.</p>
            <p><strong>Execution Risk due to Incompleteness:</strong> This is the most immediate and critical risk. The plan is currently incomplete due to missing data for Small Cap and Government Securities funds. Acting on this partial plan would result in a misaligned portfolio that lacks the intended high-growth and full diversification elements. This would not match your risk profile and would significantly compromise the probability of achieving the financial goal.</p>
        </div>
    </section>

    <section id="sip-charts">
      <h2>üìä SIP Projection & Allocation Charts</h2>
      <div style="display: block;">
        <!-- Asset Allocation FIRST (TOP) -->
        <div class="chart-container" style="margin-bottom: 30px; text-align: center;">
          <h3>Asset Allocation</h3>
          <div style="max-width: 500px; margin: 0 auto;">
            <canvas id="sipAllocationChart" width="400" height="300" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
        
        <!-- SIP Growth Projection SECOND (BOTTOM) -->
        <div class="chart-container" style="text-align: center;">
          <h3>SIP Growth Projection</h3>
          <div style="max-width: 800px; margin: 0 auto;">
            <canvas id="sipProjectionChart" width="600" height="400" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id="monthly-projection">
      <h2>üìà Monthly Projection (First 12 Months)</h2>
      <table>
        <thead>
          <tr><th>Month</th><th>Contribution</th><th>Cumulative Contribution</th><th>Projected Corpus</th></tr>
        </thead>
        <tbody id="projection-table-body"></tbody>
      </table>
    </section>

  </div>

  <!-- Data Embedding -->
  <script id="goal-input-data" type="application/json">
    {"goal_type":"Retirement","target_amount":10000000,"currency":"INR","time_horizon_years":30,"total_months":360,"risk_appetite":"high"}
  </script>
  <script id="inflation-data" type="application/json">
    {"inflation_pct":5.5,"years":30,"unadjusted_target":10000000,"adjusted_target":49839493.6}
  </script>
  <script id="sip-calc-data" type="application/json">
    {"monthly_return_r":0.01,"months_n":360,"adjusted_target":49839493.6,"monthly_sip":14260.36,"status":"ok","error":null}
  </script>
  <script id="allocation-data" type="application/json">
     {"equity_percent":70,"debt_percent":30,"recommended_fund_categories":{"equity":["Large Cap Funds","Mid Cap Funds","Small Cap Funds"],"debt":["Corporate Bond Funds","Government Securities"],"elss_optional":true}}
  </script>
  <script id="sip-chart-data" type="application/json">
    {"projection":{"labels":["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M60","M120","M180","M240","M300","M359","M360"],"datasets":{"cumulative_contribution":[14260.36,28520.72,42781.08,57041.44,71301.8,85562.16,99822.52,114082.88,128343.24,142603.6,156863.96,171124.32,185384.68,199645.04,213905.4,228165.76,242426.12,256686.48,270946.84,285207.2,299467.56,313727.92,327988.28,342248.64,356509,370769.36,385029.72,399290.08,413550.44,427810.8,442071.16,456331.52,470591.88,484852.24,499112.6,513372.96,855621.6,1711243.2,2566864.8,3422486.4,4278108,5119449.24,5133709.6],"projected_corpus":[14260.36,28663.32,43210.31,57902.77,72741.16,87725.93,102857.55,118136.49,133563.21,149138.2,164861.94,180734.92,196757.63,212930.57,229254.24,245729.14,262355.79,279134.71,296066.42,313151.44,330390.32,347783.58,365331.78,383035.45,400895.17,418911.48,437084.95,455416.16,473905.68,492554.1,511361.99,530329.97,549458.63,568748.58,588200.43,607814.79,1168128.29,3288421.37,7114674.82,14207185.73,27329713.88,49347514.39,49840989.53]}},"allocation":{"labels":["Equity","Debt"],"data":[70,30]}}
  </script>
  <script id="table-data" type="application/json">
    [{"month_index":1,"label":"M1","contribution":14260.36,"cumulative_contribution":14260.36,"projected_corpus":14260.36},{"month_index":2,"label":"M2","contribution":14260.36,"cumulative_contribution":28520.72,"projected_corpus":28663.32},{"month_index":3,"label":"M3","contribution":14260.36,"cumulative_contribution":42781.08,"projected_corpus":43210.31},{"month_index":4,"label":"M4","contribution":14260.36,"cumulative_contribution":57041.44,"projected_corpus":57902.77},{"month_index":5,"label":"M5","contribution":14260.36,"cumulative_contribution":71301.8,"projected_corpus":72741.16},{"month_index":6,"label":"M6","contribution":14260.36,"cumulative_contribution":85562.16,"projected_corpus":87725.93},{"month_index":7,"label":"M7","contribution":14260.36,"cumulative_contribution":99822.52,"projected_corpus":102857.55},{"month_index":8,"label":"M8","contribution":14260.36,"cumulative_contribution":114082.88,"projected_corpus":118136.49},{"month_index":9,"label":"M9","contribution":14260.36,"cumulative_contribution":128343.24,"projected_corpus":133563.21},{"month_index":10,"label":"M10","contribution":14260.36,"cumulative_contribution":142603.6,"projected_corpus":149138.2},{"month_index":11,"label":"M11","contribution":14260.36,"cumulative_contribution":156863.96,"projected_corpus":164861.94},{"month_index":12,"label":"M12","contribution":14260.36,"cumulative_contribution":171124.32,"projected_corpus":180734.92}]
  </script>

  <!-- Chart.js and rendering scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    function initCharts() {
      if (typeof Chart === 'undefined') {
        console.error('Chart.js not loaded');
        return;
      }
      
      let data;
      try {
        const script = document.getElementById('sip-chart-data');
        data = script ? JSON.parse(script.textContent) : null;
      } catch (e) {
        console.warn('Chart data parse failed');
        data = null;
      }
      
      if (!data) {
        console.log("Using fallback chart data.")
        data = {
          projection: {
            labels: ["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84","M85","M86","M87","M88","M89","M90","M91","M92","M93","M94","M95","M96","M97","M98","M99","M100","M101","M102","M103","M104","M105","M106","M107","M108","M109","M110","M111","M112","M113","M114","M115","M116","M117","M118","M119","M120"],
            datasets: {
              cumulative_contribution: [25000,50000,75000,100000,125000,150000,175000,200000,225000,250000,275000,300000,325000,350000,375000,400000,425000,450000,475000,500000,525000,550000,575000,600000,625000,650000,675000,700000,725000,750000,775000,800000,825000,850000,875000,900000,925000,950000,975000,1000000,1025000,1050000,1075000,1100000,1125000,1150000,1175000,1200000,1225000,1250000,1275000,1300000,1325000,1350000,1375000,1400000,1425000,1450000,1475000,1500000,1525000,1550000,1575000,1600000,1625000,1650000,1675000,1700000,1725000,1750000,1775000,1800000,1825000,1850000,1875000,1900000,1925000,1950000,1975000,2000000,2025000,2050000,2075000,2100000,2125000,2150000,2175000,2200000,2225000,2250000,2275000,2300000,2325000,2350000,2375000,2400000,2425000,2450000,2475000,2500000,2525000,2550000,2575000,2600000,2625000,2650000,2675000,2700000,2725000,2750000,2775000,2800000,2825000,2850000,2875000,2900000,2925000,2950000,2975000,3000000],
              projected_corpus: [25250,50755,76519,102543,128831,155386,182212,209312,236692,264356,292308,320552,349093,377935,407082,436540,466312,496404,526821,557567,588648,620068,651832,683945,716412,749239,782430,815991,849927,884244,918948,954045,989540,1025440,1061750,1098476,1135626,1173205,1211220,1249678,1288586,1327951,1367780,1408080,1448859,1490125,1531885,1574148,1616922,1660215,1704035,1748392,1793293,1838750,1884770,1931365,1978544,2026318,2074697,2123692,2173315,2223577,2274490,2326066,2378316,2431252,2484887,2539233,2594302,2650106,2706658,2763971,2822058,2880932,2940607,3001097,3062415,3124575,3187591,3251477,3316247,3381916,3448499,3516010,3584465,3653879,3724267,3795645,3868028,3941432,4015873,4091366,4167928,4245574,4324322,4404188,4485188,4567340,4650661,4735168,4821880,4909814,4999990,5091425,5184139,5278150,5373478,5470142,5568161,5667556,5768346,5870552,5974194,6079293,6185870,6293947,6403545,6514686,6627391]
            }
          },
          allocation: { labels: ["Equity", "Debt"], data: [70, 30] }
        };
      }
      
      // Create allocation chart FIRST (TOP POSITION)
      const allocCtx = document.getElementById('sipAllocationChart');
      if (allocCtx) {
        new Chart(allocCtx, {
          type: 'doughnut',
          data: {
            labels: data.allocation.labels,
            datasets: [{ 
              data: data.allocation.data, 
              backgroundColor: ['#3B82F6', '#10B981'],
              borderWidth: 2 
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.33,
            plugins: {
              legend: { 
                position: 'bottom',
                labels: { padding: 15 }
              }
            }
          }
        });
      }
      
      // Create projection chart SECOND (BOTTOM POSITION)
      const projCtx = document.getElementById('sipProjectionChart');
      if (projCtx) {
        new Chart(projCtx, {
          type: 'line',
          data: {
            labels: data.projection.labels,
            datasets: [{
              label: 'Projected Corpus',
              data: data.projection.datasets.projected_corpus,
              borderColor: '#3B82F6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }, {
              label: 'Cumulative Contribution', 
              data: data.projection.datasets.cumulative_contribution,
              borderColor: '#EF4444',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              fill: false,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            interaction: {
              mode: 'nearest',
              intersect: false
            },
            scales: {
              x: {
                title: { display: true, text: 'Time Period' },
                ticks: { maxTicksLimit: 10 }
              },
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Amount (INR)' },
                ticks: {
                  callback: function(value) {
                    if (value >= 10000000) return '‚Çπ' + (value/10000000).toFixed(1) + 'Cr';
                    return '‚Çπ' + (value/100000).toFixed(1) + 'L';
                  }
                }
              }
            },
            plugins: {
              tooltip: {
                mode: 'index',
                intersect: false,
                callbacks: {
                    label: function(context) {
                        let label = context.dataset.label || '';
                        if (label) { label += ': '; }
                        if (context.parsed.y !== null) {
                            label += new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(context.parsed.y);
                        }
                        return label;
                    }
                }
              }
            }
          }
        });
      }
    }

    function populateTable() {
      let data;
      try {
        const script = document.getElementById('table-data');
        data = script ? JSON.parse(script.textContent) : [];
      } catch (e) {
        data = [];
      }

      const tableBody = document.getElementById('projection-table-body');
      if (!tableBody) return;
      
      const formatter = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 });

      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.month_index}</td>
          <td>${formatter.format(row.contribution)}</td>
          <td>${formatter.format(row.cumulative_contribution)}</td>
          <td>${formatter.format(row.projected_corpus)}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    function downloadHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sip_report.html';
      a.click();
      URL.revokeObjectURL(url);
    }

    document.addEventListener('DOMContentLoaded', function(){
        document.getElementById('generationDate').textContent = new Date().toLocaleDateString('en-GB');
        populateTable();
        setTimeout(initCharts, 500);
    });
  </script>

</body>
</html>