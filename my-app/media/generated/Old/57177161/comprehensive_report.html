<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive SIP Analysis Report</title>
    <!-- Using a CDN for Tailwind CSS for simplicity -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .container { max-width: 1000px; margin: auto; padding: 24px; }
        section { margin-bottom: 2.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #e5e7eb; }
        section:last-child { border-bottom: none; }
        h1 { font-size: 2.25rem; font-weight: 700; margin-bottom: 1rem; color: #111827; }
        h2 { font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; color: #1f2937; display: flex; align-items: center; gap: 0.5rem; }
        h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.75rem; color: #374151; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f9fafb; font-weight: 600; }
        .value { text-align: right; font-weight: 500; }
        .highlight { background-color: #dbeafe; font-weight: bold; }
        .no-print { text-align: center; margin-top: 2rem; }
        @media print {
            .no-print { display: none; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
        button {
            background-color: #3B82F6; color: white; font-weight: bold;
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;
            transition: background-color 0.2s; margin: 5px;
        }
        button:hover { background-color: #2563EB; }
    </style>
</head>
<body>
    <div class="container">
        <!-- 1) Title / Header -->
        <header>
            <h1>üìä Comprehensive SIP Analysis Report</h1>
            <p class="text-gray-600">A Strategic Plan for Your Retirement Goal</p>
        </header>

        <!-- 2) Executive Summary -->
        <section id="executive-summary">
            <h2>üéØ Executive Summary</h2>
            <p class="text-gray-700 leading-relaxed">
                This report outlines a strategic financial plan to achieve a retirement goal of <b>‚Çπ3,00,00,000</b> in <b>10 years</b>. Factoring in a projected annual inflation rate of 5.5%, the actual target corpus required in the future is calculated to be <b>‚Çπ5,12,44,333.71</b>. To reach this inflation-adjusted goal, a disciplined monthly Systematic Investment Plan (SIP) of <b>‚Çπ2,22,765.73</b> is necessary, assuming an annual return of 12% consistent with the investor's 'high' risk appetite. The investment strategy is built on an aggressive asset allocation model of <b>70% in Equity</b> and <b>30% in Debt</b>. Success hinges on consistent monthly contributions, periodic portfolio reviews, and maintaining a long-term investment horizon to navigate market volatility.
            </p>
        </section>

        <!-- 3) Goal Inputs -->
        <section id="goal-inputs">
            <h2>üìù Goal Inputs & Investor Profile</h2>
            <table>
                <thead><tr><th>Parameter</th><th class="value">Value</th></tr></thead>
                <tbody>
                    <tr><td>Goal Type</td><td class="value">Retirement</td></tr>
                    <tr><td>Target Amount</td><td class="value">‚Çπ3,00,00,000</td></tr>
                    <tr><td>Time Horizon</td><td class="value">10 Years (120 Months)</td></tr>
                    <tr><td>Risk Appetite</td><td class="value">High</td></tr>
                </tbody>
            </table>
        </section>

        <!-- 4) Inflation Adjustment -->
        <section id="inflation-adjustment">
            <h2>üéà Inflation Adjustment</h2>
            <table>
                <thead><tr><th>Parameter</th><th class="value">Value</th></tr></thead>
                <tbody>
                    <tr><td>Assumed Annual Inflation</td><td class="value">5.5%</td></tr>
                    <tr><td>Unadjusted Target (Today's Value)</td><td class="value">‚Çπ3,00,00,000.00</td></tr>
                    <tr class="highlight"><td>Adjusted Target (Future Value)</td><td class="value">‚Çπ5,12,44,333.71</td></tr>
                </tbody>
            </table>
        </section>

        <!-- 5) SIP Calculation -->
        <section id="sip-calculation">
            <h2>üî¢ SIP Calculation</h2>
            <table>
                <thead><tr><th>Parameter</th><th class="value">Value</th></tr></thead>
                <tbody>
                    <tr><td>Assumed Annual Return ('High' Risk)</td><td class="value">12.00%</td></tr>
                    <tr><td>Target Corpus (Inflation-Adjusted)</td><td class="value">‚Çπ5,12,44,333.71</td></tr>
                    <tr class="highlight"><td>Required Monthly SIP</td><td class="value">‚Çπ2,22,765.73</td></tr>
                </tbody>
            </table>
        </section>

        <!-- 6) Asset Allocation Plan -->
        <section id="asset-allocation">
            <h2>üèõÔ∏è Asset Allocation Plan (70% Equity / 30% Debt)</h2>
            <p class="text-gray-700 mb-4">A diversified portfolio is essential for balancing risk and reward. This allocation aligns with a high-risk profile over a 10-year horizon.</p>
            <h3>Equity Allocation (70%)</h3>
            <p class="text-gray-600 mb-2"><i>Focuses on long-term capital appreciation by investing in a diversified mix of companies across market capitalizations.</i></p>
            <h3>Debt Allocation (30%)</h3>
            <p class="text-gray-600"><i>Aims to provide stability, preserve capital, and generate regular income to cushion the portfolio against equity market volatility.</i></p>
        </section>

        <!-- 7) Key Recommendations -->
        <section id="key-recommendations">
            <h2>üöÄ Key Recommendations</h2>
            <ol class="list-decimal list-inside text-gray-700 space-y-2">
                <li><b>Maintain Discipline:</b> Consistently invest the calculated SIP amount of ‚Çπ2,22,765.73 every month without fail. Automate this process to avoid emotional decision-making.</li>
                <li><b>Annual Portfolio Review:</b> At least once a year, review the portfolio's performance and asset allocation. Rebalance if the allocation has drifted significantly from the 70/30 target.</li>
                <li><b>Increase SIP Amount Annually:</b> To combat inflation and potentially reach the goal sooner, consider increasing the monthly SIP amount by 5-10% each year, in line with any increase in income.</li>
                <li><b>Stay the Course:</b> Given the high equity exposure, the portfolio will experience volatility. It is crucial to avoid panic selling during market downturns. The 10-year time horizon is sufficient to recover from such events.</li>
            </ol>
        </section>

        <!-- 8) Risk Factors & Uncertainties -->
        <section id="risk-factors">
            <h2>‚ö†Ô∏è Risk Factors & Uncertainties</h2>
            <p class="text-gray-700 mb-4">While this plan is built on sound financial principles, it is subject to several risks and uncertainties. It is essential to understand these factors as they can impact the final outcome. The projected returns are not guaranteed and are based on historical assumptions.</p>
            <ul class="list-disc list-inside text-gray-700 space-y-2">
                <li><b>Market Risk:</b> The 12% annual return is an estimate. Actual market returns can and will fluctuate. The portfolio's significant 70% allocation to equities means it is highly susceptible to market downturns, economic recessions, and geopolitical events. A prolonged bear market could significantly impact the corpus value.</li>
                <li><b>Inflation Risk:</b> The plan assumes a 5.5% average annual inflation rate. If actual inflation is consistently higher, the real purchasing power of the final corpus will be lower than anticipated, potentially requiring a higher SIP contribution in the future.</li>
                <li><b>Interest Rate Risk:</b> This primarily affects the 30% debt portion of the portfolio. If interest rates in the economy rise, the value of existing bonds with lower rates will fall, impacting the NAV of debt mutual funds.</li>
                <li><b>Performance Risk:</b> The performance of any selected mutual funds depends heavily on the skill of the fund managers. There is no guarantee that the chosen funds will outperform their benchmarks or meet the assumed 12% return.</li>
            </ul>
        </section>
        
        <!-- 9) Charts Section (v11 FIXED LAYOUT) -->
        <section id="sip-charts">
          <h2>üìä SIP Projection & Allocation Charts</h2>
          <div style="display: block;">
            <!-- Asset Allocation FIRST (TOP) -->
            <div class="chart-container" style="margin-bottom: 30px; text-align: center;">
              <h3>Asset Allocation</h3>
              <div style="max-width: 500px; margin: 0 auto;">
                <canvas id="sipAllocationChart" width="400" height="300" style="max-width: 100%; height: auto;"></canvas>
              </div>
            </div>
            
            <!-- SIP Growth Projection SECOND (BOTTOM) -->
            <div class="chart-container" style="text-align: center;">
              <h3>SIP Growth Projection</h3>
              <div style="max-width: 800px; margin: 0 auto;">
                <canvas id="sipProjectionChart" width="600" height="400" style="max-width: 100%; height: auto;"></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- 10) Monthly Projection Table -->
        <section id="monthly-projection">
            <h2>üìà Monthly Projection (First 12 Months)</h2>
            <table id="projection-table-body">
                <thead><tr><th>Month</th><th class="value">Monthly Contribution</th><th class="value">Total Investment</th><th class="value">Projected Corpus</th></tr></thead>
                <tbody>
                    <tr><td colspan="4" style="text-align:center;">Loading data...</td></tr>
                </tbody>
            </table>
        </section>

        <!-- 11) Print/Download Controls -->
        <div class="no-print">
          <button onclick="window.print()">Print Report</button>
          <button onclick="downloadHTML()">Download HTML</button>
        </div>
    </div>

    <!-- DATA EMBEDDING -->
    <script id="sip-chart-data" type="application/json">
{"projection":{"labels":["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84","M85","M86","M87","M88","M89","M90","M91","M92","M93","M94","M95","M96","M97","M98","M99","M100","M101","M102","M103","M104","M105","M106","M107","M108","M109","M110","M111","M112","M113","M114","M115","M116","M117","M118","M119","M120"],"datasets":{"cumulative_contribution":[222765.73,445531.46,668297.19,891062.92,1113828.65,1336594.38,1559360.11,1782125.84,2004891.57,2227657.3,2450423.03,2673188.76,2895954.49,3118720.22,3341485.95,3564251.68,3787017.41,4009783.14,4232548.87,4455314.6,4678080.33,4900846.06,5123611.79,5346377.52,5569143.25,5791908.98,6014674.71,6237440.44,6460206.17,6682971.9,6905737.63,7128503.36,7351269.09,7574034.82,7796800.55,8019566.28,8242332.01,8465097.74,8687863.47,8910629.2,9133394.93,9356160.66,9578926.39,9801692.12,10024457.85,10247223.58,10469989.31,10692755.04,10915520.77,11138286.5,11361052.23,11583817.96,11806583.69,12029349.42,12252115.15,12474880.88,12697646.61,12920412.34,13143178.07,13365943.8,13588709.53,13811475.26,14034240.99,14257006.72,14479772.45,14702538.18,14925303.91,15148069.64,15370835.37,15593601.1,15816366.83,16039132.56,16261898.29,16484664.02,16707429.75,16930195.48,17152961.21,17375726.94,17598492.67,17821258.4,18044024.13,18266789.86,18489555.59,18712321.32,18935087.05,19157852.78,19380618.51,19603384.24,19826150,20048915.7,20271681.43,20494447.16,20717212.89,20939978.62,21162744.35,21385510.08,21608275.81,21831041.54,22053807.27,22276573,22499338.73,22722104.46,22944870.19,23167635.92,23390401.65,23613167.38,23835933.11,24058698.84,24281464.57,24504230.3,24726996.03,24949761.76,25172527.49,25395293.22,25618058.95,25840824.68,26063590.41,26286356.14,26509121.87,26731887.6],"projected_corpus":[222765.73,447759.12,675002.44,904518.2,1136329.11,1370458.07,1606928.18,1845762.59,2086984.67,2330618.05,2576686.49,2825213.91,3076224.22,3329740.39,3585786.52,3844386.85,4105565.65,4369347.24,4635756.04,4904816.53,5176553.43,5450991.59,5728156.03,6008072.02,6290765,6576260.58,6864584.52,7155762.59,7449820.68,7746784.62,8046681.33,8349537.87,8655380.38,8964237.01,9276135.95,9591105.44,9909174.72,10230372.1,10554726.05,10882264.04,11213015.61,11547009.49,11884275.51,12224843,12568741.36,12916000.1,13266648.53,13620716.67,13978231.77,14339222.75,14703718.51,15071748.22,15443340.63,15818524.7,16197328.38,16579780.62,16965909.36,17355742.58,17749307.96,18146633.77,18547747.76,18952678.97,19361453.49,19774099.98,20190646.61,20611222.01,21035555.82,21463977.01,21896414.71,22332896.52,22773450.41,23218096.34,23666861.96,24119774.29,24576861.69,25038152.04,25503673.49,25973454.19,26447522.36,26925906.51,27408635.51,27895738.49,28387244.6,28883181.78,29383578.13,29888462.84,30397864.83,30911814.11,31430339.91,31953471.04,32481236.41,33013665.5,33550787.89,34092631.5,34639226.54,35190602.54,35746789.29,36307816.51,36873714.01,37444511.08,38020235.84,38600917.93,39186586.84,39777271.64,40373000.29,40973802.02,41579705.97,42190740.39,42806935.52,43428321.61,44054929.96,44686790.89,45324034.73,45966691.81,46614792.46,47268368.11,47927448.56,48592063.57,49262244.74,49938032.92]}},"allocation":{"labels":["Equity","Debt"],"data":[70,30]}}    </script>
    
    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- v11 FIXED Chart Rendering Script -->
    <script>
function initCharts() {
  if (typeof Chart === 'undefined') {
    console.error('Chart.js not loaded');
    return;
  }
  
  let data;
  try {
    const script = document.getElementById('sip-chart-data');
    data = script ? JSON.parse(script.textContent) : null;
  } catch (e) {
    console.warn('Chart data parse failed');
    data = null;
  }
  
  // Enhanced fallback with complete timeline
  if (!data) {
    data = {
      projection: {
        labels: ["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84","M85","M86","M87","M88","M89","M90","M91","M92","M93","M94","M95","M96","M97","M98","M99","M100","M101","M102","M103","M104","M105","M106","M107","M108","M109","M110","M111","M112","M113","M114","M115","M116","M117","M118","M119","M120"],
        datasets: {
          cumulative_contribution: [25000,50000,75000,100000,125000,150000,175000,200000,225000,250000,275000,300000,325000,350000,375000,400000,425000,450000,475000,500000,525000,550000,575000,600000,625000,650000,675000,700000,725000,750000,775000,800000,825000,850000,875000,900000,925000,950000,975000,1000000,1025000,1050000,1075000,1100000,1125000,1150000,1175000,1200000,1225000,1250000,1275000,1300000,1325000,1350000,1375000,1400000,1425000,1450000,1475000,1500000,1525000,1550000,1575000,1600000,1625000,1650000,1675000,1700000,1725000,1750000,1775000,1800000,1825000,1850000,1875000,1900000,1925000,1950000,1975000,2000000,2025000,2050000,2075000,2100000,2125000,2150000,2175000,2200000,2225000,2250000,2275000,2300000,2325000,2350000,2375000,2400000,2425000,2450000,2475000,2500000,2525000,2550000,2575000,2600000,2625000,2650000,2675000,2700000,2725000,2750000,2775000,2800000,2825000,2850000,2875000,2900000,2925000,2950000,2975000,3000000],
          projected_corpus: [25250,50755,76519,102543,128831,155386,182212,209312,236692,264356,292308,320552,349093,377935,407082,436540,466312,496404,526821,557567,588648,620068,651832,683945,716412,749239,782430,815991,849927,884244,918948,954045,989540,1025440,1061750,1098476,1135626,1173205,1211220,1249678,1288586,1327951,1367780,1408080,1448859,1490125,1531885,1574148,1616922,1660215,1704035,1748392,1793293,1838750,1884770,1931365,1978544,2026318,2074697,2123692,2173315,2223577,2274490,2326066,2378316,2431252,2484887,2539233,2594302,2650106,2706658,2763971,2822058,2880932,2940607,3001097,3062415,3124575,3187591,3251477,3316247,3381916,3448499,3516010,3584465,3653879,3724267,3795645,3868028,3941432,4015873,4091366,4167928,4245574,4324322,4404188,4485188,4567340,4650661,4735168,4821880,4909814,4999990,5091425,5184139,5278150,5373478,5470142,5568161,5667556,5768346,5870552,5974194,6079293,6185870,6293947,6403545,6514686,6627391]
        }
      },
      allocation: { labels: ["Equity", "Debt"], data: [70, 30] }
    };
  }
  
  // Create allocation chart FIRST (TOP POSITION)
  const allocCtx = document.getElementById('sipAllocationChart');
  if (allocCtx) {
    new Chart(allocCtx, {
      type: 'doughnut',
      data: {
        labels: data.allocation.labels,
        datasets: [{ 
          data: data.allocation.data, 
          backgroundColor: ['#3B82F6', '#10B981'],
          borderWidth: 2 
        }]
      },
      options: { 
        responsive: true,
        maintainAspectRatio: true,
        aspectRatio: 1.33,
        plugins: {
          legend: { 
            position: 'bottom',
            labels: { padding: 15 }
          }
        }
      }
    });
  }
  
  // Create projection chart SECOND (BOTTOM POSITION)
  const projCtx = document.getElementById('sipProjectionChart');
  if (projCtx) {
    new Chart(projCtx, {
      type: 'line',
      data: {
        labels: data.projection.labels,
        datasets: [{
          label: 'Projected Corpus',
          data: data.projection.datasets.projected_corpus,
          borderColor: '#3B82F6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 1,
          pointHoverRadius: 4
        }, {
          label: 'Cumulative Contribution', 
          data: data.projection.datasets.cumulative_contribution,
          borderColor: '#EF4444',
          backgroundColor: 'rgba(239, 68, 68, 0.1)',
          fill: false,
          tension: 0.4,
          pointRadius: 1,
          pointHoverRadius: 4
        }]
      },
      options: { 
        responsive: true,
        maintainAspectRatio: true,
        aspectRatio: 1.5,
        interaction: {
          mode: 'nearest',
          intersect: false
        },
        scales: {
          x: {
            title: { display: true, text: 'Time Period (Months)' },
            ticks: { maxTicksLimit: 10 }
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Amount (INR)' },
            ticks: {
              callback: function(value) {
                return '‚Çπ' + (value/100000).toFixed(1) + 'L';
              }
            }
          }
        },
        plugins: {
          tooltip: {
            mode: 'index',
            intersect: false
          }
        }
      }
    });
  }
}
        
        // Table population script
        function populateTable() {
            try {
                const script = document.getElementById('sip-chart-data');
                const data = script ? JSON.parse(script.textContent) : null;
                if (!data || !data.projection) return;

                const tableBody = document.querySelector("#projection-table-body tbody");
                if (!tableBody) return;
                
                tableBody.innerHTML = ''; // Clear loading message
                const sipAmount = 222765.73;
                const formatter = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 2 });

                for (let i = 0; i < 12; i++) {
                    const row = document.createElement('tr');
                    const month = `<td>M${i + 1}</td>`;
                    const contribution = `<td class="value">${formatter.format(sipAmount)}</td>`;
                    const cumulative = `<td class="value">${formatter.format(data.projection.datasets.cumulative_contribution[i])}</td>`;
                    const corpus = `<td class="value">${formatter.format(data.projection.datasets.projected_corpus[i])}</td>`;
                    row.innerHTML = month + contribution + cumulative + corpus;
                    tableBody.appendChild(row);
                }
            } catch (e) {
                console.error("Failed to populate projection table:", e);
                const tableBody = document.querySelector("#projection-table-body tbody");
                if(tableBody) tableBody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:red;">Error loading table data.</td></tr>';
            }
        }

        // Initialize with enhanced delay for proper loading
        setTimeout(() => {
            initCharts();
            populateTable();
        }, 500);
    </script>
    
    <!-- v11 Download & Print Script -->
    <script>
        function downloadHTML() {
          const html = document.documentElement.outerHTML;
          const blob = new Blob([html], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'sip_comprehensive_report.html';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>