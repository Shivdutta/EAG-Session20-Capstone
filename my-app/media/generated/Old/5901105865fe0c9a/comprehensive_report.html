<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comprehensive SIP Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 20px; background-color: #f9fafb; color: #1f2937; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h1 { font-size: 2.25rem; font-weight: bold; color: #111827; border-bottom: 2px solid #3B82F6; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
    h2 { font-size: 1.5rem; font-weight: bold; color: #111827; margin-top: 2rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; }
    table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
    th { background-color: #f8f9fa; font-weight: 600; }
    p { line-height: 1.6; margin-bottom: 1rem; }
    ul, ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    li { margin-bottom: 0.5rem; }
    mark { background-color: #dbeafe; padding: 2px 4px; border-radius: 3px; }
    .executive-summary { background-color: #eff6ff; border-left: 4px solid #3B82F6; padding: 1.5rem; margin-bottom: 2rem; border-radius: 4px; }
    .warning { background-color: #fffbeb; border-left: 4px solid #f59e0b; padding: 1rem; margin-top: 1rem; border-radius: 4px; }
    /* FIXED CHART CONTAINER STYLING - NO GRID */
    .chart-container-wrapper { display: block; max-width: 1000px; margin: 0 auto; }
    .chart-container { 
      margin-bottom: 30px; 
      text-align: center; 
      border: 1px solid #e5e7eb; 
      padding: 20px; 
      border-radius: 8px;
    }
    .chart-container h3 { 
      margin-bottom: 15px; 
      font-size: 1.25rem; 
      font-weight: 600;
      color: #1f2937;
    }
    .chart-canvas-wrapper { margin: 0 auto; }
    
    .no-print { display: block; }
    @media print {
      .no-print { display: none; }
      body { padding: 0; background-color: #fff; }
      .container { box-shadow: none; border: none; padding: 0.5rem; }
      h1, h2 { margin-top: 1.5rem; }
      .chart-container { page-break-inside: avoid; margin: 15px 0; }
      canvas { max-height: 300px !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Systematic Investment Plan (SIP) Analysis & Projections</h1>

    <div class="no-print" style="margin-bottom: 2rem; text-align: center;">
      <button onclick="window.print()" style="margin: 5px; padding: 12px 24px; background-color: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Print Report</button>
      <button onclick="downloadHTML()" style="margin: 5px; padding: 12px 24px; background-color: #10B981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 500;">Download HTML</button>
    </div>

    <section id="executive-summary">
      <div class="executive-summary">
        <h2>üéØ Executive Summary</h2>
        <p>This report details a personalized Systematic Investment Plan (SIP) designed to achieve the goal of <b>General Wealth Creation</b> over a 10-year horizon for a <b>moderate risk profile</b>. After adjusting for an estimated annual inflation of 5.5%, the target corpus of ‚Çπ10,000,000 becomes a future value of <b>‚Çπ17,081,444.57</b>. To reach this goal, a monthly SIP contribution of <b>‚Çπ83,387.22</b> is required, assuming a 10% annualized return. The recommended asset allocation is a balanced portfolio with <b>50% in Equity</b> and <b>50% in Debt</b>.</p>
        <div class="warning">‚ö†Ô∏è <strong>Critical Workflow Alert:</strong> While the financial calculations are sound, the automated process for shortlisting specific mutual funds failed due to an upstream data error. This report provides the strategic framework but cannot recommend specific funds. This issue must be resolved before making tactical investment decisions.</div>
      </div>
    </section>

    <section id="goal-inputs">
      <h2>üì• Goal Inputs & Investor Profile</h2>
      <table>
        <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
        <tbody>
          <tr><td>Financial Goal</td><td>General Wealth Creation</td></tr>
          <tr><td>Current Age</td><td>50</td></tr>
          <tr><td>Target Amount (Today's Value)</td><td>‚Çπ10,000,000</td></tr>
          <tr><td>Investment Horizon</td><td>10 Years (120 Months)</td></tr>
          <tr><td>Risk Appetite</td><td>Moderate</td></tr>
        </tbody>
      </table>
    </section>

    <section id="inflation-adjustment">
      <h2>üíπ Inflation Adjustment Analysis</h2>
      <p>To ensure the future corpus maintains its purchasing power, the target amount has been adjusted for inflation. This projects the value needed in the future to match ‚Çπ10,000,000 today.</p>
      <table>
        <thead><tr><th>Metric</th><th>Value</th></tr></thead>
        <tbody>
          <tr><td>Unadjusted Target Corpus</td><td>‚Çπ10,000,000.00</td></tr>
          <tr><td>Assumed Annual Inflation Rate</td><td>5.5%</td></tr>
          <tr><td>Investment Duration</td><td>10 Years</td></tr>
          <tr><td><b>Inflation-Adjusted Target Corpus</b></td><td><b>‚Çπ17,081,444.57</b></td></tr>
        </tbody>
      </table>
    </section>

    <section id="sip-calculation">
      <h2>üßÆ Required Monthly SIP Calculation</h2>
      <p>The required monthly SIP is calculated using the future value of the goal, the investment tenure, and the expected rate of return based on the investor's risk profile.</p>
      <table>
        <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
        <tbody>
          <tr><td>Adjusted Target (Future Value)</td><td>‚Çπ17,081,444.57</td></tr>
          <tr><td>Total Investment Period (Months)</td><td>120</td></tr>
          <tr><td>Assumed Annual Return</td><td>10% (for Moderate Risk)</td></tr>
          <tr><td><b>Required Monthly SIP</b></td><td><b>‚Çπ83,387.22</b></td></tr>
        </tbody>
      </table>
    </section>

    <section id="asset-allocation">
      <h2>üß© Asset Allocation Plan</h2>
      <p>Based on a 'Moderate' risk profile, a balanced allocation between equity and debt is recommended to optimize for growth while managing downside risk.</p>
      <table>
        <thead><tr><th>Asset Class</th><th>Allocation</th><th>Recommended Fund Categories</th></tr></thead>
        <tbody>
          <tr><td><b>Equity</b></td><td><b>50%</b></td><td><ul><li>Large Cap Funds</li><li>Mid Cap Funds</li></ul></td></tr>
          <tr><td><b>Debt</b></td><td><b>50%</b></td><td><ul><li>Corporate Bond Funds</li><li>Short Duration Funds</li></ul></td></tr>
        </tbody>
      </table>
    </section>

    <section id="key-recommendations">
        <h2>üîë Key Recommendations</h2>
        <p>The primary financial recommendation is to begin investing the calculated SIP amount. However, this must be preceded by resolving a critical process issue.</p>
        <ol>
          <li><b>Initiate Monthly SIP:</b> Plan to start a monthly investment of <b>‚Çπ83,387.22</b> as soon as practicable.</li>
          <li><b>Adhere to Allocation:</b> When investing, split the monthly amount according to the 50% Equity / 50% Debt strategy.</li>
          <li><b style="color: #d9534f;">CRITICAL - Resolve Workflow Failure:</b> The fund selection subprocess failed. The root cause must be fixed, and the workflow re-run to get a shortlist of suitable funds within the recommended categories.</li>
        </ol>
    </section>

    <section id="risk-factors">
        <h2>‚ö†Ô∏è Risk Factors and Uncertainties</h2>
        <p>This investment plan is subject to various risks and uncertainties. The projections provided are estimates, not guarantees, and are contingent on several assumptions.</p>
        <ul>
          <li><b>Market Risk:</b> The projected 10% annual return is a long-term average assumption. Actual market returns will fluctuate and can be negative. Equity markets can be volatile in the short term, and there is no assurance that the assumed return will be achieved.</li>
          <li><b>Inflation Risk:</b> The plan assumes a 5.5% annual inflation rate. If actual inflation is higher, the final corpus may have less purchasing power than anticipated, potentially requiring a higher SIP amount.</li>
          <li><b>Fund Selection Risk:</b> This risk is significantly elevated due to the failure of the automated shortlisting process. The responsibility of selecting specific, high-quality mutual funds within the recommended categories currently falls to the user. Poor fund selection can lead to underperformance.</li>
          <li><b>Operational & Process Risk:</b> The failure of the fund shortlisting step highlights an operational risk within the advisory process itself. This demonstrates that system dependencies can impact the timely delivery of complete advice, requiring manual intervention and potential delays.</li>
          <li><b>Discipline Risk:</b> The success of any SIP is critically dependent on consistent, disciplined monthly contributions. Pausing or stopping contributions will significantly impact the final corpus and jeopardize the achievement of the financial goal.</li>
        </ul>
    </section>

    <!-- v15 FIXED CHART LAYOUT IMPLEMENTATION -->
    <section id="sip-charts">
      <h2>üìä SIP Projection & Allocation Charts</h2>
      <div class="chart-container-wrapper">
        <!-- Asset Allocation FIRST (TOP) -->
        <div class="chart-container">
          <h3>Asset Allocation</h3>
          <div class="chart-canvas-wrapper" style="max-width: 500px;">
            <canvas id="sipAllocationChart" width="400" height="300" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
        
        <!-- SIP Growth Projection SECOND (BOTTOM) -->
        <div class="chart-container">
          <h3>SIP Growth Projection (10 Years)</h3>
          <div class="chart-canvas-wrapper" style="max-width: 800px;">
            <canvas id="sipProjectionChart" width="600" height="400" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id="monthly-projection">
      <h2>üìà Monthly Projection (First 12 Months)</h2>
      <table>
        <thead><tr><th>Month</th><th>Cumulative Contribution</th><th>Projected Corpus</th></tr></thead>
        <tbody>
          <tr><td>M1</td><td>‚Çπ83,387.22</td><td>‚Çπ83,387.22</td></tr>
          <tr><td>M2</td><td>‚Çπ166,774.44</td><td>‚Çπ167,469.01</td></tr>
          <tr><td>M3</td><td>‚Çπ250,161.66</td><td>‚Çπ252,251.77</td></tr>
          <tr><td>M4</td><td>‚Çπ333,548.88</td><td>‚Çπ337,741.93</td></tr>
          <tr><td>M5</td><td>‚Çπ416,936.10</td><td>‚Çπ423,945.96</td></tr>
          <tr><td>M6</td><td>‚Çπ500,323.32</td><td>‚Çπ510,870.38</td></tr>
          <tr><td>M7</td><td>‚Çπ583,710.54</td><td>‚Çπ598,521.79</td></tr>
          <tr><td>M8</td><td>‚Çπ667,097.76</td><td>‚Çπ686,906.84</td></tr>
          <tr><td>M9</td><td>‚Çπ750,484.98</td><td>‚Çπ776,032.22</td></tr>
          <tr><td>M10</td><td>‚Çπ833,872.20</td><td>‚Çπ865,904.67</td></tr>
          <tr><td>M11</td><td>‚Çπ917,259.42</td><td>‚Çπ956,531.02</td></tr>
          <tr><td>M12</td><td>‚Çπ1,000,646.64</td><td>‚Çπ1,047,918.15</td></tr>
        </tbody>
      </table>
    </section>

  </div>

  <!-- Data Embedding -->
  <script id="chart-data" type="application/json">
  {"projection":{"labels":["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84","M85","M86","M87","M88","M89","M90","M91","M92","M93","M94","M95","M96","M97","M98","M99","M100","M101","M102","M103","M104","M105","M106","M107","M108","M109","M110","M111","M112","M113","M114","M115","M116","M117","M118","M119","M120"],"datasets":{"cumulative_contribution":[83387.22,166774.44,250161.66,333548.88,416936.1,500323.32,583710.54,667097.76,750484.98,833872.2,917259.42,1000646.64,1084033.86,1167421.08,1250808.3,1334195.52,1417582.74,1500969.96,1584357.18,1667744.4,1751131.62,1834518.84,1917906.06,2001293.28,2084680.5,2168067.72,2251454.94,2334842.16,2418229.38,2501616.6,2585003.82,2668391.04,2751778.26,2835165.48,2918552.7,3001939.92,3085327.14,3168714.36,3252101.58,333548.8,3418876.02,3502263.24,3585650.46,3669037.68,3752424.9,3835812.12,3919199.34,4002586.56,4085973.78,4169361.0,4252748.22,4336135.44,4419522.66,4502909.88,4586297.1,4669684.32,4753071.54,4836458.76,4919845.98,5003233.2,5086620.42,5170007.64,5253394.86,5336782.08,5420169.3,5503556.52,5586943.74,5670330.96,5753718.18,5837105.4,5920492.62,6003879.84,6087267.06,6170654.28,6254041.5,6337428.72,6420815.94,6504203.16,6587590.38,6670977.6,6754364.82,6837752.04,6921139.26,7004526.48,7087913.7,7171300.92,7254688.14,7338075.36,7421462.58,7504849.8,7588237.02,7671624.24,7755011.46,7838398.68,7921785.9,8005173.12,8088560.34,8171947.56,8255334.78,8338722.0,8422109.22,8505496.44,8588883.66,8672270.88,8755658.1,8839045.32,8922432.54,9005819.76,9089206.98,9172594.2,9255981.42,9339368.64,9422755.86,9506143.08,9589530.3,9672917.52,9756304.74,9839691.96,9923079.18,10006466.4],"projected_corpus":[83387.22,167469.01,252251.77,337741.93,423945.96,510870.38,598521.79,686906.84,776032.22,865904.67,956531.02,1047918.15,1140073.01,1233002.58,1326713.91,1421214.11,1516510.32,1612609.73,1709519.59,1807247.24,1905800.08,2005185.59,2105411.31,2206484.86,2308413.91,2411206.21,2514869.58,2619411.89,2724841.04,2831165.04,2938392.05,3046530.32,3155588.11,3265573.71,3376495.42,3488361.62,3601180.66,3714961.02,3829711.21,3945439.81,4062155.48,4179866.82,4298582.47,4418311.12,4539061.41,4660842.06,4783661.76,4907529.28,5032453.39,5158442.85,5285506.52,5413653.27,5542892.05,5673231.85,5804681.71,5937250.7,6070947.88,6205782.35,6341763.22,6478899.62,6617200.78,6756675.92,6897334.32,7039185.29,7182238.16,7326502.28,7471987.03,7618701.92,7766656.47,7915860.27,8066323.01,8218054.34,8371064.09,8525362.09,8680958.24,8837862.46,8996084.68,9155634.92,9316523.21,9478759.57,9642354.07,9807316.85,9973658.16,10141388.35,10310517.92,10481057.4,10653017.38,10826408.52,11001241.59,11177527.4,11355276.9,11534501.07,11715210.95,11897417.71,12081132.53,12266366.64,12453131.33,12641438.09,12831298.41,13022723.9,13215726.27,13410317.32,13606508.97,13804313.21,14003742.15,14204807.96,14407522.86,14611899.19,14817949.35,15025685.93,15235121.61,15446269.13,15659141.34,15873751.19,16090111.72,16308235.98,16528137.28,16749828.96,16973324.54,17081444.57]}},"allocation":{"labels":["Equity","Debt"],"data":[50,50],"meta":{"recommended_fund_categories":{"equity":["Large Cap Funds","Mid Cap Funds"],"debt":["Corporate Bond Funds","Short Duration Funds"],"elss_optional":true}}}}
  </script>

  <!-- v15 ENHANCED chart rendering script -->
  <script>
    function initCharts() {
      if (typeof Chart === 'undefined') {
        console.error('Chart.js not loaded');
        return;
      }
      
      let data;
      try {
        const script = document.getElementById('chart-data');
        data = script ? JSON.parse(script.textContent) : null;
      } catch (e) {
        console.warn('Chart data parse failed');
        data = null;
      }
      
      if (!data) {
          console.error('Chart data is missing or invalid.');
          return;
      }
      
      // Create allocation chart FIRST (TOP POSITION)
      const allocCtx = document.getElementById('sipAllocationChart');
      if (allocCtx) {
        new Chart(allocCtx, {
          type: 'doughnut',
          data: {
            labels: data.allocation.labels,
            datasets: [{ 
              data: data.allocation.data, 
              backgroundColor: ['#3B82F6', '#10B981'],
              borderWidth: 2 
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.33,
            plugins: {
              legend: { 
                position: 'bottom',
                labels: { padding: 15 }
              }
            }
          }
        });
      }
      
      // Create projection chart SECOND (BOTTOM POSITION)
      const projCtx = document.getElementById('sipProjectionChart');
      if (projCtx) {
        new Chart(projCtx, {
          type: 'line',
          data: {
            labels: data.projection.labels,
            datasets: [{
              label: 'Projected Corpus',
              data: data.projection.datasets.projected_corpus,
              borderColor: '#3B82F6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }, {
              label: 'Cumulative Contribution', 
              data: data.projection.datasets.cumulative_contribution,
              borderColor: '#EF4444',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              fill: false,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            interaction: {
              mode: 'nearest',
              intersect: false
            },
            scales: {
              x: {
                title: { display: true, text: 'Time Period (Months)' },
                ticks: { maxTicksLimit: 10 }
              },
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Amount (INR)' },
                ticks: {
                  callback: function(value) {
                    return '‚Çπ' + (value/100000).toFixed(1) + 'L';
                  }
                }
              }
            },
            plugins: {
              tooltip: {
                mode: 'index',
                intersect: false
              }
            }
          }
        });
      }
    }

    // Initialize with enhanced delay for proper loading
    setTimeout(initCharts, 500);

    function downloadHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'comprehensive_sip_report.html';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>