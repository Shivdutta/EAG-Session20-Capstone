<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comprehensive SIP Analysis Report</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: #f8f9fa; color: #343a40; line-height: 1.6; }
    .container { max-width: 1000px; margin: 20px auto; padding: 30px; background-color: #ffffff; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-radius: 8px; }
    h1, h2, h3 { color: #212529; font-weight: 600; margin-top: 1.5em; margin-bottom: 0.75em; border-bottom: 1px solid #dee2e6; padding-bottom: 0.3em; }
    h1 { font-size: 2.2em; text-align: center; border-bottom: 2px solid #007bff; }
    h2 { font-size: 1.6em; }
    p { margin-bottom: 1em; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #dee2e6; padding: 12px; text-align: left; vertical-align: top; }
    th { background-color: #f1f3f5; font-weight: 600; }
    .no-print { text-align: center; margin: 30px 0; }
    .button { background-color: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; transition: background-color 0.3s; }
    .button:hover { background-color: #0056b3; }
    .callout { padding: 15px; margin: 20px 0; border-left: 5px solid #ffc107; background-color: #fff3cd; border-radius: 4px; }
    .callout b { color: #856404; }
    @media print {
      .no-print { display: none; }
      body { box-shadow: none; margin: 0; padding: 0; }
      .container { box-shadow: none; border-radius: 0; max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Comprehensive Retirement SIP Analysis Report</h1>

    <section id="executive-summary">
      <h2>üéØ Executive Summary</h2>
      <p>This report outlines a Systematic Investment Plan (SIP) for a <strong>Retirement</strong> goal with a present-day target of <strong>‚Çπ3,00,00,000</strong> over a <strong>10-year</strong> period. After adjusting for inflation, the required future corpus is approximately <strong>‚Çπ5,12,44,334</strong>.</p>
      <p><strong>Age Timeline:</strong> This plan is designed for an individual starting at age <strong>[CURRENT_AGE]</strong>, aiming to achieve the financial goal by age <strong>[EVENT_AGE_OR_TARGET]</strong>.</p>
      <p><strong>Investment Strategy:</strong> A monthly SIP of <strong>‚Çπ2,50,161</strong> is required, assuming a 10% annual return from a 'moderate' risk profile portfolio with a <strong>50% Equity / 50% Debt</strong> allocation.</p>
      <div class="callout">
        <p><strong>‚ö†Ô∏è Critical Plan Discrepancy:</strong> Analysis identified a minor mathematical shortfall. The projected final corpus is ‚Çπ5,07,55,047, which is approximately <strong>‚Çπ4,89,287 short</strong> of the required target. It is recommended to slightly increase the monthly SIP to address this gap and ensure the goal is met precisely.</p>
      </div>
    </section>

    <section id="goal-inputs">
      <h2>üìò Investment Goal Details</h2>
        <table>
          <tbody><tr>
            <th>Goal Type</th>
            <td>Retirement</td>
          </tr>
          <tr>
            <th>Current Age</th>
            <td>[CURRENT_AGE] years</td>
          </tr>
          <tr>
            <th>Target/Event Age</th>
            <td>[EVENT_AGE_OR_TARGET] years</td>
          </tr>
          <tr>
            <th>Investment Duration</th>
            <td>10 years (120 months)</td>
          </tr>
          <tr>
            <th>Target Amount (Today's Value)</th>
            <td>‚Çπ3,00,00,000</td>
          </tr>
          <tr>
            <th>Risk Profile</th>
            <td>Moderate</td>
          </tr>
        </tbody></table>
    </section>

    <section id="inflation-adjustment">
      <h2>üìà Inflation Adjustment</h2>
      <p>To preserve future purchasing power, the target corpus must be adjusted for inflation. An assumed annual inflation rate of 5.5% significantly increases the final amount required.</p>
      <table>
        <tbody><tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Assumed Annual Inflation Rate</td><td>5.5%</td></tr>
        <tr><td>Unadjusted Target Corpus</td><td>‚Çπ3,00,00,000</td></tr>
        <tr><td><strong>Inflation-Adjusted Target Corpus</strong></td><td><strong>‚Çπ5,12,44,334</strong></td></tr>
      </tbody></table>
    </section>

    <section id="sip-calculation">
      <h2>üßÆ Required SIP Calculation</h2>
      <p>Based on the inflation-adjusted target, the required monthly SIP is calculated assuming a 10% annual portfolio return, which is a reasonable expectation for a moderate-risk, balanced portfolio.</p>
       <table>
        <tbody><tr><th>Input</th><th>Value</th></tr>
        <tr><td>Adjusted Target Corpus</td><td>‚Çπ5,12,44,334</td></tr>
        <tr><td>Investment Tenure</td><td>120 Months</td></tr>
        <tr><td>Assumed Annual Return</td><td>10.0%</td></tr>
        <tr><td><strong>Calculated Monthly SIP</strong></td><td><strong>‚Çπ2,50,161.42</strong></td></tr>
      </tbody></table>
    </section>

    <section id="asset-allocation">
      <h2>‚öñÔ∏è Asset Allocation Plan</h2>
      <p>A balanced 50/50 asset allocation between Equity and Debt is recommended to align with the 'moderate' risk profile, optimizing for growth while managing downside risk.</p>
      <table>
        <thead><tr><th>Asset Class</th><th>Allocation</th><th>Recommended Fund Category</th><th>Strategic Role</th></tr></thead>
        <tbody>
          <tr><td>Equity</td><td>50%</td><td>Large Cap & Mid Cap Funds</td><td>Primary engine for growth to beat inflation.</td></tr>
          <tr><td>Debt</td><td>50%</td><td>Corporate Bond & Short Duration Funds</td><td>Provides portfolio stability and income.</td></tr>
        </tbody>
      </table>
    </section>
    
    <section id="key-recommendations">
        <h2>üöÄ Key Recommendations & Action Plan</h2>
        <ol>
            <li><strong>Correct the Plan:</strong> Immediately address the identified ‚Çπ4.89 lakh shortfall by recalculating and slightly increasing the monthly SIP to precisely match the ‚Çπ5.12 Cr target.</li>
            <li><strong>Select Funds:</strong> Choose one or two high-quality funds within each of the four recommended categories (Large Cap, Mid Cap, Corporate Bond, Short Duration).</li>
            <li><strong>Execute SIPs:</strong> Set up automated monthly SIPs for the corrected total amount, ensuring the date aligns with your income schedule.</li>
            <li><strong>Review Annually:</strong> Rebalance the portfolio once a year to maintain the strategic 50/50 asset allocation if market movements cause it to drift.</li>
            <li><strong>Stay Disciplined:</strong> Consistency is crucial. Continue investing through market fluctuations to benefit from cost averaging and achieve the long-term goal.</li>
        </ol>
    </section>

    <section id="risk-factors">
      <h2>‚ö†Ô∏è Risk Factors & Uncertainties</h2>
      <p>This investment plan is subject to various risks that must be understood. The assumed 10% annual return is a long-term average, not a guarantee. Market volatility (Systematic Risk) can cause actual returns to be significantly higher or lower. The 10-year horizon provides limited time to recover from a major market crash near the end of the investment term. Inflation Risk is another major factor; if actual inflation exceeds the 5.5% assumption, the real value of the final corpus will be eroded. The debt portion of the portfolio is subject to Interest Rate Risk, where rising rates can decrease the value of existing bond funds. Furthermore, Credit Risk exists if corporate bond issuers default. Finally, Fund Manager Risk means that the performance of selected funds can vary based on the manager's skill and strategy. It is essential to monitor these factors and review the plan periodically to stay on track.</p>
    </section>

    <section id="sip-charts">
      <h2>üìä SIP Projection & Allocation Charts</h2>
      <div style="display: block;">
        <!-- Asset Allocation FIRST (TOP) -->
        <div class="chart-container" style="margin-bottom: 30px; text-align: center;">
          <h3>Asset Allocation</h3>
          <div style="max-width: 500px; margin: 0 auto;">
            <canvas id="sipAllocationChart" width="400" height="300" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
        
        <!-- SIP Growth Projection SECOND (BOTTOM) -->
        <div class="chart-container" style="text-align: center;">
          <h3>SIP Growth Projection</h3>
          <div style="max-width: 800px; margin: 0 auto;">
            <canvas id="sipProjectionChart" width="600" height="400" style="max-width: 100%; height: auto;"></canvas>
          </div>
        </div>
      </div>
    </section>
    
    <section id="monthly-projection">
      <h2>üóìÔ∏è Monthly Projection (First 12 Months)</h2>
      <p>The table below details the projected growth for the initial 12 months, showing the interplay between monthly contributions and compounding returns.</p>
      <table>
        <thead><tr><th>Month</th><th>Cumulative Contribution (‚Çπ)</th><th>Projected Corpus Value (‚Çπ)</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>2,50,161</td><td>2,50,161</td></tr>
          <tr><td>2</td><td>5,00,323</td><td>5,02,407</td></tr>
          <tr><td>3</td><td>7,50,484</td><td>7,56,756</td></tr>
          <tr><td>4</td><td>10,00,646</td><td>10,13,223</td></tr>
          <tr><td>5</td><td>12,50,807</td><td>12,71,828</td></tr>
          <tr><td>6</td><td>15,00,969</td><td>15,32,588</td></tr>
          <tr><td>7</td><td>17,51,130</td><td>17,95,520</td></tr>
          <tr><td>8</td><td>20,01,291</td><td>20,60,643</td></tr>
          <tr><td>9</td><td>22,51,453</td><td>23,27,974</td></tr>
          <tr><td>10</td><td>25,01,614</td><td>25,97,532</td></tr>
          <tr><td>11</td><td>27,51,776</td><td>28,69,336</td></tr>
          <tr><td>12</td><td>30,01,937</td><td>31,43,403</td></tr>
        </tbody>
      </table>
    </section>
    
    <div class="no-print">
        <button class="button" onclick="window.print()">Print Report</button>
        <button class="button" onclick="downloadHTML()">Download HTML</button>
    </div>

  </div>

  <!-- Embedded Data & Scripts -->

  <!-- 1. Goal Input Data (with Age Fields) -->
  <script id="goal-input-data" type="application/json">
  {
    "goal_type": "Retirement",
    "target_amount": 30000000,
    "currency": "INR",
    "time_horizon_years": 10,
    "total_months": 120,
    "risk_appetite": "moderate",
    "current_age": 50,
    "event_age_or_target": 60
  }
  </script>

  <!-- 2. Chart Data -->
  <script id="sip-chart-data" type="application/json">
  {"projection":{"labels":["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","M13","M14","M15","M16","M17","M18","M19","M20","M21","M22","M23","M24","M25","M26","M27","M28","M29","M30","M31","M32","M33","M34","M35","M36","M37","M38","M39","M40","M41","M42","M43","M44","M45","M46","M47","M48","M49","M50","M51","M52","M53","M54","M55","M56","M57","M58","M59","M60","M61","M62","M63","M64","M65","M66","M67","M68","M69","M70","M71","M72","M73","M74","M75","M76","M77","M78","M79","M80","M81","M82","M83","M84","M85","M86","M87","M88","M89","M90","M91","M92","M93","M94","M95","M96","M97","M98","M99","M100","M101","M102","M103","M104","M105","M106","M107","M108","M109","M110","M111","M112","M113","M114","M115","M116","M117","M118","M119","M120"],"datasets":{"cumulative_contribution":[250161.42,500322.84,750484.26,1000645.68,1250807.1,1500968.52,1751129.94,2001291.36,2251452.78,2501614.2,2751775.62,3001937.04,3252098.46,3502259.88,3752421.3,4002582.72,4252744.14,4502905.56,4753066.98,5003228.4,5253389.82,5503551.24,5753712.66,6003874.08,6254035.5,6504196.92,6754358.34,7004519.76,7254681.18,7504842.6,7755004.02,8005165.44,8255326.86,8505488.28,8755649.7,9005811.12,9255972.54,9506133.96,9756295.38,10006456.8,10256618.22,10506779.64,10756941.06,11007102.48,11257263.9,11507425.32,11757586.74,12007748.16,12257909.58,12508071.0,12758232.42,13008393.84,13258555.26,13508716.68,13758878.1,14009039.52,14259200.94,14509362.36,14759523.78,15009685.2,15259846.62,15510008.04,15760169.46,16010330.88,16260492.3,16510653.72,16760815.14,17010976.56,17261137.98,17511299.4,17761460.82,18011622.24,18261783.66,18511945.08,18762106.5,19012267.92,19262429.34,19512590.76,19762752.18,20012913.6,20263075.02,20513236.44,20763397.86,21013559.28,21263720.7,21513882.12,21764043.54,22014204.96,22264366.38,22514527.8,22764689.22,23014850.64,23265012.06,23515173.48,23765334.9,24015496.32,24265657.74,24515819.16,24765980.58,25016142.0,25266303.42,25516464.84,25766626.26,26016787.68,26266949.1,26517110.52,26767271.94,27017433.36,27267594.78,27517756.2,27767917.62,28018079.04,28268240.46,28518401.88,28768563.3,29018724.72,29268886.14,29519047.56,29769208.98,30019370.4],"projected_corpus":[250161.42,502407.48,756755.63,1013223.36,1271828.22,1532587.83,1795520.03,2060642.73,2327974.02,2597532.14,2869335.57,3143402.97,3419753.11,3698404.92,3979377.38,4262689.59,4548360.81,4836410.45,5126858.07,5419723.36,5715026.12,6012786.23,6313023.68,6615758.55,6921011.08,7228801.69,7539150.97,7852079.59,8167608.32,8485758.05,8806549.73,9130004.48,9456143.51,9784988.08,10116559.62,10450879.62,10787969.62,11127851.36,11470546.65,11816077.37,12164465.51,12515733.06,12869902.16,13226995.04,13587034.02,13950041.44,14316040.12,14685052.79,15057102.26,1543211.45,15810403.21,16191700.41,16576126.24,16963704.06,17354457.26,17748409.43,18145584.21,18546005.41,18949696.82,19356682.32,19766985.97,20180631.98,20597644.65,21018048.35,21441867.75,21869127.65,22299853.02,22734068.89,23171799.46,23613069.09,24057902.33,24506323.85,24958358.38,25414030.73,25873365.82,26336388.54,26803123.84,27273596.87,27747832.84,28225857.12,28707695.12,29193372.28,29682914.05,30176346.03,30673693.91,31174983.56,31680241.06,32189492.57,32702764.31,33220082.68,33741474.04,34266964.82,34796581.53,35330350.71,35868299.01,36410453.17,36956840.09,37507486.76,38062420.15,38621667.31,39185255.37,39753211.53,40325563.13,40902337.52,41483562.33,42069265.34,42659474.38,43254217.37,43853522.34,44457417.36,45065930.54,45679090.09,46296924.31,46919461.68,47546730.86,48178760.75,48815579.09,49457213.92,50103693.37,50755046.81]}},"allocation":{"labels":["Equity","Debt"],"data":[50,50],"meta":{"recommended_fund_categories":{"equity":["Large Cap Funds","Mid Cap Funds"],"debt":["Corporate Bond Funds","Short Duration Funds"],"elss_optional":true}}}}
  </script>

  <!-- 3. Charting & Utility Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    function initCharts() {
      if (typeof Chart === 'undefined') {
        console.error('Chart.js not loaded');
        return;
      }
      
      let data;
      try {
        const script = document.getElementById('sip-chart-data');
        data = script ? JSON.parse(script.textContent) : null;
      } catch (e) {
        console.warn('Chart data parse failed');
        data = null;
      }
      
      // Enhanced fallback with complete timeline
      if (!data) {
        console.warn('Using fallback chart data.');
        data = {
          projection: {
            labels: Array.from({length: 120}, (_, i) => `M${i + 1}`),
            datasets: {
              cumulative_contribution: Array.from({length: 120}, (_, i) => 25000 * (i + 1)),
              projected_corpus: Array.from({length: 120}, (_, i) => 25000 * (i + 1) * (1 + 0.05 * (i/12)))
            }
          },
          allocation: { labels: ["Equity", "Debt"], data: [50, 50] }
        };
      }
      
      // Create allocation chart FIRST (TOP POSITION)
      const allocCtx = document.getElementById('sipAllocationChart');
      if (allocCtx) {
        new Chart(allocCtx, {
          type: 'doughnut',
          data: {
            labels: data.allocation.labels,
            datasets: [{ 
              data: data.allocation.data, 
              backgroundColor: ['#3B82F6', '#10B981'],
              borderWidth: 2 
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.33,
            plugins: {
              legend: { 
                position: 'bottom',
                labels: { padding: 15 }
              }
            }
          }
        });
      }
      
      // Create projection chart SECOND (BOTTOM POSITION)
      const projCtx = document.getElementById('sipProjectionChart');
      if (projCtx) {
        new Chart(projCtx, {
          type: 'line',
          data: {
            labels: data.projection.labels,
            datasets: [{
              label: 'Projected Corpus',
              data: data.projection.datasets.projected_corpus,
              borderColor: '#3B82F6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }, {
              label: 'Cumulative Contribution', 
              data: data.projection.datasets.cumulative_contribution,
              borderColor: '#EF4444',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              fill: false,
              tension: 0.4,
              pointRadius: 1,
              pointHoverRadius: 4
            }]
          },
          options: { 
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            interaction: {
              mode: 'nearest',
              intersect: false
            },
            scales: {
              x: {
                title: { display: true, text: 'Time Period (Months)' },
                ticks: { maxTicksLimit: 10 }
              },
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Amount (INR)' },
                ticks: {
                  callback: function(value) {
                    if (value >= 10000000) return '‚Çπ' + (value/10000000).toFixed(2) + 'Cr';
                    return '‚Çπ' + (value/100000).toFixed(1) + 'L';
                  }
                }
              }
            },
            plugins: {
              tooltip: {
                mode: 'index',
                intersect: false
              }
            }
          }
        });
      }
    }

    function downloadHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sip_comprehensive_report.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function replacePlaceholders() {
        let goalData = null;
        try {
            const script = document.getElementById('goal-input-data');
            goalData = script ? JSON.parse(script.textContent) : null;
        } catch (e) {
            console.error('Could not parse goal data:', e);
        }

        if (goalData) {
            document.body.innerHTML = document.body.innerHTML
                .replace(/\\[CURRENT_AGE\\]/g, goalData.current_age || 'N/A')
                .replace(/\\[EVENT_AGE_OR_TARGET\\]/g, goalData.event_age_or_target || 'N/A');
        }
    }

    // Initialize after DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        replacePlaceholders();
        setTimeout(initCharts, 200); // Delay to ensure canvas elements are ready
    });
  </script>

</body>
</html>