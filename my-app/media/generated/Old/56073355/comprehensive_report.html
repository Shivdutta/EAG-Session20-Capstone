<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive SIP Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-6">
            <h1 class="text-3xl font-bold">SIP Investment Plan</h1>
        </header>

        <script id="sip-data" type="application/json">{}</script>
        <script id="goal-input-json" type="application/json">{"goal_type": "Child Education", "target_amount": 2000000, "currency": "INR", "time_horizon_years": 15, "total_months": 180, "risk_appetite": "moderate"}</script>
        <script id="inflation-adjusted-json" type="application/json">{"inflation_pct": 5.5, "years": 15, "unadjusted_target": 2000000, "adjusted_target": 4514347.05}</script>
        <script id="sip-calc-json" type="application/json">{"monthly_return_r": 0.008333333333333333, "months_n": 180, "adjusted_target": 4514347.05, "monthly_sip": 14791.19, "status": "ok", "error": null}</script>
        <script id="allocation-plan-json" type="application/json">{"equity_percent": 50, "debt_percent": 50, "recommended_fund_categories": {"equity": ["Large Cap", "Mid Cap"], "debt": ["Short Term Debt", "Corporate Bond"], "elss_optional": true}, "notes": {"very_low": "Extremely conservative, e.g., 90% debt / 10% equity", "low": "Conservative, e.g., 70% debt / 30% equity", "low_moderate": "Tilted conservative, e.g., 60% debt / 40% equity", "moderate": "Balanced mix, e.g., 50% equity / 50% debt", "high_moderate": "Tilted aggressive, e.g., 60% equity / 40% debt", "high": "Aggressive, e.g., 70% equity / 30% debt", "very_high": "Extremely aggressive, e.g., 90% equity / 10% debt"}}</script>
        <script id="report-payload" type="application/json">{"executive_summary": "This report details a Systematic Investment Plan (SIP) designed to achieve a child education goal, targeting an inflation-adjusted amount of INR 4,514,347.05 over 15 years. The plan adopts a moderate risk appetite, allocating 50% to equity and 50% to debt, with recommended fund categories including Large Cap and Mid Cap for equity, and Short Term Debt and Corporate Bond for debt. Quality assurance checks have passed, ensuring mathematical soundness and adherence to allocation guidelines. A projection chart visualizes the cumulative contribution and projected corpus growth over the investment period.", "allocation": [{"asset_class": "Equity", "percentage": 50}, {"asset_class": "Debt", "percentage": 50}], "sections": [{"title": "Goal Inputs", "content": "Goal Type: Child Education, Target Amount: INR 2,000,000 (Unadjusted), INR 4,514,347.05 (Adjusted), Time Horizon: 15 years (180 months), Risk Appetite: Moderate"}, {"title": "Inflation Adjustment", "content": "Inflation Rate: 5.5%, Investment Years: 15, Unadjusted Target: INR 2,000,000, Adjusted Target: INR 4,514,347.05"}, {"title": "SIP Calculation", "content": "Monthly Return Rate: 0.008333333333333333, Number of Months: 180, Adjusted Target: INR 4,514,347.05, Monthly SIP Amount: INR 14,791.19"}, {"title": "Asset Allocation Plan", "content": "Equity Allocation: 50%, Debt Allocation: 50%, Recommended Equity Fund Categories: Large Cap, Mid Cap, Recommended Debt Fund Categories: Short Term Debt, Corporate Bond, ELSS: Optional"}, {"title": "Risk Appetite Guidelines", "content": "Very Low: Extremely conservative, e.g., 90% debt / 10% equity, Low: Conservative, e.g., 70% debt / 30% equity, Low-Moderate: Tilted conservative, e.g., 60% debt / 40% equity, Moderate: Balanced mix, e.g., 50% equity / 50% debt, High-Moderate: Tilted aggressive, e.g., 60% equity / 40% debt, High: Aggressive, e.g., 70% equity / 30% debt, Very High: Extremely aggressive, e.g., 90% equity / 10% debt"}]}</script>

        <section id="executive-summary" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Executive Summary</h2>
            <p id="exec">No executive summary available.</p>
        </section>

        <section id="goal-inputs-section" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Goal Inputs</h2>
            <ul class="list-disc list-inside">
                <li><b>Goal Type:</b> <span id="goal-type"></span></li>
                <li><b>Target Amount:</b> <span id="target-amount"></span> <span id="currency"></span> (Unadjusted)</li>
                <li><b>Adjusted Target Amount:</b> <span id="adjusted-target-amount"></span> <span id="currency2"></span></li>
                <li><b>Time Horizon:</b> <span id="time-horizon"></span> years (<span id="total-months"></span> months)</li>
                <li><b>Risk Appetite:</b> <span id="risk-appetite"></span></li>
            </ul>
        </section>

        <section id="inflation-adjustment-section" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Inflation Adjustment</h2>
            <ul class="list-disc list-inside">
                <li><b>Inflation Rate:</b> <span id="inflation-rate"></span>%</li>
                <li><b>Investment Years:</b> <span id="investment-years"></span></li>
                <li><b>Unadjusted Target:</b> <span id="unadjusted-target"></span> <span id="currency3"></span></li>
                <li><b>Adjusted Target:</b> <span id="inflation-adjusted-target"></span> <span id="currency4"></span></li>
            </ul>
        </section>

        <section id="sip-calculation-section" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">SIP Calculation</h2>
            <ul class="list-disc list-inside">
                <li><b>Monthly Return Rate:</b> <span id="monthly-return-rate"></span></li>
                <li><b>Number of Months:</b> <span id="number-of-months"></span></li>
                <li><b>Adjusted Target:</b> <span id="sip-adjusted-target"></span> <span id="currency5"></span></li>
                <li><b>Monthly SIP Amount:</b> <span id="monthly-sip-amount"></span> <span id="currency6"></span></li>
            </ul>
        </section>

        <section id="asset-allocation-section" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Asset Allocation Plan</h2>
            <table class="min-w-full">
                <thead>
                    <tr>
                        <th class="text-left font-semibold">Asset Class</th>
                        <th class="text-left font-semibold">Percentage</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Equity</td>
                        <td><span id="equity-percent"></span>%</td>
                    </tr>
                    <tr>
                        <td>Debt</td>
                        <td><span id="debt-percent"></span>%</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="text-lg font-semibold mt-4">Recommended Fund Categories</h3>
            <p><b>Equity:</b> <span id="equity-funds"></span></p>
            <p><b>Debt:</b> <span id="debt-funds"></span></p>
            <p><b>ELSS (Optional):</b> <span id="elss-optional"></span></p>
        </section>

        <section id="allocation-notes-section" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Allocation Notes</h2>
            <p id="risk-notes"></p>
        </section>

        <section id="sip-projection-table" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">SIP Projection Table (First 12 Months)</h2>
            <table class="min-w-full">
                <thead>
                    <tr>
                        <th class="text-left font-semibold">Month</th>
                        <th class="text-left font-semibold">Cumulative Contribution</th>
                        <th class="text-left font-semibold">Projected Corpus</th>
                    </tr>
                </thead>
                <tbody id="projection-table-body">
                </tbody>
            </table>
        </section>

        <section id="key-recommendations" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Key Recommendations</h2>
            <p>Based on your moderate risk appetite and the goal to fund your child's education, we recommend maintaining a balanced portfolio with 50% allocation to equity and 50% to debt. Consider investing in Large Cap and Mid Cap equity funds along with Short Term Debt and Corporate Bond debt funds. Regularly review your portfolio to ensure it aligns with your goals.</p>
        </section>

        <section id="risk-factors" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Risk Factors & Uncertainties</h2>
            <p>Investing in financial markets involves risks, including market volatility, interest rate fluctuations, and economic downturns. The returns projected in this report are based on current market conditions and historical data, which may not be indicative of future performance. Changes in government policies, tax laws, and regulatory frameworks can also impact investment returns. It's essential to diversify your investments and consult with a financial advisor to manage these risks effectively. Specific risks related to equity investments include company-specific risks and sector-specific risks. Debt investments are subject to credit risk and liquidity risk. Inflation rates could deviate from projected values. The SIP amount required may need adjustments based on actual investment performance and changes in inflation. The absence of specific fund recommendations makes it crucial to conduct thorough research and due diligence before investing in any fund.</p>
        </section>

        <section id="validation-summary" class="bg-white shadow rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-3">Validation Summary</h2>
            <p>All validations passed. The calculated SIP amount aligns with the target goal, the asset allocation totals 100%, and all inputs are within acceptable ranges. Status: <span id="validation-status">ok</span></p>
        </section>

        <section id="charts" class="mb-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white shadow rounded-2xl p-4 h-[400px]">
                    <h3 class="text-lg font-semibold mb-3">SIP Projection Chart</h3>
                    <canvas id="sipProjectionChart" height="200"></canvas>
                </div>
                <div class="bg-white shadow rounded-2xl p-4 h-[400px]">
                    <h3 class="text-lg font-semibold mb-3">Asset Allocation Chart</h3>
                    <canvas id="sipAllocationChart" height="200"></canvas>
                </div>
            </div>
        </section>

        <section id="disclaimer" class="text-sm text-gray-600 mt-8">
            <p>Disclaimer: This report is for informational purposes only and does not constitute financial advice. Investment decisions should be made based on your own research and consultation with a financial advisor.</p>
        </section>

        <footer class="mt-8 flex gap-3">
            <button onclick="window.print()" class="bg-blue-600 text-white px-4 py-2 rounded">Print</button>
            <button id="dl" class="bg-green-600 text-white px-4 py-2 rounded">Download</button>
        </footer>
    </div>

    <script>
    (function() {
        function readJSON(id, fb) {
            try {
                var el = document.getElementById(id);
                if (!el) return fb;
                var t = el.textContent || el.innerText || "";
                if (!t.trim()) return fb;
                return JSON.parse(t);
            } catch (e) {
                return fb;
            }
        }

        var goalInput = window.goal_input_json || readJSON('goal-input-json', {});
        var inflationAdjusted = window.inflation_adjusted_json || readJSON('inflation-adjusted-json', {});
        var sipCalc = window.sip_calc_json || readJSON('sip-calc-json', {});
        var allocationPlan = window.allocation_plan_json || readJSON('allocation-plan-json', {});
        var rp = window.report_payload || readJSON('report-payload', {"executive_summary": "No executive summary available.", "allocation": []});
        var cd = window.chart_data_json || readJSON('sip-data', {"projection": {"labels": [], "datasets": {"cumulative_contribution": [], "projected_corpus": []}}, "allocation": {"labels": ["Equity", "Debt"], "data": [60, 40]}});

        document.getElementById('exec').textContent = rp.executive_summary || 'No executive summary available.';

        // Goal Inputs Section
        document.getElementById('goal-type').textContent = goalInput.goal_type || 'N/A';
        document.getElementById('target-amount').textContent = goalInput.target_amount || 'N/A';
        document.getElementById('adjusted-target-amount').textContent = inflationAdjusted.adjusted_target || 'N/A';
        document.getElementById('currency').textContent = goalInput.currency || 'INR';
        document.getElementById('currency2').textContent = goalInput.currency || 'INR';
        document.getElementById('time-horizon').textContent = goalInput.time_horizon_years || 'N/A';
        document.getElementById('total-months').textContent = goalInput.total_months || 'N/A';
        document.getElementById('risk-appetite').textContent = goalInput.risk_appetite || 'N/A';

        // Inflation Adjustment Section
        document.getElementById('inflation-rate').textContent = inflationAdjusted.inflation_pct || 'N/A';
        document.getElementById('investment-years').textContent = inflationAdjusted.years || 'N/A';
        document.getElementById('unadjusted-target').textContent = inflationAdjusted.unadjusted_target || 'N/A';
        document.getElementById('inflation-adjusted-target').textContent = inflationAdjusted.adjusted_target || 'N/A';
        document.getElementById('currency3').textContent = goalInput.currency || 'INR';
        document.getElementById('currency4').textContent = goalInput.currency || 'INR';

        // SIP Calculation Section
        document.getElementById('monthly-return-rate').textContent = sipCalc.monthly_return_r || 'N/A';
        document.getElementById('number-of-months').textContent = sipCalc.months_n || 'N/A';
        document.getElementById('sip-adjusted-target').textContent = sipCalc.adjusted_target || 'N/A';
        document.getElementById('monthly-sip-amount').textContent = sipCalc.monthly_sip || 'N/A';
        document.getElementById('currency5').textContent = goalInput.currency || 'INR';
        document.getElementById('currency6').textContent = goalInput.currency || 'INR';

        // Asset Allocation Section
        document.getElementById('equity-percent').textContent = allocationPlan.equity_percent || '60';
        document.getElementById('debt-percent').textContent = allocationPlan.debt_percent || '40';
        document.getElementById('equity-funds').textContent = (allocationPlan.recommended_fund_categories && allocationPlan.recommended_fund_categories.equity) ? allocationPlan.recommended_fund_categories.equity.join(', ') : 'N/A';
        document.getElementById('debt-funds').textContent = (allocationPlan.recommended_fund_categories && allocationPlan.recommended_fund_categories.debt) ? allocationPlan.recommended_fund_categories.debt.join(', ') : 'N/A';
        document.getElementById('elss-optional').textContent = allocationPlan.recommended_fund_categories && allocationPlan.recommended_fund_categories.elss_optional ? 'Yes' : 'No';


        // Allocation Notes Section
        document.getElementById('risk-notes').textContent = (allocationPlan.notes && allocationPlan.notes[goalInput.risk_appetite]) || 'N/A';

        // Validation Status
        document.getElementById('validation-status').textContent = sipCalc.status || 'ok';

        // SIP Projection Table
        var projectionTableBody = document.getElementById('projection-table-body');
        var projectionLabels = cd.projection && cd.projection.labels ? cd.projection.labels : [];
        var cumulativeContributionData = cd.projection && cd.projection.datasets && cd.projection.datasets.cumulative_contribution ? cd.projection.datasets.cumulative_contribution : [];
        var projectedCorpusData = cd.projection && cd.projection.datasets && cd.projection.datasets.projected_corpus ? cd.projection.datasets.projected_corpus : [];

        for (var i = 0; i < Math.min(12, projectionLabels.length); i++) {
            var row = projectionTableBody.insertRow();
            var monthCell = row.insertCell();
            var contributionCell = row.insertCell();
            var corpusCell = row.insertCell();

            monthCell.textContent = projectionLabels[i];
            contributionCell.textContent = cumulativeContributionData[i] || 0;
            corpusCell.textContent = projectedCorpusData[i] || 0;
        }


        var proj = cd.projection || {labels: [], datasets: {cumulative_contribution: [], projected_corpus: []}};
        new Chart(document.getElementById('sipProjectionChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: proj.labels || [],
                datasets: [
                    {
                        label: 'Projected Corpus',
                        data: (proj.datasets && proj.datasets.projected_corpus) || [],
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    },
                    {
                        label: 'Cumulative Contribution',
                        data: (proj.datasets && proj.datasets.cumulative_contribution) || [],
                        fill: false,
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        var alloc = cd.allocation || {labels: ["Equity", "Debt"], data: [60, 40]};
        new Chart(document.getElementById('sipAllocationChart').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: alloc.labels || ["Equity", "Debt"],
                datasets: [{
                    data: alloc.data || [60, 40],
                    backgroundColor: [
                        'rgb(54, 162, 235)',
                        'rgb(255, 205, 86)'
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        document.getElementById('dl').addEventListener('click', function() {
            var blob = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
            var a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'comprehensive_report.html';
            a.click();
        });
    })();
    </script>
</body>
</html>