{
  "directed": true,
  "multigraph": false,
  "graph": {
    "session_id": "58392968",
    "original_query": "################################################################################################\n# FUND RECOMMENDATION ORCHESTRATOR AGENT vX.X - GENERIC TEMPLATE\n# Role: Coordinate fund screening, analysis, and recommendation pipeline\n# Input: SIP-derived investment profile and allocation requirements\n# Output: Comprehensive fund recommendation system with performance analysis\n################################################################################################\n\nYou are the **Fund Recommendation Orchestrator Agent**.\n\nYour first action is to call **FundRecommendationAgent** to process investment profile, screen funds, compute performance metrics, apply risk-weighted ranking, and generate fund recommendations.\n\nDo not build any fund recommendation plans until you have read FundRecommendationAgent's outputs.\n\n## ðŸ”§ WIRING REQUIREMENT\n\n**FundRecommendationAgent** MUST first read the outputs from SIP analysis (investment_profile, asset_allocation, portfolio_requirements) before creating the final multi-agent plan graph for:\n- Fund data retrieval and normalization\n- Performance and risk analysis  \n- Ranking and scoring algorithms\n- Comparative analysis and explanations\n- Chart generation and reporting\n\n**Preparation Requirements:**\n- Prepare JSON outputs for fund performance charts using CoderAgent\n- Prepare data for top fund recommendations table using CoderAgent  \n- Generate fund allocation breakdown using CoderAgent\n- Create risk-return scatter plots using derived parameters\n\n## ðŸŽ¯ USER SCENARIO - Retirement PLANNING (10-YEAR HORIZON)\n\nProcess fund recommendations based on SIP-derived investment profile:\n\n**Input Data Structure (from SIP Report):**\n```json\n{\n  \"investment_profile\": {\n    \"goal_type\": \"Retirement\",\n    \"current_age\": 50,\n    \"event_age_or_target\": 60, \n    \"risk_appetite\": \"Moderate\", \n    \"time_horizon\": 10,\n    \"monthly_sip_required\": 250161.45,\n    \"target_amount_inflation_adjusted\": 51244328.18,\n    \"assumed_annual_return\": 10.0,\n    \"unadjusted_target\": 30000000,\n    \"inflation_rate\": 5.5\n  },\n  \"asset_allocation\": {\n    \"equity_percent\": 50,\n    \"debt_percent\": 50,\n    \"allocation_strategy\": \"Balanced 50/50 Equity/Debt\"\n  },\n  \"portfolio_requirements\": {\n    \"total_monthly_amount\": 250161.45,\n    \"equity_monthly_amount\": 125080.73, \n    \"debt_monthly_amount\": 125080.72\n  }\n}\n```\n\n## ðŸ§® COMPUTE (DETERMINISTIC)\n\n**Risk Profile Mapping (goal-specific adjustments):**\n```json\n{\n  \"risk_to_fund_weights\": {\n    \"Moderate\": {\n      \"cagr\": 0.25, \n      \"sharpe\": 0.30, \n      \"expense\": 0.15, \n      \"rating\": 0.10,\n      \"consistency\": 0.15,\n      \"liquidity_or_downside\": 0.05\n    }\n  }\n}\n```\n\n**Goal-Specific Adjustments (phases):**\n- **Early Phase**: (Years 1-3) Focus on capital appreciation with a balanced approach. Establish the core portfolio and ensure consistent investment.\n- **Mid Phase**: (Years 4-7) Continue accumulation, monitor performance against benchmarks, and begin slight de-risking if goals are significantly ahead of schedule.\n- **Final Phase**: (Years 8-10) Prioritize capital protection. Systematically shift from equity to lower-risk debt instruments to lock in gains and reduce volatility ahead of retirement.\n- **Additional Considerations**: Plan for a systematic withdrawal plan (SWP) post-retirement. Utilize tax-saving instruments like ELSS to optimize the equity portion. Ensure the debt component is finalized to maintain the moderate risk profile.\n\n## ðŸ“‹ DO (STEP-BY-STEP)\n\n1. **Input Normalization** â†’ Emit `fund_input_profile_json`\n2. **Fund Data Retrieval** â†’ Call RetrieverAgent for goal-specific fund datasets  \n3. **Performance Analysis** â†’ Refer \"Performance & Risk Computation\" from FundRecommendationAgent\n4. **Risk-Weighted Scoring** â†’ Refer \"Ranking Algorithm\" from FundRecommendationAgent  \n5. **Fund Selection** â†’ Refer \"Goal-Optimized Selection\" from FundRecommendationAgent\n6. **Output Generation** â†’ Emit structured fund recommendation JSONs\n\n**Fund Category Guidelines for Moderate (Retirement):**\n```json\n{\n  \"category_guidelines\": {\n    \"equity_allocation\": {\n      \"core\": [\"Large & Mid Cap Funds\"],\n      \"growth_satellite\": [\"Mid Cap Funds\"],\n      \"tax_saver\": [\"ELSS Funds\"]\n    },\n    \"debt_allocation\": {\n      \"core\": [\"Corporate Bond Funds\"],\n      \"liquidity\": [\"Short Duration Funds\"]\n    },\n    \"optional_considerations\": {\n      \"alternatives\": [\"Flexi Cap Funds as a substitute for separate Large/Mid Cap funds.\"]\n    }\n  }\n}\n```\n\n## ðŸ“Š VISUALIZATION REQUIREMENTS\n\n**Charts for ReportGeneratorAgent:**\n- Fund Performance Chart (historical NAV)\n- Risk-Return Scatter\n- Category Allocation Breakdown\n- Expense Ratio Impact\n- Goal-Specific Timeline (glide path, liquidity, or de-risking)\n\n## ðŸ“ SCHEMAS\n\n- **fund_input_profile_json**\n- **fund_master_json**\n- **fund_performance_json**\n- **fund_ranking_json**\n- **fund_portfolio_json**\n- **fund_analysis_json**\n\n(Use the JSON schema blocks from specialized templates as reference, swap placeholders.)\n\n## ðŸ”„ INTEGRATION FLOW\n\n```mermaid\ngraph TD\n    A[SIP Retirement Analysis] --> B[Fund Input Profile]\n    B --> C[RetrieverAgent: Fund Universe]\n    C --> D[FundRecommendationAgent: 10-Year Analysis]\n    D --> E[Performance Computation]\n    E --> F[Goal-Weighted Ranking] \n    F --> G[Phase-Appropriate Portfolio]\n    G --> H[CoderAgent: Charts]\n    H --> I[ReportGeneratorAgent: Final Output]\n    I --> J[QAAgent: Validation]\n```\n\n## ðŸ“‹ MANDATORY REPORT SECTIONS\n\n1. Executive Summary  \n2. Retirement Investment Profile  \n3. Asset Allocation Strategy  \n4. Fund Performance Analysis  \n5. Top Fund Recommendations  \n6. Portfolio Construction  \n7. Risk Analysis (â‰¥150 words)  \n8. Implementation Roadmap  \n9. Comparison Charts  \n10. Rebalancing Strategy (phase/age-based)  \n11. Tax Optimization  \n12. Goal Timeline Scenarios (e.g., early/late event impact)\n\n## ðŸš¨ CRITICAL REQUIREMENTS\n\n- MUST validate SIP corpus math\n- MUST achieve inflation-adjusted target\n- MUST align allocations with goal-specific horizon\n- MUST include monthly SIP split validation\n- MUST provide rebalancing & tax strategies\n- STRICT JSON output only\n\n################################################################################################",
    "file_manifest": [],
    "created_at": "2025-09-20T18:29:28.714776",
    "status": "running",
    "output_chain": {},
    "validation_results": {
      "is_valid": true,
      "is_dag": true,
      "cycles": [],
      "disconnected_components": [],
      "orphaned_nodes": [],
      "root_nodes": [],
      "leaf_nodes": [
        "T026"
      ],
      "warnings": [],
      "errors": []
    }
  },
  "nodes": [
    {
      "description": "Initial Query",
      "agent": "System",
      "status": "completed",
      "id": "ROOT"
    },
    {
      "id": "T020",
      "description": "Process SIP-derived retirement profile and generate initial fund recommendations",
      "agent": "FundRecommendationAgent",
      "agent_prompt": "You are FundRecommendationAgent. A detailed, SIP-derived investment profile for retirement planning has been provided. Your task is to process this input and generate a foundational analysis. GOAL CONTEXT: Retirement planning with a 10-year timeline, 'Moderate' risk tolerance, and a â‚¹250,161.45 monthly investment capacity. The inflation-adjusted target corpus is â‚¹51,244,328.18. FUND SELECTION PRIORITY: Follow the provided phased strategy: Years 1-3 (capital appreciation), Years 4-7 (accumulation and monitoring), Years 8-10 (capital protection and systematic de-risking). Adhere strictly to the provided category guidelines for a 50/50 Equity/Debt allocation: Equity (Large & Mid Cap, Mid Cap, ELSS) and Debt (Corporate Bond, Short Duration). Apply the specified risk-to-fund weighting for a 'Moderate' profile (CAGR: 0.25, Sharpe: 0.30, etc.). Your output must include fund_master_json, fund_screening_json, fund_ranking_json, and fund_explain_json, all tailored to this retirement scenario. STRICT JSON only.",
      "reads": [],
      "writes": [
        "T020"
      ],
      "status": "running",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": "2025-09-20T18:29:28.796895",
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T021",
      "description": "Fetch comprehensive fund datasets tailored for the retirement plan",
      "agent": "RetrieverAgent",
      "agent_prompt": "Based on the fund categories and screening criteria from T020's output, fetch comprehensive fund data. Focus on the retirement context by prioritizing funds with consistent long-term performance and conservative progression characteristics. The categories to retrieve data for are: Large & Mid Cap, Mid Cap, ELSS, Corporate Bond, and Short Duration funds. PRIMARY SOURCES: AMFI, Value Research, Morningstar, CRISIL ratings, and fund factsheets. Gather NAV history for performance calculation, AUM, expense ratios, fund manager details, and portfolio holdings. OUTPUT: A comprehensive fund_datasets_json file.",
      "reads": [
        "T020"
      ],
      "writes": [
        "T021"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T022",
      "description": "Analyze fund data and create a detailed 10-year phased retirement investment strategy",
      "agent": "ThinkerAgent",
      "agent_prompt": "Analyze the fund data from T021 based on the strategy defined in T020. Create an optimal investment strategy for the 10-year retirement goal. Your analysis must incorporate: (1) The three-phase approach (Early: appreciation, Mid: accumulation, Final: protection) with specific fund allocation adjustments for each phase. (2) A detailed portfolio construction plan aligning with the 50% equity and 50% debt strategic allocation. (3) A clear rebalancing methodology based on the phase/age. (4) Tax efficiency optimization, particularly integrating the ELSS component. (5) A forward-looking implementation timeline. OUTPUT: A comprehensive fund_strategy_json with portfolio allocation, implementation roadmap, and monitoring framework.",
      "reads": [
        "T020",
        "T021"
      ],
      "writes": [
        "T022"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T023",
      "description": "Validate fund recommendation outputs for accuracy, consistency, and goal alignment",
      "agent": "QAAgent",
      "agent_prompt": "Perform a comprehensive validation of the fund recommendation workflow outputs from T020, T021, and T022. VALIDATION AREAS: (1) Verify portfolio allocation percentages sum to 100% and that the monthly split matches the required â‚¹125,080.73 for equity and â‚¹125,080.72 for debt. (2) Ensure risk profile consistency across all selected funds (i.e., no high-risk funds for a moderate profile). (3) Confirm goal alignment: verify that the selected funds and strategy are appropriate for a 10-year retirement horizon. (4) Check data integrity for performance metrics, expense ratios, and ratings. (5) Flag any inconsistencies or gaps requiring attention before report generation.",
      "reads": [
        "T020",
        "T021",
        "T022"
      ],
      "writes": [
        "T023"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T024",
      "description": "Generate all required fund visualization data for the retirement report",
      "agent": "CoderAgent",
      "agent_prompt": "Create all required fund recommendation charts from the outputs of T020, T021, and T022. Generate a single `fund_charts_data.json` file. The file must contain data structures for these specific Chart.js visualizations: (1) Fund Performance Chart (historical performance of top recommended funds). (2) Risk-Return Scatter Plot (volatility vs. CAGR for selected funds). (3) Category Allocation Breakdown (visualizing the 50/50 split and sub-category distribution). (4) Expense Ratio Comparison chart. (5) Goal-Specific Timeline chart illustrating the de-risking glide path over the 10-year horizon. Ensure realistic fallback data is present for any missing metrics. Set code = {} and call_self = false. OUTPUT: A single `fund_charts_data.json` file.",
      "reads": [
        "T020",
        "T021",
        "T022"
      ],
      "writes": [
        "T024"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T025",
      "description": "Format the comprehensive retirement fund recommendation report structure",
      "agent": "FormatterAgent",
      "agent_prompt": "Create the comprehensive HTML structure for the retirement fund recommendation report using all preceding outputs. The report must be meticulously structured into the 12 mandatory sections: (1) Executive Summary, (2) Retirement Investment Profile, (3) Asset Allocation Strategy, (4) Fund Performance Analysis, (5) Top Fund Recommendations, (6) Portfolio Construction, (7) Risk Analysis (must be â‰¥150 words), (8) Implementation Roadmap, (9) Comparison Charts (placeholders for charts from T024), (10) Rebalancing Strategy (phase/age-based), (11) Tax Optimization, (12) Goal Timeline Scenarios. Use rich formatting, tables, and clear headings. OUTPUT: A single `fund_recommendation_formatted.html` file.",
      "reads": [
        "T020",
        "T021",
        "T022",
        "T023",
        "T024"
      ],
      "writes": [
        "T025"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T026",
      "description": "Generate the final, comprehensive retirement fund recommendation report",
      "agent": "ReportGeneratorAgent",
      "agent_prompt": "Package the final retirement fund recommendation report. Take the formatted HTML content from T025 and embed the Chart.js visualizations using the data from T024's `fund_charts_data.json`. The final output must be a single, standalone, executive-grade `fund_comprehensive_report.html` file. Ensure the report is professionally styled, interactive where applicable (e.g., tables), and includes print/download functionality. The report must be a complete and polished deliverable.",
      "reads": [
        "T024",
        "T025"
      ],
      "writes": [
        "T026"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    }
  ],
  "links": [
    {
      "source": "ROOT",
      "target": "T020"
    },
    {
      "source": "T020",
      "target": "T021"
    },
    {
      "source": "T020",
      "target": "T022"
    },
    {
      "source": "T020",
      "target": "T023"
    },
    {
      "source": "T020",
      "target": "T024"
    },
    {
      "source": "T020",
      "target": "T025"
    },
    {
      "source": "T021",
      "target": "T022"
    },
    {
      "source": "T021",
      "target": "T023"
    },
    {
      "source": "T021",
      "target": "T024"
    },
    {
      "source": "T021",
      "target": "T025"
    },
    {
      "source": "T022",
      "target": "T023"
    },
    {
      "source": "T022",
      "target": "T024"
    },
    {
      "source": "T022",
      "target": "T025"
    },
    {
      "source": "T023",
      "target": "T025"
    },
    {
      "source": "T024",
      "target": "T025"
    },
    {
      "source": "T024",
      "target": "T026"
    },
    {
      "source": "T025",
      "target": "T026"
    }
  ]
}