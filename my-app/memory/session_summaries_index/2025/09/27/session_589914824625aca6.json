{
  "directed": true,
  "multigraph": false,
  "graph": {
    "session_id": "589914824625aca6",
    "original_query": "################################################################################################\n# FUND RECOMMENDATION ORCHESTRATOR AGENT vX.X - GENERIC TEMPLATE\n# Role: Coordinate fund screening, analysis, and recommendation pipeline\n# Input: SIP-derived investment profile and allocation requirements\n# Output: Comprehensive fund recommendation system with performance analysis\n################################################################################################\n\nYou are the **Fund Recommendation Orchestrator Agent**.\n\nYour first action is to call **FundRecommendationAgent** to process investment profile, screen funds, compute performance metrics, apply risk-weighted ranking, and generate fund recommendations.\n\nDo not build any fund recommendation plans until you have read FundRecommendationAgent's outputs.\n\n## 🔧 WIRING REQUIREMENT\n\n**FundRecommendationAgent** MUST first read the outputs from SIP analysis (investment_profile, asset_allocation, portfolio_requirements) before creating the final multi-agent plan graph for:\n- Fund data retrieval and normalization\n- Performance and risk analysis  \n- Ranking and scoring algorithms\n- Comparative analysis and explanations\n- Chart generation and reporting\n\n**Preparation Requirements:**\n- Prepare JSON outputs for fund performance charts using CoderAgent\n- Prepare data for top fund recommendations table using CoderAgent  \n- Generate fund allocation breakdown using CoderAgent\n- Create risk-return scatter plots using derived parameters\n\n## 🎯 USER SCENARIO - GENERAL WEALTH CREATION PLANNING (10-YEAR HORIZON)\n\nProcess fund recommendations based on SIP-derived investment profile:\n\n**Input Data Structure (from SIP Report):**\n```json\n{\n  \"investment_profile\": {\n    \"goal_type\": \"General Wealth Creation\",\n    \"current_age\": 30,\n    \"event_age_or_target\": 40, \n    \"risk_appetite\": \"moderate\", \n    \"time_horizon\": 10,\n    \"monthly_sip_required\": 25000,\n    \"target_amount_inflation_adjusted\": 5000000,\n    \"assumed_annual_return\": 10.0,\n    \"unadjusted_target\": 5000000,\n    \"inflation_rate\": 6.0\n  },\n  \"asset_allocation\": {\n    \"equity_percent\": 60,\n    \"debt_percent\": 40,\n    \"allocation_strategy\": \"60-40 Strategy\"\n  },\n  \"portfolio_requirements\": {\n    \"total_monthly_amount\": 25000,\n    \"equity_monthly_amount\": 15000, \n    \"debt_monthly_amount\": 10000\n  }\n}\n```\n\n## 🧮 COMPUTE (DETERMINISTIC)\n\n**Risk Profile Mapping (goal-specific adjustments):**\n```json\n{\n  \"risk_to_fund_weights\": {\n    \"moderate\": {\n      \"cagr\": 0.3, \n      \"sharpe\": 0.25, \n      \"expense\": 0.15, \n      \"rating\": 0.15,\n      \"consistency\": 0.1,\n      \"liquidity_or_downside\": 0.05\n    }\n  }\n}\n```\n\n**Goal-Specific Adjustments (phases):**\n- **Early Phase**: Growth and accumulation\n- **Mid Phase**: Balanced growth and risk management\n- **Final Phase**: Capital preservation and liquidity\n- **Additional Considerations**: Optimized for General Wealth Creation with 10-year horizon\n\n## 📋 DO (STEP-BY-STEP)\n\n1. **Input Normalization** → Emit `fund_input_profile_json`\n2. **Fund Data Retrieval** → Call RetrieverAgent for goal-specific fund datasets  \n3. **Performance Analysis** → Refer \"Performance & Risk Computation\" from FundRecommendationAgent\n4. **Risk-Weighted Scoring** → Refer \"Ranking Algorithm\" from FundRecommendationAgent  \n5. **Fund Selection** → Refer \"Goal-Optimized Selection\" from FundRecommendationAgent\n6. **Output Generation** → Emit structured fund recommendation JSONs\n\n**Fund Category Guidelines for moderate (General Wealth Creation):**\n```json\n{\n  \"category_guidelines\": {\n    \"equity_allocation\": { ... },\n    \"debt_allocation\": { ... },\n    \"optional_considerations\": { ... }\n  }\n}\n```\n\n## 📊 VISUALIZATION REQUIREMENTS\n\n**Charts for ReportGeneratorAgent:**\n- Fund Performance Chart (historical NAV)\n- Risk-Return Scatter\n- Category Allocation Breakdown\n- Expense Ratio Impact\n- Goal-Specific Timeline (glide path, liquidity, or de-risking)\n\n## 📝 SCHEMAS\n\n- **fund_input_profile_json**\n- **fund_master_json**\n- **fund_performance_json**\n- **fund_ranking_json**\n- **fund_portfolio_json**\n- **fund_analysis_json**\n\n(Use the JSON schema blocks from specialized templates as reference, swap placeholders.)\n\n## 🔄 INTEGRATION FLOW\n\n```mermaid\ngraph TD\n    A[SIP General Wealth Creation Analysis] --> B[Fund Input Profile]\n    B --> C[RetrieverAgent: Fund Universe]\n    C --> D[FundRecommendationAgent: {{time_horizon}}-Year Analysis]\n    D --> E[Performance Computation]\n    E --> F[Goal-Weighted Ranking] \n    F --> G[Phase-Appropriate Portfolio]\n    G --> H[CoderAgent: Charts]\n    H --> I[ReportGeneratorAgent: Final Output]\n    I --> J[QAAgent: Validation]\n```\n\n## 📋 MANDATORY REPORT SECTIONS\n\n1. Executive Summary  \n2. General Wealth Creation Investment Profile  \n3. Asset Allocation Strategy  \n4. Fund Performance Analysis  \n5. Top Fund Recommendations  \n6. Portfolio Construction  \n7. Risk Analysis (≥150 words)  \n8. Implementation Roadmap  \n9. Comparison Charts  \n10. Rebalancing Strategy (phase/age-based)  \n11. Tax Optimization  \n12. Goal Timeline Scenarios (e.g., early/late event impact)\n\n## 🚨 CRITICAL REQUIREMENTS\n\n- MUST validate SIP corpus math\n- MUST achieve inflation-adjusted target\n- MUST align allocations with goal-specific horizon\n- MUST include monthly SIP split validation\n- MUST provide rebalancing & tax strategies\n- STRICT JSON output only\n\n################################################################################################\n",
    "file_manifest": [],
    "created_at": "2025-09-27T16:44:42.000191",
    "status": "running",
    "output_chain": {
      "T020": {
        "initial_thoughts": "Processing the user's investment profile for General Wealth Creation. Setting up the strategic framework for fund screening and ranking based on a moderate risk profile, a 10-year horizon, and a â‚¹25,000 monthly SIP. Preparing for data retrieval and analysis by defining scoring weights and fund category preferences. The output is structured to guide the subsequent data retrieval and analysis steps.",
        "output": {
          "fund_input_profile_json": {
            "investment_profile": {
              "goal_type": "General Wealth Creation",
              "current_age": 30,
              "event_age_or_target": 40,
              "risk_appetite": "moderate",
              "time_horizon": 10,
              "monthly_sip_required": 25000,
              "target_amount_inflation_adjusted": 5000000,
              "assumed_annual_return": 10.0,
              "unadjusted_target": 5000000,
              "inflation_rate": 6.0
            },
            "asset_allocation": {
              "equity_percent": 60,
              "debt_percent": 40,
              "allocation_strategy": "60-40 Strategy"
            },
            "portfolio_requirements": {
              "total_monthly_amount": 25000,
              "equity_monthly_amount": 15000,
              "debt_monthly_amount": 10000
            }
          },
          "goal_context": {
            "goal_type": "General Wealth Creation",
            "time_horizon": 10,
            "risk_profile_mapped": "moderate",
            "target_monthly_amount": 25000,
            "scoring_weights": {
              "cagr": 0.3,
              "sharpe": 0.25,
              "expense": 0.15,
              "rating": 0.15,
              "consistency": 0.1,
              "liquidity_or_downside": 0.05
            }
          },
          "fund_master_json": [],
          "fund_screening_json": [],
          "fund_ranking_json": [],
          "fund_explain_json": {
            "strategy_rationale": "The fund selection strategy is designed for a 'moderate' risk profile with a 10-year horizon for wealth creation. The scoring model prioritizes a balance between long-term growth (CAGR weight: 0.3) and risk-adjusted returns (Sharpe Ratio weight: 0.25). Expense ratios and fund ratings are also significant factors (0.15 weight each) to ensure cost efficiency and quality. The 60/40 equity-debt split aims to capture growth while providing a cushion against market volatility. Recommended equity categories will include Large & Mid Cap and Flexi Cap for growth, while debt will focus on Short to Medium Duration funds for stability.",
            "comparisons": []
          },
          "implementation_strategy": {
            "immediate_allocation": "Begin monthly SIP of â‚¹25,000 immediately, split into â‚¹15,000 for equity funds and â‚¹10,000 for debt funds as per the recommended allocation.",
            "gradual_deployment": "Not applicable for a monthly SIP model. Full allocation starts from month one.",
            "rebalancing_schedule": "Annual rebalancing is recommended to maintain the 60/40 asset allocation. A review should be triggered if the equity or debt allocation deviates by more than 5% from the target."
          },
          "tax_optimization": {
            "elss_recommendation": "Consider allocating a portion of the â‚¹15,000 equity SIP (up to â‚¹12,500/month) to an ELSS fund to utilize the Section 80C tax deduction limit of â‚¹1.5 lakh annually. This aligns with the long-term horizon as ELSS funds have a 3-year lock-in.",
            "ltcg_strategy": "All equity investments should be held for more than one year to qualify for Long-Term Capital Gains (LTCG) tax, which is more favorable. The 10-year horizon is well-suited for this.",
            "debt_taxation": "Debt fund investments will be subject to Short-Term Capital Gains (STCG) tax if redeemed within 3 years, taxed at the investor's slab rate. For holdings over 3 years, they will qualify for LTCG with indexation benefits. This should be considered during rebalancing or partial withdrawals."
          }
        },
        "call_self": false,
        "cost": 0.0008561249999999999,
        "input_tokens": 3037.5,
        "output_tokens": 667.5,
        "total_tokens": 3705.0
      }
    },
    "validation_results": {
      "is_valid": true,
      "is_dag": true,
      "cycles": [],
      "disconnected_components": [],
      "orphaned_nodes": [],
      "root_nodes": [],
      "leaf_nodes": [
        "T026"
      ],
      "warnings": [],
      "errors": []
    }
  },
  "nodes": [
    {
      "description": "Initial Query",
      "agent": "System",
      "status": "completed",
      "id": "ROOT"
    },
    {
      "id": "T020",
      "description": "Ingest and process SIP-derived investment profile for General Wealth Creation to establish fund recommendation strategy.",
      "agent": "FundRecommendationAgent",
      "agent_prompt": "You are FundRecommendationAgent. Your task is to process a fund recommendation request with pre-existing SIP context. Ingest the following investment profile and generate a strategic framework for subsequent analysis. GOAL CONTEXT: General Wealth Creation planning with a 10-year timeline, 'moderate' risk tolerance, and a ₹25,000 monthly investment capacity. TARGET: ₹5,000,000 inflation-adjusted corpus. FUND SELECTION PRIORITY: Growth-oriented funds for long-term wealth creation, a balanced approach suitable for a 10-year timeline, and tax efficiency. Use the provided data to emit core strategic outputs: `fund_input_profile_json`, `fund_master_json`, `fund_screening_json`, and `fund_explain_json`.\n\n### Input Data (from SIP Report):\n```json\n{\n  \"investment_profile\": {\n    \"goal_type\": \"General Wealth Creation\",\n    \"current_age\": 30,\n    \"event_age_or_target\": 40, \n    \"risk_appetite\": \"moderate\", \n    \"time_horizon\": 10,\n    \"monthly_sip_required\": 25000,\n    \"target_amount_inflation_adjusted\": 5000000,\n    \"assumed_annual_return\": 10.0,\n    \"unadjusted_target\": 5000000,\n    \"inflation_rate\": 6.0\n  },\n  \"asset_allocation\": {\n    \"equity_percent\": 60,\n    \"debt_percent\": 40,\n    \"allocation_strategy\": \"60-40 Strategy\"\n  },\n  \"portfolio_requirements\": {\n    \"total_monthly_amount\": 25000,\n    \"equity_monthly_amount\": 15000, \n    \"debt_monthly_amount\": 10000\n  }\n}\n```\n\n### Risk Profile Mapping:\nUse these weights for scoring:\n```json\n{\n  \"risk_to_fund_weights\": {\n    \"moderate\": {\n      \"cagr\": 0.3, \n      \"sharpe\": 0.25, \n      \"expense\": 0.15, \n      \"rating\": 0.15,\n      \"consistency\": 0.1,\n      \"liquidity_or_downside\": 0.05\n    }\n  }\n}\n```\nOUTPUT: A structured JSON object containing the processed profile and the strategic guidelines for fund screening and ranking.",
      "reads": [],
      "writes": [
        "T020"
      ],
      "status": "completed",
      "output": {
        "initial_thoughts": "Processing the user's investment profile for General Wealth Creation. Setting up the strategic framework for fund screening and ranking based on a moderate risk profile, a 10-year horizon, and a â‚¹25,000 monthly SIP. Preparing for data retrieval and analysis by defining scoring weights and fund category preferences. The output is structured to guide the subsequent data retrieval and analysis steps.",
        "output": {
          "fund_input_profile_json": {
            "investment_profile": {
              "goal_type": "General Wealth Creation",
              "current_age": 30,
              "event_age_or_target": 40,
              "risk_appetite": "moderate",
              "time_horizon": 10,
              "monthly_sip_required": 25000,
              "target_amount_inflation_adjusted": 5000000,
              "assumed_annual_return": 10.0,
              "unadjusted_target": 5000000,
              "inflation_rate": 6.0
            },
            "asset_allocation": {
              "equity_percent": 60,
              "debt_percent": 40,
              "allocation_strategy": "60-40 Strategy"
            },
            "portfolio_requirements": {
              "total_monthly_amount": 25000,
              "equity_monthly_amount": 15000,
              "debt_monthly_amount": 10000
            }
          },
          "goal_context": {
            "goal_type": "General Wealth Creation",
            "time_horizon": 10,
            "risk_profile_mapped": "moderate",
            "target_monthly_amount": 25000,
            "scoring_weights": {
              "cagr": 0.3,
              "sharpe": 0.25,
              "expense": 0.15,
              "rating": 0.15,
              "consistency": 0.1,
              "liquidity_or_downside": 0.05
            }
          },
          "fund_master_json": [],
          "fund_screening_json": [],
          "fund_ranking_json": [],
          "fund_explain_json": {
            "strategy_rationale": "The fund selection strategy is designed for a 'moderate' risk profile with a 10-year horizon for wealth creation. The scoring model prioritizes a balance between long-term growth (CAGR weight: 0.3) and risk-adjusted returns (Sharpe Ratio weight: 0.25). Expense ratios and fund ratings are also significant factors (0.15 weight each) to ensure cost efficiency and quality. The 60/40 equity-debt split aims to capture growth while providing a cushion against market volatility. Recommended equity categories will include Large & Mid Cap and Flexi Cap for growth, while debt will focus on Short to Medium Duration funds for stability.",
            "comparisons": []
          },
          "implementation_strategy": {
            "immediate_allocation": "Begin monthly SIP of â‚¹25,000 immediately, split into â‚¹15,000 for equity funds and â‚¹10,000 for debt funds as per the recommended allocation.",
            "gradual_deployment": "Not applicable for a monthly SIP model. Full allocation starts from month one.",
            "rebalancing_schedule": "Annual rebalancing is recommended to maintain the 60/40 asset allocation. A review should be triggered if the equity or debt allocation deviates by more than 5% from the target."
          },
          "tax_optimization": {
            "elss_recommendation": "Consider allocating a portion of the â‚¹15,000 equity SIP (up to â‚¹12,500/month) to an ELSS fund to utilize the Section 80C tax deduction limit of â‚¹1.5 lakh annually. This aligns with the long-term horizon as ELSS funds have a 3-year lock-in.",
            "ltcg_strategy": "All equity investments should be held for more than one year to qualify for Long-Term Capital Gains (LTCG) tax, which is more favorable. The 10-year horizon is well-suited for this.",
            "debt_taxation": "Debt fund investments will be subject to Short-Term Capital Gains (STCG) tax if redeemed within 3 years, taxed at the investor's slab rate. For holdings over 3 years, they will qualify for LTCG with indexation benefits. This should be considered during rebalancing or partial withdrawals."
          }
        },
        "call_self": false,
        "cost": 0.0008561249999999999,
        "input_tokens": 3037.5,
        "output_tokens": 667.5,
        "total_tokens": 3705.0
      },
      "error": null,
      "cost": 0.0,
      "start_time": "2025-09-27T16:44:42.017368",
      "end_time": "2025-09-27T16:45:40.721635",
      "execution_time": 58.704267,
      "input_tokens": 0,
      "output_tokens": 0,
      "execution_result": null
    },
    {
      "id": "T021",
      "description": "Fetch comprehensive fund datasets based on the defined investment strategy.",
      "agent": "RetrieverAgent",
      "agent_prompt": "Based on the strategic guidelines from T020, fetch comprehensive fund data. Focus on categories suitable for a 'moderate' risk profile with a 60/40 Equity-Debt split, such as Large & Mid-Cap, Flexi Cap, and high-quality Corporate Bond / Gilt funds. Retrieve data from primary sources like AMFI, Morningstar, and Value Research. Data points must include NAV history (5Y), AUM, expense ratios, fund manager details, portfolio holdings, and risk metrics (Standard Deviation, Sharpe Ratio). Output a comprehensive `fund_datasets.json`.",
      "reads": [
        "T020"
      ],
      "writes": [
        "T021"
      ],
      "status": "failed",
      "output": null,
      "error": "503 UNAVAILABLE. {'error': {'code': 503, 'message': 'The service is currently unavailable.', 'status': 'UNAVAILABLE'}}",
      "cost": 0.0,
      "start_time": "2025-09-27T16:45:40.728611",
      "end_time": "2025-09-27T16:46:14.874182",
      "execution_time": 34.145571
    },
    {
      "id": "T022",
      "description": "Perform in-depth fund analysis, scoring, and construct the recommended portfolio.",
      "agent": "ThinkerAgent",
      "agent_prompt": "Using the strategic framework from T020 and the raw data from T021, perform a comprehensive analysis. Your tasks are: 1. Compute performance metrics (1Y, 3Y, 5Y CAGR), risk metrics (Sharpe Ratio, Sortino Ratio), and consistency scores. 2. Apply the risk-weighted scoring algorithm defined in T020 to rank all screened funds. 3. Construct an optimized fund portfolio that aligns with the ₹15,000 equity and ₹10,000 debt monthly allocation. 4. Develop a phase-based rebalancing strategy for the 10-year horizon. 5. Formulate tax optimization strategies (e.g., suggesting ELSS if applicable within the equity portion). Output `fund_performance.json`, `fund_ranking.json`, and `fund_portfolio.json`.",
      "reads": [
        "T020",
        "T021"
      ],
      "writes": [
        "T022"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T023",
      "description": "Validate the entire fund recommendation workflow for accuracy and alignment.",
      "agent": "QAAgent",
      "agent_prompt": "Conduct a comprehensive validation of the outputs from T020, T021, and T022. Verify the following: 1. The final portfolio allocation sums to ₹25,000 monthly and respects the 60/40 split. 2. All fund performance and risk calculations are mathematically sound. 3. The selected funds are consistent with the 'moderate' risk profile. 4. The generated portfolio aligns with the 'General Wealth Creation' goal and 10-year horizon. 5. All data is complete and there are no missing values in the final recommendations. Document any inconsistencies or gaps in a `validation_summary.txt` file.",
      "reads": [
        "T020",
        "T021",
        "T022"
      ],
      "writes": [
        "T023"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T024",
      "description": "Generate data for all required visualizations and charts.",
      "agent": "CoderAgent",
      "agent_prompt": "Read the analysis and portfolio data from T022. Generate a single JSON file named `fund_charts_data.json` containing data structures ready for Chart.js rendering. Do not perform any new calculations. Create data for the following charts: 1. Fund Performance Comparison (line chart showing 1Y, 3Y, 5Y CAGR for top 3 recommended funds). 2. Risk-Return Scatter Plot (scatter plot of volatility vs. returns for all screened funds). 3. Portfolio Allocation Breakdown (doughnut chart showing equity/debt and sub-category splits). 4. Expense Ratio Comparison (bar chart comparing expense ratios of recommended funds). Set `code = {}` and `call_self = false`.",
      "reads": [
        "T022"
      ],
      "writes": [
        "T024"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T025",
      "description": "Format the comprehensive fund recommendation report content in HTML.",
      "agent": "FormatterAgent",
      "agent_prompt": "Synthesize all information from T020, T022, and T023 to create a well-structured and formatted HTML report body. The report must include all 12 mandatory sections: Executive Summary, Investment Profile, Asset Allocation Strategy, Performance Analysis, Top Recommendations, Portfolio Construction, Risk Analysis (min. 150 words), Implementation Roadmap, Comparison Charts (placeholders for charts), Rebalancing Strategy, Tax Optimization, and Goal Timeline Scenarios. Use clear headings, tables for data, and bullet points for recommendations. Pass the final formatted content as `fund_recommendation_formatted.html`.",
      "reads": [
        "T020",
        "T022",
        "T023",
        "T024"
      ],
      "writes": [
        "T025"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    },
    {
      "id": "T026",
      "description": "Generate the final, standalone comprehensive fund recommendation report.",
      "agent": "ReportGeneratorAgent",
      "agent_prompt": "Package the final executive-grade fund recommendation report. Take the formatted HTML content from T025 and the chart data from T024. Embed the chart data and necessary Chart.js library scripts into the HTML to create a single, interactive, standalone `fund_comprehensive_report.html` file. Ensure the report has a professional design, is print-friendly, and all visualizations are rendered correctly.",
      "reads": [
        "T024",
        "T025"
      ],
      "writes": [
        "T026"
      ],
      "status": "pending",
      "output": null,
      "error": null,
      "cost": 0.0,
      "start_time": null,
      "end_time": null,
      "execution_time": 0.0
    }
  ],
  "links": [
    {
      "source": "ROOT",
      "target": "T020"
    },
    {
      "source": "T020",
      "target": "T021"
    },
    {
      "source": "T020",
      "target": "T022"
    },
    {
      "source": "T020",
      "target": "T023"
    },
    {
      "source": "T020",
      "target": "T025"
    },
    {
      "source": "T021",
      "target": "T022"
    },
    {
      "source": "T021",
      "target": "T023"
    },
    {
      "source": "T022",
      "target": "T023"
    },
    {
      "source": "T022",
      "target": "T024"
    },
    {
      "source": "T022",
      "target": "T025"
    },
    {
      "source": "T023",
      "target": "T025"
    },
    {
      "source": "T024",
      "target": "T025"
    },
    {
      "source": "T024",
      "target": "T026"
    },
    {
      "source": "T025",
      "target": "T026"
    }
  ]
}